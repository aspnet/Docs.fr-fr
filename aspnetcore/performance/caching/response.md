---
title: Mise en cache des réponses dans ASP.NET Core
author: rick-anderson
description: Découvrez comment utiliser la mise en cache des réponses pour réduire les besoins en bande passante et accroître les performances des applications ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.date: 11/04/2019
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: performance/caching/response
ms.openlocfilehash: 539ddb118279adb3a53394cdb0c2e5169092ebc0
ms.sourcegitcommit: 54fe1ae5e7d068e27376d562183ef9ddc7afc432
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/10/2021
ms.locfileid: "102589229"
---
# <a name="response-caching-in-aspnet-core"></a><span data-ttu-id="15288-103">Mise en cache des réponses dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="15288-103">Response caching in ASP.NET Core</span></span>

<span data-ttu-id="15288-104">Par [John Luo](https://github.com/JunTaoLuo), [Rick Anderson](https://twitter.com/RickAndMSFT)et [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="15288-104">By [John Luo](https://github.com/JunTaoLuo), [Rick Anderson](https://twitter.com/RickAndMSFT), and [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="15288-105">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/performance/caching/response/samples) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="15288-105">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/performance/caching/response/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="15288-106">La mise en cache des réponses réduit le nombre de demandes qu’un client ou un proxy effectue sur un serveur Web.</span><span class="sxs-lookup"><span data-stu-id="15288-106">Response caching reduces the number of requests a client or proxy makes to a web server.</span></span> <span data-ttu-id="15288-107">La mise en cache des réponses réduit également la quantité de travail effectuée par le serveur Web pour générer une réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-107">Response caching also reduces the amount of work the web server performs to generate a response.</span></span> <span data-ttu-id="15288-108">La mise en cache des réponses est contrôlée par des en-têtes qui spécifient comment vous souhaitez que le client, le proxy et l’intergiciel (middleware) effectuent le cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-108">Response caching is controlled by headers that specify how you want client, proxy, and middleware to cache responses.</span></span>

<span data-ttu-id="15288-109">L' [attribut ResponseCache](#responsecache-attribute) participe à la définition des en-têtes de mise en cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-109">The [ResponseCache attribute](#responsecache-attribute) participates in setting response caching headers.</span></span> <span data-ttu-id="15288-110">Les clients et les proxys intermédiaires doivent honorer les en-têtes pour la mise en cache des réponses sous la [spécification de Caching HTTP 1,1](https://tools.ietf.org/html/rfc7234).</span><span class="sxs-lookup"><span data-stu-id="15288-110">Clients and intermediate proxies should honor the headers for caching responses under the [HTTP 1.1 Caching specification](https://tools.ietf.org/html/rfc7234).</span></span>

<span data-ttu-id="15288-111">Pour la mise en cache côté serveur qui suit la spécification de mise en cache HTTP 1,1, utilisez l’intergiciel (middleware) de [mise en](xref:performance/caching/middleware)cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-111">For server-side caching that follows the HTTP 1.1 Caching specification, use [Response Caching Middleware](xref:performance/caching/middleware).</span></span> <span data-ttu-id="15288-112">L’intergiciel (middleware) peut utiliser les <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> Propriétés pour influencer le comportement de mise en cache côté serveur.</span><span class="sxs-lookup"><span data-stu-id="15288-112">The middleware can use the <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> properties to influence server-side caching behavior.</span></span>

## <a name="http-based-response-caching"></a><span data-ttu-id="15288-113">Mise en cache des réponses HTTP</span><span class="sxs-lookup"><span data-stu-id="15288-113">HTTP-based response caching</span></span>

<span data-ttu-id="15288-114">La [spécification de mise en cache HTTP 1,1](https://tools.ietf.org/html/rfc7234) décrit le comportement des caches Internet.</span><span class="sxs-lookup"><span data-stu-id="15288-114">The [HTTP 1.1 Caching specification](https://tools.ietf.org/html/rfc7234) describes how Internet caches should behave.</span></span> <span data-ttu-id="15288-115">L’en-tête HTTP principal utilisé pour la mise en cache est [Cache-Control](https://tools.ietf.org/html/rfc7234#section-5.2), qui est utilisé pour spécifier les *directives* de cache.</span><span class="sxs-lookup"><span data-stu-id="15288-115">The primary HTTP header used for caching is [Cache-Control](https://tools.ietf.org/html/rfc7234#section-5.2), which is used to specify cache *directives*.</span></span> <span data-ttu-id="15288-116">Les directives contrôlent le comportement de mise en cache en fonction des demandes en provenance des clients et des serveurs, tandis que les réponses sont rétablies des serveurs aux clients.</span><span class="sxs-lookup"><span data-stu-id="15288-116">The directives control caching behavior as requests make their way from clients to servers and as responses make their way from servers back to clients.</span></span> <span data-ttu-id="15288-117">Les demandes et les réponses passent par les serveurs proxy, et les serveurs proxy doivent également se conformer à la spécification de mise en cache HTTP 1,1.</span><span class="sxs-lookup"><span data-stu-id="15288-117">Requests and responses move through proxy servers, and proxy servers must also conform to the HTTP 1.1 Caching specification.</span></span>

<span data-ttu-id="15288-118">`Cache-Control`Les directives communes sont présentées dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="15288-118">Common `Cache-Control` directives are shown in the following table.</span></span>

| <span data-ttu-id="15288-119">Directive</span><span class="sxs-lookup"><span data-stu-id="15288-119">Directive</span></span>                                                       | <span data-ttu-id="15288-120">Action</span><span class="sxs-lookup"><span data-stu-id="15288-120">Action</span></span> |
| --------------------------------------------------------------- | ------ |
| [<span data-ttu-id="15288-121">public</span><span class="sxs-lookup"><span data-stu-id="15288-121">public</span></span>](https://tools.ietf.org/html/rfc7234#section-5.2.2.5)   | <span data-ttu-id="15288-122">Un cache peut stocker la réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-122">A cache may store the response.</span></span> |
| [<span data-ttu-id="15288-123">priv</span><span class="sxs-lookup"><span data-stu-id="15288-123">private</span></span>](https://tools.ietf.org/html/rfc7234#section-5.2.2.6)  | <span data-ttu-id="15288-124">La réponse ne doit pas être stockée par un cache partagé.</span><span class="sxs-lookup"><span data-stu-id="15288-124">The response must not be stored by a shared cache.</span></span> <span data-ttu-id="15288-125">Un cache privé peut stocker et réutiliser la réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-125">A private cache may store and reuse the response.</span></span> |
| [<span data-ttu-id="15288-126">âge maximal</span><span class="sxs-lookup"><span data-stu-id="15288-126">max-age</span></span>](https://tools.ietf.org/html/rfc7234#section-5.2.1.1)  | <span data-ttu-id="15288-127">Le client n’accepte pas de réponse dont l’âge est supérieur au nombre de secondes spécifié.</span><span class="sxs-lookup"><span data-stu-id="15288-127">The client doesn't accept a response whose age is greater than the specified number of seconds.</span></span> <span data-ttu-id="15288-128">Exemples : `max-age=60` (60 secondes), `max-age=2592000` (1 mois)</span><span class="sxs-lookup"><span data-stu-id="15288-128">Examples: `max-age=60` (60 seconds), `max-age=2592000` (1 month)</span></span> |
| [<span data-ttu-id="15288-129">non-cache</span><span class="sxs-lookup"><span data-stu-id="15288-129">no-cache</span></span>](https://tools.ietf.org/html/rfc7234#section-5.2.1.4) | <span data-ttu-id="15288-130">**Sur les demandes**: un cache ne doit pas utiliser une réponse stockée pour satisfaire la demande.</span><span class="sxs-lookup"><span data-stu-id="15288-130">**On requests**: A cache must not use a stored response to satisfy the request.</span></span> <span data-ttu-id="15288-131">Le serveur d’origine régénère la réponse pour le client, et l’intergiciel met à jour la réponse stockée dans son cache.</span><span class="sxs-lookup"><span data-stu-id="15288-131">The origin server regenerates the response for the client, and the middleware updates the stored response in its cache.</span></span><br><br><span data-ttu-id="15288-132">**Sur les réponses**: la réponse ne doit pas être utilisée pour une demande ultérieure sans validation sur le serveur d’origine.</span><span class="sxs-lookup"><span data-stu-id="15288-132">**On responses**: The response must not be used for a subsequent request without validation on the origin server.</span></span> |
| [<span data-ttu-id="15288-133">non-Store</span><span class="sxs-lookup"><span data-stu-id="15288-133">no-store</span></span>](https://tools.ietf.org/html/rfc7234#section-5.2.1.5) | <span data-ttu-id="15288-134">**Sur les demandes**: un cache ne doit pas stocker la demande.</span><span class="sxs-lookup"><span data-stu-id="15288-134">**On requests**: A cache must not store the request.</span></span><br><br><span data-ttu-id="15288-135">**Sur les réponses**: un cache ne doit pas stocker une partie de la réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-135">**On responses**: A cache must not store any part of the response.</span></span> |

<span data-ttu-id="15288-136">Les autres en-têtes de cache qui jouent un rôle dans la mise en cache sont répertoriés dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="15288-136">Other cache headers that play a role in caching are shown in the following table.</span></span>

| <span data-ttu-id="15288-137">En-tête</span><span class="sxs-lookup"><span data-stu-id="15288-137">Header</span></span>                                                     | <span data-ttu-id="15288-138">Fonction</span><span class="sxs-lookup"><span data-stu-id="15288-138">Function</span></span> |
| ---------------------------------------------------------- | -------- |
| [<span data-ttu-id="15288-139">Age</span><span class="sxs-lookup"><span data-stu-id="15288-139">Age</span></span>](https://tools.ietf.org/html/rfc7234#section-5.1)     | <span data-ttu-id="15288-140">Estimation de la durée en secondes depuis que la réponse a été générée ou validée sur le serveur d’origine.</span><span class="sxs-lookup"><span data-stu-id="15288-140">An estimate of the amount of time in seconds since the response was generated or successfully validated at the origin server.</span></span> |
| [<span data-ttu-id="15288-141">Expire</span><span class="sxs-lookup"><span data-stu-id="15288-141">Expires</span></span>](https://tools.ietf.org/html/rfc7234#section-5.3) | <span data-ttu-id="15288-142">Heure après laquelle la réponse est considérée comme périmée.</span><span class="sxs-lookup"><span data-stu-id="15288-142">The time after which the response is considered stale.</span></span> |
| [<span data-ttu-id="15288-143">Bali</span><span class="sxs-lookup"><span data-stu-id="15288-143">Pragma</span></span>](https://tools.ietf.org/html/rfc7234#section-5.4)  | <span data-ttu-id="15288-144">Existe pour la compatibilité descendante avec les caches HTTP/1.0 pour la définition du `no-cache` comportement.</span><span class="sxs-lookup"><span data-stu-id="15288-144">Exists for backwards compatibility with HTTP/1.0 caches for setting `no-cache` behavior.</span></span> <span data-ttu-id="15288-145">Si l' `Cache-Control` en-tête est présent, l' `Pragma` en-tête est ignoré.</span><span class="sxs-lookup"><span data-stu-id="15288-145">If the `Cache-Control` header is present, the `Pragma` header is ignored.</span></span> |
| [<span data-ttu-id="15288-146">Varier</span><span class="sxs-lookup"><span data-stu-id="15288-146">Vary</span></span>](https://tools.ietf.org/html/rfc7231#section-7.1.4)  | <span data-ttu-id="15288-147">Spécifie qu’une réponse mise en cache ne doit pas être envoyée, sauf si tous les `Vary` champs d’en-tête correspondent à la fois à la demande d’origine de la réponse mise en cache et à la nouvelle requête.</span><span class="sxs-lookup"><span data-stu-id="15288-147">Specifies that a cached response must not be sent unless all of the `Vary` header fields match in both the cached response's original request and the new request.</span></span> |

## <a name="http-based-caching-respects-request-cache-control-directives"></a><span data-ttu-id="15288-148">La mise en cache basée sur HTTP respecte les directives de Cache-Control des requêtes</span><span class="sxs-lookup"><span data-stu-id="15288-148">HTTP-based caching respects request Cache-Control directives</span></span>

<span data-ttu-id="15288-149">La [spécification de mise en cache HTTP 1,1 pour l’en-tête Cache-Control](https://tools.ietf.org/html/rfc7234#section-5.2) nécessite un cache pour honorer un `Cache-Control` en-tête valide envoyé par le client.</span><span class="sxs-lookup"><span data-stu-id="15288-149">The [HTTP 1.1 Caching specification for the Cache-Control header](https://tools.ietf.org/html/rfc7234#section-5.2) requires a cache to honor a valid `Cache-Control` header sent by the client.</span></span> <span data-ttu-id="15288-150">Un client peut faire des demandes avec une `no-cache` valeur d’en-tête et forcer le serveur à générer une nouvelle réponse pour chaque demande.</span><span class="sxs-lookup"><span data-stu-id="15288-150">A client can make requests with a `no-cache` header value and force the server to generate a new response for every request.</span></span>

<span data-ttu-id="15288-151">L’Honoring `Cache-Control` des en-têtes de demande client est judicieux si vous considérez l’objectif de la mise en cache http.</span><span class="sxs-lookup"><span data-stu-id="15288-151">Always honoring client `Cache-Control` request headers makes sense if you consider the goal of HTTP caching.</span></span> <span data-ttu-id="15288-152">Dans le cadre de la spécification officielle, la mise en cache est destinée à réduire la latence et la surcharge réseau de la satisfaction des demandes sur un réseau de clients, de proxys et de serveurs.</span><span class="sxs-lookup"><span data-stu-id="15288-152">Under the official specification, caching is meant to reduce the latency and network overhead of satisfying requests across a network of clients, proxies, and servers.</span></span> <span data-ttu-id="15288-153">Il ne s’agit pas nécessairement d’un moyen de contrôler la charge sur un serveur d’origine.</span><span class="sxs-lookup"><span data-stu-id="15288-153">It isn't necessarily a way to control the load on an origin server.</span></span>

<span data-ttu-id="15288-154">Il n’existe aucun contrôle de développeur sur ce comportement de mise en cache lors de l’utilisation de l’intergiciel (middleware) de [mise en cache des réponses](xref:performance/caching/middleware) , car celui-ci adhère à la spécification officielle de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="15288-154">There's no developer control over this caching behavior when using the [Response Caching Middleware](xref:performance/caching/middleware) because the middleware adheres to the official caching specification.</span></span> <span data-ttu-id="15288-155">[Les améliorations prévues pour l’intergiciel (middleware](https://github.com/dotnet/AspNetCore/issues/2612) ) permettent de configurer l’intergiciel afin d’ignorer l' `Cache-Control` en-tête d’une demande lorsque vous décidez de traiter une réponse mise en cache.</span><span class="sxs-lookup"><span data-stu-id="15288-155">[Planned enhancements to the middleware](https://github.com/dotnet/AspNetCore/issues/2612) are an opportunity to configure the middleware to ignore a request's `Cache-Control` header when deciding to serve a cached response.</span></span> <span data-ttu-id="15288-156">Les améliorations planifiées permettent de mieux contrôler la charge du serveur.</span><span class="sxs-lookup"><span data-stu-id="15288-156">Planned enhancements provide an opportunity to better control server load.</span></span>

## <a name="other-caching-technology-in-aspnet-core"></a><span data-ttu-id="15288-157">Autres technologies de mise en cache dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="15288-157">Other caching technology in ASP.NET Core</span></span>

### <a name="in-memory-caching"></a><span data-ttu-id="15288-158">Mise en cache en mémoire</span><span class="sxs-lookup"><span data-stu-id="15288-158">In-memory caching</span></span>

<span data-ttu-id="15288-159">La mise en cache en mémoire utilise la mémoire du serveur pour stocker les données mises en cache.</span><span class="sxs-lookup"><span data-stu-id="15288-159">In-memory caching uses server memory to store cached data.</span></span> <span data-ttu-id="15288-160">Ce type de mise en cache convient pour un serveur unique ou plusieurs serveurs à l’aide de *sessions rémanentes*.</span><span class="sxs-lookup"><span data-stu-id="15288-160">This type of caching is suitable for a single server or multiple servers using *sticky sessions*.</span></span> <span data-ttu-id="15288-161">Les sessions rémanentes signifient que les demandes d’un client sont toujours routées vers le même serveur pour traitement.</span><span class="sxs-lookup"><span data-stu-id="15288-161">Sticky sessions means that the requests from a client are always routed to the same server for processing.</span></span>

<span data-ttu-id="15288-162">Pour plus d’informations, consultez <xref:performance/caching/memory>.</span><span class="sxs-lookup"><span data-stu-id="15288-162">For more information, see <xref:performance/caching/memory>.</span></span>

### <a name="distributed-cache"></a><span data-ttu-id="15288-163">Cache distribué</span><span class="sxs-lookup"><span data-stu-id="15288-163">Distributed Cache</span></span>

<span data-ttu-id="15288-164">Utilisez un cache distribué pour stocker les données en mémoire lorsque l’application est hébergée dans une batterie de serveurs ou un Cloud.</span><span class="sxs-lookup"><span data-stu-id="15288-164">Use a distributed cache to store data in memory when the app is hosted in a cloud or server farm.</span></span> <span data-ttu-id="15288-165">Le cache est partagé entre les serveurs qui traitent les demandes.</span><span class="sxs-lookup"><span data-stu-id="15288-165">The cache is shared across the servers that process requests.</span></span> <span data-ttu-id="15288-166">Un client peut soumettre une demande gérée par n’importe quel serveur du groupe si les données mises en cache pour le client sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="15288-166">A client can submit a request that's handled by any server in the group if cached data for the client is available.</span></span> <span data-ttu-id="15288-167">ASP.NET Core fonctionne avec les caches distribués SQL Server, [ReDim](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis)et [NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/) .</span><span class="sxs-lookup"><span data-stu-id="15288-167">ASP.NET Core works with SQL Server, [Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis), and [NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/) distributed caches.</span></span>

<span data-ttu-id="15288-168">Pour plus d’informations, consultez <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="15288-168">For more information, see <xref:performance/caching/distributed>.</span></span>

### <a name="cache-tag-helper"></a><span data-ttu-id="15288-169">Tag Helper de cache</span><span class="sxs-lookup"><span data-stu-id="15288-169">Cache Tag Helper</span></span>

<span data-ttu-id="15288-170">Mettez en cache le contenu à partir d’une vue ou d’une Razor page MVC avec le tag Helper cache.</span><span class="sxs-lookup"><span data-stu-id="15288-170">Cache the content from an MVC view or Razor Page with the Cache Tag Helper.</span></span> <span data-ttu-id="15288-171">Le tag Helper cache utilise la mise en cache en mémoire pour stocker les données.</span><span class="sxs-lookup"><span data-stu-id="15288-171">The Cache Tag Helper uses in-memory caching to store data.</span></span>

<span data-ttu-id="15288-172">Pour plus d’informations, consultez <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>.</span><span class="sxs-lookup"><span data-stu-id="15288-172">For more information, see <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>.</span></span>

### <a name="distributed-cache-tag-helper"></a><span data-ttu-id="15288-173">Tag Helper Cache distribué</span><span class="sxs-lookup"><span data-stu-id="15288-173">Distributed Cache Tag Helper</span></span>

<span data-ttu-id="15288-174">Mettez en cache le contenu à partir d’une vue ou d’une Razor page MVC dans des scénarios de batterie de serveurs Web ou de Cloud distribué avec le tag Helper de cache distribué.</span><span class="sxs-lookup"><span data-stu-id="15288-174">Cache the content from an MVC view or Razor Page in distributed cloud or web farm scenarios with the Distributed Cache Tag Helper.</span></span> <span data-ttu-id="15288-175">Le tag Helper de cache distribué utilise SQL Server, les [redims](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis)ou [NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/) pour stocker des données.</span><span class="sxs-lookup"><span data-stu-id="15288-175">The Distributed Cache Tag Helper uses SQL Server, [Redis](https://www.nuget.org/packages/Microsoft.Extensions.Caching.StackExchangeRedis), or [NCache](https://www.nuget.org/packages/Alachisoft.NCache.OpenSource.SDK/) to store data.</span></span>

<span data-ttu-id="15288-176">Pour plus d’informations, consultez <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>.</span><span class="sxs-lookup"><span data-stu-id="15288-176">For more information, see <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>.</span></span>

## <a name="responsecache-attribute"></a><span data-ttu-id="15288-177">Attribut ResponseCache</span><span class="sxs-lookup"><span data-stu-id="15288-177">ResponseCache attribute</span></span>

<span data-ttu-id="15288-178"><xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute>Spécifie les paramètres nécessaires à la définition des en-têtes appropriés dans la mise en cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-178">The <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> specifies the parameters necessary for setting appropriate headers in response caching.</span></span>

> [!WARNING]
> <span data-ttu-id="15288-179">Désactivez la mise en cache pour le contenu qui contient des informations pour les clients authentifiés.</span><span class="sxs-lookup"><span data-stu-id="15288-179">Disable caching for content that contains information for authenticated clients.</span></span> <span data-ttu-id="15288-180">La mise en cache ne doit être activée que pour le contenu qui ne change pas en fonction de l’identité d’un utilisateur ou si un utilisateur est connecté.</span><span class="sxs-lookup"><span data-stu-id="15288-180">Caching should only be enabled for content that doesn't change based on a user's identity or whether a user is signed in.</span></span>

<span data-ttu-id="15288-181"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> fait varier la réponse stockée en fonction des valeurs de la liste donnée des clés de requête.</span><span class="sxs-lookup"><span data-stu-id="15288-181"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> varies the stored response by the values of the given list of query keys.</span></span> <span data-ttu-id="15288-182">Quand une seule valeur `*` est fournie, l’intergiciel (middleware) varie les réponses par tous les paramètres de chaîne de requête de la demande.</span><span class="sxs-lookup"><span data-stu-id="15288-182">When a single value of `*` is provided, the middleware varies responses by all request query string parameters.</span></span>

<span data-ttu-id="15288-183">L' [intergiciel de mise en cache des réponses](xref:performance/caching/middleware) doit être activé pour définir la <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> propriété.</span><span class="sxs-lookup"><span data-stu-id="15288-183">[Response Caching Middleware](xref:performance/caching/middleware) must be enabled to set the <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> property.</span></span> <span data-ttu-id="15288-184">Dans le cas contraire, une exception Runtime est levée.</span><span class="sxs-lookup"><span data-stu-id="15288-184">Otherwise, a runtime exception is thrown.</span></span> <span data-ttu-id="15288-185">Il n’existe pas d’en-tête HTTP correspondant pour la <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> propriété.</span><span class="sxs-lookup"><span data-stu-id="15288-185">There isn't a corresponding HTTP header for the <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> property.</span></span> <span data-ttu-id="15288-186">La propriété est une fonctionnalité HTTP gérée par l’intergiciel (middleware) de mise en cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-186">The property is an HTTP feature handled by Response Caching Middleware.</span></span> <span data-ttu-id="15288-187">Pour que l’intergiciel serve une réponse mise en cache, la chaîne de requête et la valeur de chaîne de requête doivent correspondre à une demande précédente.</span><span class="sxs-lookup"><span data-stu-id="15288-187">For the middleware to serve a cached response, the query string and query string value must match a previous request.</span></span> <span data-ttu-id="15288-188">Par exemple, considérez la séquence de requêtes et les résultats présentés dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="15288-188">For example, consider the sequence of requests and results shown in the following table.</span></span>

| <span data-ttu-id="15288-189">Requête</span><span class="sxs-lookup"><span data-stu-id="15288-189">Request</span></span>                          | <span data-ttu-id="15288-190">Résultats</span><span class="sxs-lookup"><span data-stu-id="15288-190">Result</span></span>                    |
| -------------------------------- | ------------------------- |
| `http://example.com?key1=value1` | <span data-ttu-id="15288-191">Retourné à partir du serveur.</span><span class="sxs-lookup"><span data-stu-id="15288-191">Returned from the server.</span></span> |
| `http://example.com?key1=value1` | <span data-ttu-id="15288-192">Renvoyé par l’intergiciel (middleware).</span><span class="sxs-lookup"><span data-stu-id="15288-192">Returned from middleware.</span></span> |
| `http://example.com?key1=value2` | <span data-ttu-id="15288-193">Retourné à partir du serveur.</span><span class="sxs-lookup"><span data-stu-id="15288-193">Returned from the server.</span></span> |

<span data-ttu-id="15288-194">La première demande est retournée par le serveur et mise en cache dans l’intergiciel (middleware).</span><span class="sxs-lookup"><span data-stu-id="15288-194">The first request is returned by the server and cached in middleware.</span></span> <span data-ttu-id="15288-195">La deuxième demande est retournée par l’intergiciel (middleware), car la chaîne de requête correspond à la requête précédente.</span><span class="sxs-lookup"><span data-stu-id="15288-195">The second request is returned by middleware because the query string matches the previous request.</span></span> <span data-ttu-id="15288-196">La troisième demande n’est pas dans le cache de l’intergiciel (middleware), car la valeur de la chaîne de requête ne correspond pas à une demande précédente.</span><span class="sxs-lookup"><span data-stu-id="15288-196">The third request isn't in the middleware cache because the query string value doesn't match a previous request.</span></span>

<span data-ttu-id="15288-197">Le <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> est utilisé pour configurer et créer (via <xref:Microsoft.AspNetCore.Mvc.Filters.IFilterFactory> ) un `Microsoft.AspNetCore.Mvc.Internal.ResponseCacheFilter` .</span><span class="sxs-lookup"><span data-stu-id="15288-197">The <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> is used to configure and create (via <xref:Microsoft.AspNetCore.Mvc.Filters.IFilterFactory>) a `Microsoft.AspNetCore.Mvc.Internal.ResponseCacheFilter`.</span></span> <span data-ttu-id="15288-198">Le `ResponseCacheFilter` effectue le travail de mise à jour des en-têtes et des fonctionnalités http appropriées de la réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-198">The `ResponseCacheFilter` performs the work of updating the appropriate HTTP headers and features of the response.</span></span> <span data-ttu-id="15288-199">Le filtre :</span><span class="sxs-lookup"><span data-stu-id="15288-199">The filter:</span></span>

* <span data-ttu-id="15288-200">Supprime tous les en-têtes existants pour `Vary` , `Cache-Control` et `Pragma` .</span><span class="sxs-lookup"><span data-stu-id="15288-200">Removes any existing headers for `Vary`, `Cache-Control`, and `Pragma`.</span></span>
* <span data-ttu-id="15288-201">Écrit les en-têtes appropriés en fonction des propriétés définies dans le <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> .</span><span class="sxs-lookup"><span data-stu-id="15288-201">Writes out the appropriate headers based on the properties set in the <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute>.</span></span>
* <span data-ttu-id="15288-202">Met à jour la fonctionnalité HTTP de mise en cache des réponses si <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> est défini.</span><span class="sxs-lookup"><span data-stu-id="15288-202">Updates the response caching HTTP feature if <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByQueryKeys> is set.</span></span>

### <a name="vary"></a><span data-ttu-id="15288-203">Varier</span><span class="sxs-lookup"><span data-stu-id="15288-203">Vary</span></span>

<span data-ttu-id="15288-204">Cet en-tête est écrit uniquement lorsque la <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByHeader> propriété est définie.</span><span class="sxs-lookup"><span data-stu-id="15288-204">This header is only written when the <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByHeader> property is set.</span></span> <span data-ttu-id="15288-205">Propriété définie sur la `Vary` valeur de la propriété.</span><span class="sxs-lookup"><span data-stu-id="15288-205">The property set to the `Vary` property's value.</span></span> <span data-ttu-id="15288-206">L’exemple suivant utilise la <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByHeader> propriété :</span><span class="sxs-lookup"><span data-stu-id="15288-206">The following sample uses the <xref:Microsoft.AspNetCore.Mvc.CacheProfile.VaryByHeader> property:</span></span>

[!code-csharp[](response/samples/2.x/ResponseCacheSample/Pages/Cache1.cshtml.cs?name=snippet)]

<span data-ttu-id="15288-207">À l’aide de l’exemple d’application, affichez les en-têtes de réponse avec les outils réseau du navigateur.</span><span class="sxs-lookup"><span data-stu-id="15288-207">Using the sample app, view the response headers with the browser's network tools.</span></span> <span data-ttu-id="15288-208">Les en-têtes de réponse suivants sont envoyés avec la réponse de la page Cache1 :</span><span class="sxs-lookup"><span data-stu-id="15288-208">The following response headers are sent with the Cache1 page response:</span></span>

```
Cache-Control: public,max-age=30
Vary: User-Agent
```

### <a name="nostore-and-locationnone"></a><span data-ttu-id="15288-209">NoStore et location. None</span><span class="sxs-lookup"><span data-stu-id="15288-209">NoStore and Location.None</span></span>

<span data-ttu-id="15288-210"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.NoStore> remplace la plupart des autres propriétés.</span><span class="sxs-lookup"><span data-stu-id="15288-210"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.NoStore> overrides most of the other properties.</span></span> <span data-ttu-id="15288-211">Quand cette propriété a la valeur `true` , l' `Cache-Control` en-tête a la valeur `no-store` .</span><span class="sxs-lookup"><span data-stu-id="15288-211">When this property is set to `true`, the `Cache-Control` header is set to `no-store`.</span></span> <span data-ttu-id="15288-212">Si <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> a la valeur `None` :</span><span class="sxs-lookup"><span data-stu-id="15288-212">If <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> is set to `None`:</span></span>

* <span data-ttu-id="15288-213">`Cache-Control` a la valeur `no-store,no-cache`.</span><span class="sxs-lookup"><span data-stu-id="15288-213">`Cache-Control` is set to `no-store,no-cache`.</span></span>
* <span data-ttu-id="15288-214">`Pragma` a la valeur `no-cache`.</span><span class="sxs-lookup"><span data-stu-id="15288-214">`Pragma` is set to `no-cache`.</span></span>

<span data-ttu-id="15288-215">Si <xref:Microsoft.AspNetCore.Mvc.CacheProfile.NoStore> est `false` et <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> est `None` , et `Cache-Control` ont la `Pragma` valeur `no-cache` .</span><span class="sxs-lookup"><span data-stu-id="15288-215">If <xref:Microsoft.AspNetCore.Mvc.CacheProfile.NoStore> is `false` and <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> is `None`, `Cache-Control`, and `Pragma` are set to `no-cache`.</span></span>

<span data-ttu-id="15288-216"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.NoStore> est généralement défini sur `true` pour les pages d’erreur.</span><span class="sxs-lookup"><span data-stu-id="15288-216"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.NoStore> is typically set to `true` for error pages.</span></span> <span data-ttu-id="15288-217">La page cache2 de l’exemple d’application génère des en-têtes de réponse qui indiquent au client de ne pas stocker la réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-217">The Cache2 page in the sample app produces response headers that instruct the client not to store the response.</span></span>

[!code-csharp[](response/samples/2.x/ResponseCacheSample/Pages/Cache2.cshtml.cs?name=snippet)]

<span data-ttu-id="15288-218">L’exemple d’application retourne la page cache2 avec les en-têtes suivants :</span><span class="sxs-lookup"><span data-stu-id="15288-218">The sample app returns the Cache2 page with the following headers:</span></span>

```
Cache-Control: no-store,no-cache
Pragma: no-cache
```

### <a name="location-and-duration"></a><span data-ttu-id="15288-219">Emplacement et durée</span><span class="sxs-lookup"><span data-stu-id="15288-219">Location and Duration</span></span>

<span data-ttu-id="15288-220">Pour activer la mise en cache, <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Duration> doit être défini sur une valeur positive et <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> doit être `Any` (valeur par défaut) ou `Client` .</span><span class="sxs-lookup"><span data-stu-id="15288-220">To enable caching, <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Duration> must be set to a positive value and <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> must be either `Any` (the default) or `Client`.</span></span> <span data-ttu-id="15288-221">L’infrastructure affecte `Cache-Control` à l’en-tête la valeur d’emplacement suivie du `max-age` de la réponse.</span><span class="sxs-lookup"><span data-stu-id="15288-221">The framework sets the `Cache-Control` header to the location value followed by the `max-age` of the response.</span></span>

<span data-ttu-id="15288-222"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location>les options de `Any` et se `Client` traduisent en `Cache-Control` valeurs d’en-tête de `public` et `private` , respectivement.</span><span class="sxs-lookup"><span data-stu-id="15288-222"><xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location>'s options of `Any` and `Client` translate into `Cache-Control` header values of `public` and `private`, respectively.</span></span> <span data-ttu-id="15288-223">Comme indiqué dans la section [NoStore et location. None](#nostore-and-locationnone) , le paramètre <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> pour `None` définit les deux `Cache-Control` et `Pragma` en-têtes sur `no-cache` .</span><span class="sxs-lookup"><span data-stu-id="15288-223">As noted in the [NoStore and Location.None](#nostore-and-locationnone) section, setting <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> to `None` sets both `Cache-Control` and `Pragma` headers to `no-cache`.</span></span>

<span data-ttu-id="15288-224">`Location.Any` ( `Cache-Control` défini sur `public` ) indique que le *client ou un proxy intermédiaire* peut mettre en cache la valeur, y compris l' [intergiciel de mise en](xref:performance/caching/middleware)cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-224">`Location.Any` (`Cache-Control` set to `public`) indicates that the *client or any intermediate proxy* may cache the value, including [Response Caching Middleware](xref:performance/caching/middleware).</span></span>

<span data-ttu-id="15288-225">`Location.Client` ( `Cache-Control` défini sur `private` ) indique que *seul le client* peut mettre en cache la valeur.</span><span class="sxs-lookup"><span data-stu-id="15288-225">`Location.Client` (`Cache-Control` set to `private`) indicates that *only the client* may cache the value.</span></span> <span data-ttu-id="15288-226">Aucun cache intermédiaire ne doit mettre en cache la valeur, y compris l' [intergiciel de mise en](xref:performance/caching/middleware)cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-226">No intermediate cache should cache the value, including [Response Caching Middleware](xref:performance/caching/middleware).</span></span>

<span data-ttu-id="15288-227">Les en-têtes de contrôle de cache fournissent simplement des conseils aux clients et aux proxies intermédiaires quand et comment mettre en cache des réponses.</span><span class="sxs-lookup"><span data-stu-id="15288-227">Cache control headers merely provide guidance to clients and intermediary proxies when and how to cache responses.</span></span> <span data-ttu-id="15288-228">Il n’y a aucune garantie que les clients et les proxys honoreront la [spécification de mise en cache HTTP 1,1](https://tools.ietf.org/html/rfc7234).</span><span class="sxs-lookup"><span data-stu-id="15288-228">There's no guarantee that clients and proxies will honor the [HTTP 1.1 Caching specification](https://tools.ietf.org/html/rfc7234).</span></span> <span data-ttu-id="15288-229">L’intergiciel (middleware) de [mise en cache des réponses](xref:performance/caching/middleware) suit toujours les règles de mise en cache établies par la spécification.</span><span class="sxs-lookup"><span data-stu-id="15288-229">[Response Caching Middleware](xref:performance/caching/middleware) always follows the caching rules laid out by the specification.</span></span>

<span data-ttu-id="15288-230">L’exemple suivant montre le modèle de page cache3 de l’exemple d’application et les en-têtes produits par la définition <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Duration> et la conservation de la valeur par défaut <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> :</span><span class="sxs-lookup"><span data-stu-id="15288-230">The following example shows the Cache3 page model from the sample app and the headers produced by setting <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Duration> and leaving the default <xref:Microsoft.AspNetCore.Mvc.CacheProfile.Location> value:</span></span>

[!code-csharp[](response/samples/2.x/ResponseCacheSample/Pages/Cache3.cshtml.cs?name=snippet)]

<span data-ttu-id="15288-231">L’exemple d’application retourne la page cache3 avec l’en-tête suivant :</span><span class="sxs-lookup"><span data-stu-id="15288-231">The sample app returns the Cache3 page with the following header:</span></span>

```
Cache-Control: public,max-age=10
```

### <a name="cache-profiles"></a><span data-ttu-id="15288-232">Profils de cache</span><span class="sxs-lookup"><span data-stu-id="15288-232">Cache profiles</span></span>

<span data-ttu-id="15288-233">Au lieu de dupliquer les paramètres du cache de réponse sur de nombreux attributs d’action de contrôleur, les profils de cache peuvent être configurés en tant qu’options lors de la configuration de MVC/ Razor pages dans `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="15288-233">Instead of duplicating response cache settings on many controller action attributes, cache profiles can be configured as options when setting up MVC/Razor Pages in `Startup.ConfigureServices`.</span></span> <span data-ttu-id="15288-234">Les valeurs trouvées dans un profil de cache référencé sont utilisées comme valeurs par défaut par <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> et sont remplacées par les propriétés spécifiées sur l’attribut.</span><span class="sxs-lookup"><span data-stu-id="15288-234">Values found in a referenced cache profile are used as the defaults by the <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> and are overridden by any properties specified on the attribute.</span></span>

<span data-ttu-id="15288-235">Configurez un profil de cache.</span><span class="sxs-lookup"><span data-stu-id="15288-235">Set up a cache profile.</span></span> <span data-ttu-id="15288-236">L’exemple suivant montre un profil de cache de 30 secondes dans l’exemple d’application `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="15288-236">The following example shows a 30 second cache profile in the sample app's `Startup.ConfigureServices`:</span></span>

::: moniker range=">= aspnetcore-3.0"

[!code-csharp[](response/samples/3.x/Startup.cs?name=snippet1)]

::: moniker-end

::: moniker range="< aspnetcore-3.0"

[!code-csharp[](response/samples/2.x/ResponseCacheSample/Startup.cs?name=snippet1)]

::: moniker-end

<span data-ttu-id="15288-237">Le modèle de page cache4 de l’exemple d’application fait référence au `Default30` profil de cache :</span><span class="sxs-lookup"><span data-stu-id="15288-237">The sample app's Cache4 page model references the `Default30` cache profile:</span></span>

[!code-csharp[](response/samples/2.x/ResponseCacheSample/Pages/Cache4.cshtml.cs?name=snippet)]

<span data-ttu-id="15288-238">Le <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> peut être appliqué aux éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="15288-238">The <xref:Microsoft.AspNetCore.Mvc.ResponseCacheAttribute> can be applied to:</span></span>

* <span data-ttu-id="15288-239">Razor Pages : les attributs ne peuvent pas être appliqués aux méthodes de gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="15288-239">Razor Pages: Attributes can't be applied to handler methods.</span></span>
* <span data-ttu-id="15288-240">Contrôleurs MVC.</span><span class="sxs-lookup"><span data-stu-id="15288-240">MVC controllers.</span></span>
* <span data-ttu-id="15288-241">Méthodes d’action MVC : les attributs au niveau de la méthode remplacent les paramètres spécifiés dans les attributs de niveau classe.</span><span class="sxs-lookup"><span data-stu-id="15288-241">MVC action methods: Method-level attributes override the settings specified in class-level attributes.</span></span>

<span data-ttu-id="15288-242">En-tête résultant appliqué à la réponse de la page cache4 par le `Default30` profil de cache :</span><span class="sxs-lookup"><span data-stu-id="15288-242">The resulting header applied to the Cache4 page response by the `Default30` cache profile:</span></span>

```
Cache-Control: public,max-age=30
```

## <a name="additional-resources"></a><span data-ttu-id="15288-243">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="15288-243">Additional resources</span></span>

* [<span data-ttu-id="15288-244">Stockage des réponses dans les caches</span><span class="sxs-lookup"><span data-stu-id="15288-244">Storing Responses in Caches</span></span>](https://tools.ietf.org/html/rfc7234#section-3)
* [<span data-ttu-id="15288-245">Cache-Control</span><span class="sxs-lookup"><span data-stu-id="15288-245">Cache-Control</span></span>](https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9)
* <xref:performance/caching/memory>
* <xref:performance/caching/distributed>
* <xref:fundamentals/change-tokens>
* <xref:performance/caching/middleware>
* <xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper>
* <xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper>

---
title: Migrer de ASP.NET Core 3,1 à 5,0
author: scottaddie
description: Découvrez comment migrer un projet ASP.NET Core 3,1 vers ASP.NET Core 5,0.
ms.author: scaddie
ms.custom: mvc
ms.date: 11/18/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: 22dba2cbb83244d6ac89d61cf09b9019fbe5ca8d
ms.sourcegitcommit: df808efa68574dd674f1985aa9d03f4f5fab883f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/18/2020
ms.locfileid: "94851193"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="570c9-103">Migrer de ASP.NET Core 3,1 à 5,0</span><span class="sxs-lookup"><span data-stu-id="570c9-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="570c9-104">Par [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="570c9-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="570c9-105">Cet article explique comment mettre à jour un projet ASP.NET Core 3,1 existant vers ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="570c9-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="570c9-106">Prérequis</span><span class="sxs-lookup"><span data-stu-id="570c9-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="570c9-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="570c9-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="570c9-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="570c9-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="570c9-109">Visual Studio pour Mac</span><span class="sxs-lookup"><span data-stu-id="570c9-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="570c9-110">Mettre à jour la version du SDK .NET Core dans global.json</span><span class="sxs-lookup"><span data-stu-id="570c9-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="570c9-111">Si vous vous fiez à un [global.jssur](/dotnet/core/tools/global-json) un fichier pour cibler une version de kit SDK .net Core spécifique, mettez à jour la `version` propriété vers la version du kit de développement logiciel (SDK) .net 5,0 installée.</span><span class="sxs-lookup"><span data-stu-id="570c9-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="570c9-112">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="570c9-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="570c9-113">Mettre à jour la version cible de .NET Framework</span><span class="sxs-lookup"><span data-stu-id="570c9-113">Update the target framework</span></span>

<span data-ttu-id="570c9-114">Si vous mettez à jour un Blazor WebAssembly projet, passez à la section [mettre à jour les Blazor WebAssembly projets](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="570c9-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="570c9-115">Pour tout autre type de projet ASP.NET Core, mettez à jour le [moniker du Framework cible (TFM)](/dotnet/standard/frameworks) du fichier projet en `net5.0` :</span><span class="sxs-lookup"><span data-stu-id="570c9-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="570c9-116">Mise à jour Blazor WebAssembly et Blazor Server projets</span><span class="sxs-lookup"><span data-stu-id="570c9-116">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="570c9-117">*Les instructions de cette section s’appliquent aux deux Blazor modèles d’hébergement. Les sections qui suivent cette section fournissent des conseils supplémentaires spécifiques à l’hébergement des modèles et des types d’applications. Appliquez le guidnace de toutes les sections pertinentes à votre application.*</span><span class="sxs-lookup"><span data-stu-id="570c9-117">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidnace from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="570c9-118">Dans `wwwroot/index.html` une Blazor WebAssembly application ou la `Pages/_Host.cshtml` d’une Blazor Server application, ajoutez un `<link>` élément à l' `<head>` élément pour les styles.</span><span class="sxs-lookup"><span data-stu-id="570c9-118">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="570c9-119">Dans les `<link>` valeurs d’attribut d’élément suivantes `href` , l’espace réservé `{ASSEMBLY NAME}` est le nom de l’assembly de l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-119">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```
    
    <span data-ttu-id="570c9-120">Autonome Blazor WebAssembly ou Blazor Server exemple :</span><span class="sxs-lookup"><span data-stu-id="570c9-120">Standalone Blazor WebAssembly or Blazor Server example:</span></span>
    
    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="570c9-121">*`Client`* projet d’un exemple de solution hébergée Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="570c9-121">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>
    
    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="570c9-122">Incluez un nouvel espace de noms dans le fichier de l’application `_Imports.razor` pour la [virtualisation de composants](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="570c9-122">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="570c9-123">Les `_Imports.razor` fichiers suivants montrent les espaces de noms par défaut dans les applications générées à partir des Blazor modèles de projet.</span><span class="sxs-lookup"><span data-stu-id="570c9-123">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="570c9-124">L’espace réservé `{ASSEMBLY NAME}` est le nom de l’assembly de l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-124">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="570c9-125">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="570c9-125">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="570c9-126">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="570c9-126">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="570c9-127">Dans le `MainLayout` composant ( `Shared/MainLayout.razor` ), entourez le balisage HTML du composant avec un `<div>` élément dont l’attribut a la `class` valeur `page` :</span><span class="sxs-lookup"><span data-stu-id="570c9-127">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="570c9-128">Ajoutez les fichiers suivants au `Shared` dossier :</span><span class="sxs-lookup"><span data-stu-id="570c9-128">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="570c9-129">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="570c9-129">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="570c9-130">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="570c9-130">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="570c9-131">Le dernier `wwwroot/css/app.css` fichier de base d’une Blazor WebAssembly application ou `wwwroot/css/site.css` d’un fichier d’une Blazor Server application comprend les styles suivants.</span><span class="sxs-lookup"><span data-stu-id="570c9-131">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="570c9-132">Supprimez les styles supplémentaires en laissant les styles suivants et ceux que vous avez ajoutés à l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-132">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="570c9-133">La feuille de style suivante inclut uniquement les styles de base et n’inclut **pas** les styles personnalisés ajoutés par le développeur :</span><span class="sxs-lookup"><span data-stu-id="570c9-133">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="570c9-134">Mettre à jour les Blazor WebAssembly projets</span><span class="sxs-lookup"><span data-stu-id="570c9-134">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="570c9-135">Pour un Blazor WebAssembly projet, y compris le *`Client`* projet d’une Blazor solution hébergée, appliquez les modifications suivantes au fichier projet :</span><span class="sxs-lookup"><span data-stu-id="570c9-135">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="570c9-136">Mettez à jour le kit de développement logiciel de `Microsoft.NET.Sdk.Web` vers `Microsoft.NET.Sdk.BlazorWebAssembly` :</span><span class="sxs-lookup"><span data-stu-id="570c9-136">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="570c9-137">Cette mise à jour s’applique uniquement aux projets autonomes Blazor WebAssembly et aux *`Client`* projets de solutions hébergées Blazor .</span><span class="sxs-lookup"><span data-stu-id="570c9-137">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="570c9-138">Mettez à jour les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="570c9-138">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="570c9-139">Supprimez la référence de package à [Microsoft. AspNetCore. Components. Webassembly. Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="570c9-139">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="570c9-140">Mettez à jour d’autres packages vers leurs versions les plus récentes.</span><span class="sxs-lookup"><span data-stu-id="570c9-140">Update other packages to their latest versions.</span></span> <span data-ttu-id="570c9-141">Les versions les plus récentes se trouvent sur [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="570c9-141">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="570c9-142">Dans `wwwroot/index.html` , remplacez l’élément qui charge le `App` composant par un `<div>` élément dont la `id` valeur est `app` :</span><span class="sxs-lookup"><span data-stu-id="570c9-142">In `wwwroot/index.html`, change the element that loads the `App` component to a `<div>` element with an `id` set to `app`:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<div id="app">Loading...</div>
    ```
    
1. <span data-ttu-id="570c9-143">Dans `Program.Main` ( `Program.cs` ) :</span><span class="sxs-lookup"><span data-stu-id="570c9-143">In `Program.Main` (`Program.cs`):</span></span>

   * <span data-ttu-id="570c9-144">Remplacez la référence à l' `<app>` élément par un sélecteur CSS en lui ajoutant un hachage `#` .</span><span class="sxs-lookup"><span data-stu-id="570c9-144">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="570c9-145">Remplacez l' `HttpClient` inscription par étendue.</span><span class="sxs-lookup"><span data-stu-id="570c9-145">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="570c9-146">Blazor WebAssemblyApplication autonome avec comptes Microsoft</span><span class="sxs-lookup"><span data-stu-id="570c9-146">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="570c9-147">Pour une Blazor WebAssembly application autonome inscrite dans le portail Azure d’utiliser Azure Active Directory (AAD) pour les comptes Microsoft :</span><span class="sxs-lookup"><span data-stu-id="570c9-147">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="570c9-148">L’application requiert les `openid` `offline_access` étendues et :</span><span class="sxs-lookup"><span data-stu-id="570c9-148">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="570c9-149">Dans le panneau Portail Azure l' **authentification** de l’inscription de l’application, définissez la configuration de la plateforme sur **une application à page unique** avec l’URI de redirection de l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-149">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="570c9-150">Dans le panneau **authentification** , désactivez l' **octroi implicite** pour les **jetons d’accès** et les **jetons d’ID**.</span><span class="sxs-lookup"><span data-stu-id="570c9-150">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="570c9-151">Pour plus d’informations, consultez <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span><span class="sxs-lookup"><span data-stu-id="570c9-151">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="570c9-152">Blazor WebAssemblyApplication autonome avec Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="570c9-152">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="570c9-153">Pour une Blazor WebAssembly application autonome enregistrée dans le portail Azure pour utiliser Azure Active Directory (AAD) :</span><span class="sxs-lookup"><span data-stu-id="570c9-153">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="570c9-154">L’application requiert l' `https://graph.microsoft.com/User.Read` étendue suivante :</span><span class="sxs-lookup"><span data-stu-id="570c9-154">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="570c9-155">Dans le panneau Portail Azure l' **authentification** de l’inscription de l’application, définissez la configuration de la plateforme sur **une application à page unique** avec l’URI de redirection de l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-155">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="570c9-156">Dans le panneau **authentification** , désactivez l' **octroi implicite** pour les **jetons d’accès** et les **jetons d’ID**.</span><span class="sxs-lookup"><span data-stu-id="570c9-156">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="570c9-157">Pour plus d’informations, consultez <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span><span class="sxs-lookup"><span data-stu-id="570c9-157">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="570c9-158">BlazorApplication autonome avec Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="570c9-158">Standalone Blazor app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="570c9-159">Pour une Blazor WebAssembly application autonome inscrite dans le portail Azure d’utiliser Azure Active Directory (AAD) B2C :</span><span class="sxs-lookup"><span data-stu-id="570c9-159">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="570c9-160">L’application requiert les `openid` `offline_access` étendues et :</span><span class="sxs-lookup"><span data-stu-id="570c9-160">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="570c9-161">Dans le panneau Portail Azure l' **authentification** de l’inscription de l’application, définissez la configuration de la plateforme sur **une application à page unique** avec l’URI de redirection de l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-161">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="570c9-162">Dans le panneau **authentification** , désactivez l' **octroi implicite** pour les **jetons d’accès** et les **jetons d’ID**.</span><span class="sxs-lookup"><span data-stu-id="570c9-162">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="570c9-163">Pour plus d’informations, consultez <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span><span class="sxs-lookup"><span data-stu-id="570c9-163">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-b2c"></a><span data-ttu-id="570c9-164">Application hébergée Blazor WebAssembly avec Azure Active Directory (AAD) ou B2C</span><span class="sxs-lookup"><span data-stu-id="570c9-164">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or B2C</span></span>

<span data-ttu-id="570c9-165">L' *`Client`* inscription de l’application d’une solution hébergée Blazor qui utilise AAD ou AAD B2C pour l’authentification des utilisateurs doit utiliser une **application à page unique** configuration de la plateforme Azure Apps :</span><span class="sxs-lookup"><span data-stu-id="570c9-165">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration:</span></span>

1. <span data-ttu-id="570c9-166">Dans le Portail Azure l’inscription de l’application pour l' *`Client`* application, supprimez la configuration de la plateforme **Web** .</span><span class="sxs-lookup"><span data-stu-id="570c9-166">In the Azure portal app registration for the *`Client`* app, remove the **Web** platform configuration.</span></span>
1. <span data-ttu-id="570c9-167">Ajoutez une configuration de plate-forme d' **application à page unique** avec l’URI de redirection de l’application.</span><span class="sxs-lookup"><span data-stu-id="570c9-167">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
1. <span data-ttu-id="570c9-168">Désactivez l' **octroi implicite** pour les **jetons d’accès** et les **jetons d’ID**.</span><span class="sxs-lookup"><span data-stu-id="570c9-168">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="570c9-169">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="570c9-169">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="570c9-170">Mettre à jour le projet serveur d’une solution hébergée Blazor</span><span class="sxs-lookup"><span data-stu-id="570c9-170">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="570c9-171">Mettez à jour le *`Server`* projet d’une solution hébergée Blazor en tant qu’ASP.net Core application en suivant les instructions générales de cet article.</span><span class="sxs-lookup"><span data-stu-id="570c9-171">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="570c9-172">En outre, *`Server`* les projets qui authentifient les utilisateurs auprès Blazor WebAssembly des applications clientes avec Azure Active Directory (AAD) ou B2C doivent adopter de nouveaux Identity packages Microsoft v 2.0 :</span><span class="sxs-lookup"><span data-stu-id="570c9-172">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="570c9-173">Pour AAD :</span><span class="sxs-lookup"><span data-stu-id="570c9-173">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="570c9-174">Pour AAD B2C :</span><span class="sxs-lookup"><span data-stu-id="570c9-174">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="570c9-175">Pour les références de package précédentes, déterminez les versions de package pour les `{VERSION}` espaces réservés sur NuGet.org :</span><span class="sxs-lookup"><span data-stu-id="570c9-175">For the preceding package references, determine the package versions for the `{VERSION}` placeholders at NuGet.org:</span></span>

* [`Microsoft.Identity.Web`](https://www.nuget.org/packages/Microsoft.Identity.Web)
* [`Microsoft.Identity.Web.UI`](https://www.nuget.org/packages/Microsoft.Identity.Web.UI)

> [!NOTE]
> <span data-ttu-id="570c9-176">Le kit de développement logiciel (SDK) du *`Server`* projet dans une solution hébergée Blazor WebAssembly reste `Microsoft.NET.Sdk.Web` :</span><span class="sxs-lookup"><span data-stu-id="570c9-176">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="570c9-177">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="570c9-177">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="570c9-178">Client non autorisé pour Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="570c9-178">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="570c9-179">Après la mise à niveau d’une Blazor WebAssembly application qui utilise AAD pour l’authentification, vous pouvez recevoir l’erreur suivante sur le rappel de connexion à l’application une fois que l’utilisateur se connecte avec AAD :</span><span class="sxs-lookup"><span data-stu-id="570c9-179">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="570c9-180">info : échec de l’autorisation Microsoft. AspNetCore. Authorization. DefaultAuthorizationService [2].</span><span class="sxs-lookup"><span data-stu-id="570c9-180">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="570c9-181">Ces exigences n’ont pas été satisfaites : DenyAnonymousAuthorizationRequirement : requiert un utilisateur authentifié.</span><span class="sxs-lookup"><span data-stu-id="570c9-181">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="570c9-182">Erreur de rappel de connexion à partir d’AAD :</span><span class="sxs-lookup"><span data-stu-id="570c9-182">Login callback error from AAD:</span></span>

* <span data-ttu-id="570c9-183">Erreur : `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="570c9-183">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="570c9-184">Description : `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="570c9-184">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="570c9-185">Pour résoudre l’erreur :</span><span class="sxs-lookup"><span data-stu-id="570c9-185">To resolve the error:</span></span>

1. <span data-ttu-id="570c9-186">Dans le Portail Azure, accédez au [manifeste de l’application](/azure/active-directory/develop/reference-app-manifest).</span><span class="sxs-lookup"><span data-stu-id="570c9-186">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="570c9-187">Affectez [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) à l’attribut la valeur `null` ou `true` .</span><span class="sxs-lookup"><span data-stu-id="570c9-187">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="570c9-188">Mettre à jour les Razor bibliothèques de classes (RCLs)</span><span class="sxs-lookup"><span data-stu-id="570c9-188">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="570c9-189">Migrez Razor les bibliothèques de classes (RCLs) pour tirer parti des nouvelles API ou fonctionnalités introduites dans le cadre de ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="570c9-189">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="570c9-190">Pour mettre à jour un RCL qui cible des composants :</span><span class="sxs-lookup"><span data-stu-id="570c9-190">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="570c9-191">Mettez à jour les propriétés suivantes dans le fichier projet :</span><span class="sxs-lookup"><span data-stu-id="570c9-191">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="570c9-192">Mettez à jour d’autres packages vers leurs versions les plus récentes.</span><span class="sxs-lookup"><span data-stu-id="570c9-192">Update other packages to their latest versions.</span></span> <span data-ttu-id="570c9-193">Les versions les plus récentes se trouvent sur [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="570c9-193">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="570c9-194">Pour mettre à jour un RCL ciblant MVC, mettez à jour les propriétés suivantes dans le fichier projet :</span><span class="sxs-lookup"><span data-stu-id="570c9-194">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="570c9-195">Mettre à jour les références de package</span><span class="sxs-lookup"><span data-stu-id="570c9-195">Update package references</span></span>

<span data-ttu-id="570c9-196">Dans le fichier projet, mettez à jour chaque [Microsoft. AspNetCore. \*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft. EntityFrameworkCore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft. extensions. \*](https://www.nuget.org/packages?q=Microsoft.Extensions.*)et [System.Net.Http.Jssur](https://www.nuget.org/packages/System.Net.Http.Json) l’attribut de référence de package `Version` à 5.0.0 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="570c9-196">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="570c9-197">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="570c9-197">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="570c9-198">Mettre à jour les images de l’ancrage</span><span class="sxs-lookup"><span data-stu-id="570c9-198">Update Docker images</span></span>

<span data-ttu-id="570c9-199">Pour les applications qui utilisent l’ancrage, *Dockerfile* mettez à jour vos `FROM` instructions et scripts fichier dockerfile.</span><span class="sxs-lookup"><span data-stu-id="570c9-199">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="570c9-200">Utilisez une image de base qui comprend le runtime ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="570c9-200">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="570c9-201">Considérez la `docker pull` différence de commande suivante entre ASP.NET Core 3,1 et 5,0 :</span><span class="sxs-lookup"><span data-stu-id="570c9-201">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="570c9-202">Dans le cadre de la migration vers « .NET » comme nom de produit, les images de la station d’accueil sont déplacées des `mcr.microsoft.com/dotnet/core` dépôts vers `mcr.microsoft.com/dotnet` .</span><span class="sxs-lookup"><span data-stu-id="570c9-202">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="570c9-203">Pour plus d’informations, consultez [dotnet/dotnet-docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span><span class="sxs-lookup"><span data-stu-id="570c9-203">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="570c9-204">Modifications de la liaison de modèle dans ASP.NET Core MVC et les Razor pages</span><span class="sxs-lookup"><span data-stu-id="570c9-204">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="570c9-205">Les valeurs DateTime sont liées au modèle en tant qu’heure UTC</span><span class="sxs-lookup"><span data-stu-id="570c9-205">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="570c9-206">Dans ASP.NET Core 3,1 et versions antérieures, `DateTime` les valeurs étaient liées au modèle comme heure locale, où le fuseau horaire était déterminé par le serveur.</span><span class="sxs-lookup"><span data-stu-id="570c9-206">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="570c9-207">`DateTime` les valeurs liées à partir de la mise en forme d’entrée (JSON) et des `DateTimeOffset` valeurs étaient liées en tant que fuseaux horaires UTC.</span><span class="sxs-lookup"><span data-stu-id="570c9-207">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="570c9-208">Dans ASP.NET Core 5,0 et versions ultérieures, la liaison de modèle lie de manière cohérente `DateTime` les valeurs avec le fuseau horaire UTC.</span><span class="sxs-lookup"><span data-stu-id="570c9-208">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="570c9-209">Pour conserver le comportement précédent, supprimez le `DateTimeModelBinderProvider` dans `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="570c9-209">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="570c9-210">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder remplacer ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="570c9-210">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="570c9-211">Pour ajouter la prise en charge de la liaison de modèle pour les [types d’enregistrements C# 9](/dotnet/csharp/whats-new/csharp-9#record-types), <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> est :</span><span class="sxs-lookup"><span data-stu-id="570c9-211">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="570c9-212">Annoté comme obsolète.</span><span class="sxs-lookup"><span data-stu-id="570c9-212">Annotated as obsolete.</span></span>
* <span data-ttu-id="570c9-213">N’est plus inscrit par défaut.</span><span class="sxs-lookup"><span data-stu-id="570c9-213">No longer registered by default.</span></span>

<span data-ttu-id="570c9-214">Les applications qui reposent sur la présence de `ComplexTypeModelBinderProvider` dans la `ModelBinderProviders` collection doivent référencer le nouveau fournisseur de classeurs :</span><span class="sxs-lookup"><span data-stu-id="570c9-214">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="review-breaking-changes"></a><span data-ttu-id="570c9-215">Examiner les modifications avec rupture</span><span class="sxs-lookup"><span data-stu-id="570c9-215">Review breaking changes</span></span>

<span data-ttu-id="570c9-216">Pour les modifications avec rupture entre .NET Core 3,1 et .NET 5,0, consultez [modifications avec rupture pour la migration de la version 3,1 vers 5,0](/dotnet/core/compatibility/3.1-5.0).</span><span class="sxs-lookup"><span data-stu-id="570c9-216">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="570c9-217">ASP.NET Core et Entity Framework Core sont également inclus dans la liste.</span><span class="sxs-lookup"><span data-stu-id="570c9-217">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>

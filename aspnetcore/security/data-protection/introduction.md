---
title: Protection des données ASP.NET Core
author: rick-anderson
description: En savoir plus sur le concept de protection des données et les principes de conception des API de protection des données ASP.NET Core.
ms.author: riande
ms.custom: mvc
ms.date: 10/24/2018
no-loc:
- 'appsettings.json'
- 'ASP.NET Core Identity'
- 'cookie'
- 'Cookie'
- 'Blazor'
- 'Blazor Server'
- 'Blazor WebAssembly'
- 'Identity'
- "Let's Encrypt"
- 'Razor'
- 'SignalR'
uid: security/data-protection/introduction
ms.openlocfilehash: 5fd5676b286e758f0648d78bf8cb4171e7a98f60
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/30/2020
ms.locfileid: "93051692"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="d7488-103">Protection des données ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d7488-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="d7488-104">Les applications Web doivent souvent stocker des données sensibles à la sécurité.</span><span class="sxs-lookup"><span data-stu-id="d7488-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="d7488-105">Windows fournit DPAPI pour les applications de bureau, mais cela ne convient pas aux applications Web.</span><span class="sxs-lookup"><span data-stu-id="d7488-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="d7488-106">La pile de protection des données ASP.NET Core fournit une API de chiffrement simple et facile à utiliser qu’un développeur peut utiliser pour protéger des données, notamment la gestion et la rotation des clés.</span><span class="sxs-lookup"><span data-stu-id="d7488-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="d7488-107">La pile de protection des données ASP.NET Core est conçue pour servir de remplacement à long terme de &lt; l' &gt; élément machineKey dans ASP.net 1. x-4. x.</span><span class="sxs-lookup"><span data-stu-id="d7488-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="d7488-108">Il a été conçu pour résoudre bon nombre des lacunes de l’ancienne pile de chiffrement, tout en fournissant une solution prête à l’emploi pour la majorité des cas d’utilisation que les applications modernes sont susceptibles de rencontrer.</span><span class="sxs-lookup"><span data-stu-id="d7488-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="d7488-109">Définition du problème</span><span class="sxs-lookup"><span data-stu-id="d7488-109">Problem statement</span></span>

<span data-ttu-id="d7488-110">La déclaration globale du problème peut être exposée succinctement en une seule phrase : je dois conserver des informations approuvées pour une récupération ultérieure, mais je n’approuve pas le mécanisme de persistance.</span><span class="sxs-lookup"><span data-stu-id="d7488-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="d7488-111">En termes Web, cela peut être écrit comme « j’ai besoin d’aller-retour dans un État approuvé via un client non approuvé ».</span><span class="sxs-lookup"><span data-stu-id="d7488-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="d7488-112">L’exemple canonique est un jeton d’authentification cookie ou de porteur.</span><span class="sxs-lookup"><span data-stu-id="d7488-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="d7488-113">Le serveur génère un jeton « je suis Groot et dispose des autorisations XYZ » et le transmet au client.</span><span class="sxs-lookup"><span data-stu-id="d7488-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="d7488-114">À une date ultérieure, le client présente ce jeton au serveur, mais le serveur a besoin d’un certain type d’assurance que le client n’a pas falsifié le jeton.</span><span class="sxs-lookup"><span data-stu-id="d7488-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="d7488-115">Par conséquent, la première exigence : authenticité (également appelée</span><span class="sxs-lookup"><span data-stu-id="d7488-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="d7488-116">intégrité, vérification de la falsification).</span><span class="sxs-lookup"><span data-stu-id="d7488-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="d7488-117">Étant donné que l’état persistant est approuvé par le serveur, nous pensons que cet État peut contenir des informations spécifiques à l’environnement d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="d7488-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="d7488-118">Cela peut se présenter sous la forme d’un chemin d’accès de fichier, d’une autorisation, d’un handle ou d’une autre référence indirecte, ou d’un autre élément de données spécifiques au serveur.</span><span class="sxs-lookup"><span data-stu-id="d7488-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="d7488-119">Ces informations ne doivent généralement pas être divulguées à un client non approuvé.</span><span class="sxs-lookup"><span data-stu-id="d7488-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="d7488-120">Par conséquent, la deuxième exigence : la confidentialité.</span><span class="sxs-lookup"><span data-stu-id="d7488-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="d7488-121">Enfin, étant donné que les applications modernes sont composant, ce que nous avons vu est que les composants individuels souhaitent tirer parti de ce système sans tenir compte des autres composants du système.</span><span class="sxs-lookup"><span data-stu-id="d7488-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="d7488-122">Par exemple, si un composant de jeton du porteur utilise cette pile, il doit fonctionner sans interférence d’un mécanisme anti-CSRF qui peut également utiliser la même pile.</span><span class="sxs-lookup"><span data-stu-id="d7488-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="d7488-123">Par conséquent, l’exigence finale : isolation.</span><span class="sxs-lookup"><span data-stu-id="d7488-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="d7488-124">Nous pouvons fournir des contraintes supplémentaires afin de limiter l’étendue de nos exigences.</span><span class="sxs-lookup"><span data-stu-id="d7488-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="d7488-125">Nous partons du principe que tous les services opérant dans le chiffrement sont de confiance égale et que les données ne doivent pas être générées ou consommées en dehors des services sous notre contrôle direct.</span><span class="sxs-lookup"><span data-stu-id="d7488-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="d7488-126">En outre, nous avons besoin que les opérations soient aussi rapides que possible, car chaque requête adressée au service Web peut traverser le chiffrement une ou plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="d7488-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="d7488-127">Cela rend le chiffrement symétrique idéal pour notre scénario et nous pouvons escompter le chiffrement asymétrique jusqu’à ce qu’il soit nécessaire.</span><span class="sxs-lookup"><span data-stu-id="d7488-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="d7488-128">Philosophie de conception</span><span class="sxs-lookup"><span data-stu-id="d7488-128">Design philosophy</span></span>

<span data-ttu-id="d7488-129">Nous avons commencé par identifier les problèmes avec la pile existante.</span><span class="sxs-lookup"><span data-stu-id="d7488-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="d7488-130">Après cela, nous avons interrogé le paysage des solutions existantes et conclu qu’aucune solution existante n’avait les fonctionnalités que nous avons recherchées.</span><span class="sxs-lookup"><span data-stu-id="d7488-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="d7488-131">Nous avons ensuite conçu une solution basée sur plusieurs principes directeurs.</span><span class="sxs-lookup"><span data-stu-id="d7488-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="d7488-132">Le système doit offrir une simplicité de configuration.</span><span class="sxs-lookup"><span data-stu-id="d7488-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="d7488-133">Dans l’idéal, le système serait sans configuration et les développeurs pouvaient s’appuyer sur le sol.</span><span class="sxs-lookup"><span data-stu-id="d7488-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="d7488-134">Dans les situations où les développeurs doivent configurer un aspect spécifique (par exemple, le référentiel de clé), il est important de tenir compte de la simplicité de ces configurations spécifiques.</span><span class="sxs-lookup"><span data-stu-id="d7488-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="d7488-135">Offre une API simple destinée aux consommateurs.</span><span class="sxs-lookup"><span data-stu-id="d7488-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="d7488-136">Les API doivent être faciles à utiliser correctement et difficiles à utiliser de manière incorrecte.</span><span class="sxs-lookup"><span data-stu-id="d7488-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="d7488-137">Les développeurs ne doivent pas apprendre les principes de gestion clés.</span><span class="sxs-lookup"><span data-stu-id="d7488-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="d7488-138">Le système doit gérer la sélection de l’algorithme et la durée de vie de la clé au nom du développeur.</span><span class="sxs-lookup"><span data-stu-id="d7488-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="d7488-139">Dans l’idéal, le développeur ne doit jamais avoir accès au matériel de clé brut.</span><span class="sxs-lookup"><span data-stu-id="d7488-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="d7488-140">Lorsque cela est possible, les clés doivent être protégées au repos.</span><span class="sxs-lookup"><span data-stu-id="d7488-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="d7488-141">Le système doit déterminer un mécanisme de protection par défaut approprié et l’appliquer automatiquement.</span><span class="sxs-lookup"><span data-stu-id="d7488-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="d7488-142">Avec ces principes à l’esprit, nous avons développé une pile de protection des données simple et [facile à utiliser](xref:security/data-protection/using-data-protection) .</span><span class="sxs-lookup"><span data-stu-id="d7488-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="d7488-143">Les API de protection des données ASP.NET Core ne sont pas principalement destinées à la persistance illimitée des charges utiles confidentielles.</span><span class="sxs-lookup"><span data-stu-id="d7488-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="d7488-144">D’autres technologies telles que [DPAPI Windows CNG](/windows/win32/seccng/cng-dpapi) et [Azure Rights Management](/rights-management/) sont plus adaptées au scénario de stockage indéfini, et elles ont des fonctionnalités de gestion de clés fortes.</span><span class="sxs-lookup"><span data-stu-id="d7488-144">Other technologies like [Windows CNG DPAPI](/windows/win32/seccng/cng-dpapi) and [Azure Rights Management](/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="d7488-145">Cela dit, rien n’empêche un développeur d’utiliser les API de protection des données ASP.NET Core pour la protection à long terme des données confidentielles.</span><span class="sxs-lookup"><span data-stu-id="d7488-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="d7488-146">Public visé</span><span class="sxs-lookup"><span data-stu-id="d7488-146">Audience</span></span>

<span data-ttu-id="d7488-147">Le système de protection des données est divisé en cinq packages principaux.</span><span class="sxs-lookup"><span data-stu-id="d7488-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="d7488-148">Divers aspects de ces API ciblent trois audiences principales.</span><span class="sxs-lookup"><span data-stu-id="d7488-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="d7488-149">La [vue d’ensemble des API de consommateur](xref:security/data-protection/consumer-apis/overview) cible les développeurs d’applications et d’infrastructures.</span><span class="sxs-lookup"><span data-stu-id="d7488-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="d7488-150">«Je ne veux pas en savoir plus sur le fonctionnement de la pile ou sur la façon dont elle est configurée.</span><span class="sxs-lookup"><span data-stu-id="d7488-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="d7488-151">Je souhaite simplement effectuer une opération aussi simple que possible, avec une probabilité élevée d’utilisation des API.»</span><span class="sxs-lookup"><span data-stu-id="d7488-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="d7488-152">Les [API de configuration](xref:security/data-protection/configuration/overview) ciblent les développeurs d’applications et les administrateurs système.</span><span class="sxs-lookup"><span data-stu-id="d7488-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="d7488-153">« Je dois dire au système de protection des données que mon environnement nécessite des chemins ou des paramètres autres que ceux par défaut. »</span><span class="sxs-lookup"><span data-stu-id="d7488-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="d7488-154">Les API d’extensibilité ciblent les développeurs chargés de l’implémentation d’une stratégie personnalisée.</span><span class="sxs-lookup"><span data-stu-id="d7488-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="d7488-155">L’utilisation de ces API est limitée aux rares situations et aux développeurs expérimentés en matière de sécurité.</span><span class="sxs-lookup"><span data-stu-id="d7488-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="d7488-156">«J’ai besoin de remplacer un composant entier dans le système, car j’ai véritablement des exigences comportementales uniques.</span><span class="sxs-lookup"><span data-stu-id="d7488-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="d7488-157">Je souhaite apprendre les parties utilisées de manière inhabituelle de la surface de l’API afin de créer un plug-in qui répond à mes exigences.»</span><span class="sxs-lookup"><span data-stu-id="d7488-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="d7488-158">Disposition de package</span><span class="sxs-lookup"><span data-stu-id="d7488-158">Package layout</span></span>

<span data-ttu-id="d7488-159">La pile de protection des données est constituée de cinq packages.</span><span class="sxs-lookup"><span data-stu-id="d7488-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="d7488-160">[Microsoft. AspNetCore. dataprotection. Abstracts](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contient les <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> interfaces et pour créer des services de protection des données.</span><span class="sxs-lookup"><span data-stu-id="d7488-160">[Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contains the <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> and <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> interfaces to create data protection services.</span></span> <span data-ttu-id="d7488-161">Il contient également des méthodes d’extension utiles pour utiliser ces types (par exemple, [IDataProtector. Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span><span class="sxs-lookup"><span data-stu-id="d7488-161">It also contains useful extension methods for working with these types (for example, [IDataProtector.Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span></span> <span data-ttu-id="d7488-162">Si le système de protection des données est instancié ailleurs et que vous consommez l’API, référencez `Microsoft.AspNetCore.DataProtection.Abstractions` .</span><span class="sxs-lookup"><span data-stu-id="d7488-162">If the data protection system is instantiated elsewhere and you're consuming the API, reference `Microsoft.AspNetCore.DataProtection.Abstractions`.</span></span>

* <span data-ttu-id="d7488-163">[Microsoft. AspNetCore. dataprotection](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contient l’implémentation de base du système de protection des données, notamment les opérations de chiffrement de base, la gestion des clés, la configuration et l’extensibilité.</span><span class="sxs-lookup"><span data-stu-id="d7488-163">[Microsoft.AspNetCore.DataProtection](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contains the core implementation of the data protection system, including core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="d7488-164">Pour instancier le système de protection des données (par exemple, en l’ajoutant à un <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection> ) ou en modifiant ou en étendant son comportement, référence `Microsoft.AspNetCore.DataProtection` .</span><span class="sxs-lookup"><span data-stu-id="d7488-164">To instantiate the data protection system (for example, adding it to an <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) or modifying or extending its behavior, reference `Microsoft.AspNetCore.DataProtection`.</span></span>

* <span data-ttu-id="d7488-165">[Microsoft. AspNetCore. dataprotection. extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contient des API supplémentaires que les développeurs peuvent trouver utiles, mais qui n’appartiennent pas au package de base.</span><span class="sxs-lookup"><span data-stu-id="d7488-165">[Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="d7488-166">Par exemple, ce package contient des méthodes de fabrique pour instancier le système de protection des données afin de stocker les clés à un emplacement sur le système de fichiers sans injection de dépendances (consultez <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider> ).</span><span class="sxs-lookup"><span data-stu-id="d7488-166">For instance, this package contains factory methods to instantiate the data protection system to store keys at a location on the file system without dependency injection (see <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span></span> <span data-ttu-id="d7488-167">Il contient également des méthodes d’extension pour limiter la durée de vie des charges utiles protégées (consultez <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector> ).</span><span class="sxs-lookup"><span data-stu-id="d7488-167">It also contains extension methods for limiting the lifetime of protected payloads (see <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span></span>

* <span data-ttu-id="d7488-168">[Microsoft.AspNetCore.DataProtection.SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) peut être installé dans une application ASP.net 4. x existante pour rediriger ses `<machineKey>` opérations afin d’utiliser la nouvelle pile de protection des données ASP.net core.</span><span class="sxs-lookup"><span data-stu-id="d7488-168">[Microsoft.AspNetCore.DataProtection.SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) can be installed into an existing ASP.NET 4.x app to redirect its `<machineKey>` operations to use the new ASP.NET Core data protection stack.</span></span> <span data-ttu-id="d7488-169">Pour plus d'informations, consultez <xref:security/data-protection/compatibility/replacing-machinekey>.</span><span class="sxs-lookup"><span data-stu-id="d7488-169">For more information, see <xref:security/data-protection/compatibility/replacing-machinekey>.</span></span>

* <span data-ttu-id="d7488-170">[Microsoft. AspNetCore. Cryptography. Keydérivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) fournit une implémentation de la routine de hachage de mot de passe PBKDF2 et peut être utilisé par les systèmes qui doivent gérer les mots de passe utilisateur en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="d7488-170">[Microsoft.AspNetCore.Cryptography.KeyDerivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) provides an implementation of the PBKDF2 password hashing routine and can be used by systems that must handle user passwords securely.</span></span> <span data-ttu-id="d7488-171">Pour plus d'informations, consultez <xref:security/data-protection/consumer-apis/password-hashing>.</span><span class="sxs-lookup"><span data-stu-id="d7488-171">For more information, see <xref:security/data-protection/consumer-apis/password-hashing>.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d7488-172">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="d7488-172">Additional resources</span></span>

<xref:host-and-deploy/web-farm>

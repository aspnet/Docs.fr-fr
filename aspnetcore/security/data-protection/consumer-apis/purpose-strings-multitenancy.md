---
title: Hiérarchie des objectifs et architecture mutualisée dans ASP.NET Core
author: rick-anderson
description: En savoir plus sur la hiérarchie des chaînes à usage général et sur l’architecture mutualisée en ce qui concerne les API de protection des données ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
no-loc:
- 'appsettings.json'
- 'ASP.NET Core Identity'
- 'cookie'
- 'Cookie'
- 'Blazor'
- 'Blazor Server'
- 'Blazor WebAssembly'
- 'Identity'
- "Let's Encrypt"
- 'Razor'
- 'SignalR'
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 84714cd852a3cbc7ff77d0fd0c88931536dead1a
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/30/2020
ms.locfileid: "93052784"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="bb60b-103">Hiérarchie des objectifs et architecture mutualisée dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bb60b-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="bb60b-104">Étant donné qu’un `IDataProtector` est également implicitement un `IDataProtectionProvider` , les objectifs peuvent être chaînés ensemble.</span><span class="sxs-lookup"><span data-stu-id="bb60b-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="bb60b-105">Dans ce sens, `provider.CreateProtector([ "purpose1", "purpose2" ])` est équivalent à `provider.CreateProtector("purpose1").CreateProtector("purpose2")` .</span><span class="sxs-lookup"><span data-stu-id="bb60b-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="bb60b-106">Cela permet d’obtenir des relations hiérarchiques intéressantes via le système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="bb60b-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="bb60b-107">Dans l’exemple précédent de [contoso. Messaging. SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), le composant SecureMessage peut appeler `provider.CreateProtector("Contoso.Messaging.SecureMessage")` une fois en amont et mettre en cache le résultat dans un `_myProvider` champ privé.</span><span class="sxs-lookup"><span data-stu-id="bb60b-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="bb60b-108">Des protecteurs futurs peuvent ensuite être créés via des appels à `_myProvider.CreateProtector("User: username")` et ces protecteurs sont utilisés pour sécuriser les messages individuels.</span><span class="sxs-lookup"><span data-stu-id="bb60b-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="bb60b-109">Cela peut également être retourné.</span><span class="sxs-lookup"><span data-stu-id="bb60b-109">This can also be flipped.</span></span> <span data-ttu-id="bb60b-110">Prenons l’exemple d’une application logique unique qui héberge plusieurs locataires (un CMS paraît raisonnable) et chaque locataire peut être configuré avec son propre système de gestion d’État et d’authentification.</span><span class="sxs-lookup"><span data-stu-id="bb60b-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="bb60b-111">L’application parapluie a un seul fournisseur principal, et elle appelle `provider.CreateProtector("Tenant 1")` et `provider.CreateProtector("Tenant 2")` donne à chaque locataire sa propre tranche isolée du système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="bb60b-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="bb60b-112">Les locataires peuvent ensuite dériver leurs propres Protecteurs individuels en fonction de leurs propres besoins, mais quelle que soit leur nature, ils ne peuvent pas créer de protecteurs qui sont en conflit avec les autres locataires du système.</span><span class="sxs-lookup"><span data-stu-id="bb60b-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="bb60b-113">Graphiquement, ceci est représenté comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="bb60b-113">Graphically, this is represented as below.</span></span>

![À des fins d’architecture mutualisée](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="bb60b-115">Cela suppose que l’application parapluie contrôle les API qui sont disponibles pour les locataires individuels et que les locataires ne peuvent pas exécuter du code arbitraire sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="bb60b-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="bb60b-116">Si un locataire peut exécuter du code arbitraire, il peut effectuer une réflexion privée pour rompre les garanties d’isolation, ou il peut simplement lire directement le matériel de génération de clé principal et dériver les sous-clés qu’il souhaite.</span><span class="sxs-lookup"><span data-stu-id="bb60b-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="bb60b-117">Le système de protection des données utilise en fait une sorte d’architecture mutualisée dans sa configuration prête à l’emploi par défaut.</span><span class="sxs-lookup"><span data-stu-id="bb60b-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="bb60b-118">Par défaut, le matériel de génération de clé principal est stocké dans le dossier de profil utilisateur du compte de processus de travail (ou dans le registre, pour les identités du pool d’applications IIS).</span><span class="sxs-lookup"><span data-stu-id="bb60b-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="bb60b-119">Mais il est en fait relativement courant d’utiliser un seul compte pour exécuter plusieurs applications, et par conséquent, toutes ces applications finissent par partager le matériel de génération de clés principal.</span><span class="sxs-lookup"><span data-stu-id="bb60b-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="bb60b-120">Pour résoudre ce cas, le système de protection des données insère automatiquement un identificateur unique par application comme premier élément de la chaîne à usage général.</span><span class="sxs-lookup"><span data-stu-id="bb60b-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="bb60b-121">Cet objectif implicite sert à [isoler les applications individuelles](xref:security/data-protection/configuration/overview#per-application-isolation) les unes des autres en traitant efficacement chaque application comme un locataire unique au sein du système, et le processus de création du protecteur est identique à l’image ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="bb60b-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>

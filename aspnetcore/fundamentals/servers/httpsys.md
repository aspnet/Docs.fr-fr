---
title: Implémentation du serveur web HTTP.sys dans ASP.NET Core
author: rick-anderson
description: Découvrez HTTP.sys, un serveur web pour ASP.NET Core sous Windows. Basé sur le pilote en mode noyau HTTP.sys, HTTP.sys est une solution qui permet d’établir une connexion directe à Internet sans IIS ni Kestrel.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 02/07/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/servers/httpsys
ms.openlocfilehash: e44cdcb7e427c1ae2531c452a7c8b49e104b3d11
ms.sourcegitcommit: 54fe1ae5e7d068e27376d562183ef9ddc7afc432
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/10/2021
ms.locfileid: "102586070"
---
# <a name="httpsys-web-server-implementation-in-aspnet-core"></a><span data-ttu-id="626ab-104">Implémentation du serveur web HTTP.sys dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="626ab-104">HTTP.sys web server implementation in ASP.NET Core</span></span>

<span data-ttu-id="626ab-105">Par [Tom Dykstra](https://github.com/tdykstra) et [Chris Ross](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="626ab-105">By [Tom Dykstra](https://github.com/tdykstra) and [Chris Ross](https://github.com/Tratcher)</span></span>

::: moniker range=">= aspnetcore-3.1"

<span data-ttu-id="626ab-106">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) est un [serveur web pour ASP.NET Core](xref:fundamentals/servers/index) qui s’exécute uniquement sous Windows.</span><span class="sxs-lookup"><span data-stu-id="626ab-106">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) is a [web server for ASP.NET Core](xref:fundamentals/servers/index) that only runs on Windows.</span></span> <span data-ttu-id="626ab-107">HTTP.sys est une alternative au serveur [Kestrel](xref:fundamentals/servers/kestrel) et offre des fonctionnalités supplémentaires par rapport à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="626ab-107">HTTP.sys is an alternative to [Kestrel](xref:fundamentals/servers/kestrel) server and offers some features that Kestrel doesn't provide.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="626ab-108">HTTP.sys est incompatible avec le [Module ASP.NET Core](xref:host-and-deploy/aspnet-core-module) et n’est pas utilisable avec IIS ni IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-108">HTTP.sys isn't compatible with the [ASP.NET Core Module](xref:host-and-deploy/aspnet-core-module) and can't be used with IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-109">HTTP.sys prend en charge les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="626ab-109">HTTP.sys supports the following features:</span></span>

* [<span data-ttu-id="626ab-110">Authentification Windows</span><span class="sxs-lookup"><span data-stu-id="626ab-110">Windows Authentication</span></span>](xref:security/authentication/windowsauth)
* <span data-ttu-id="626ab-111">Partage de port</span><span class="sxs-lookup"><span data-stu-id="626ab-111">Port sharing</span></span>
* <span data-ttu-id="626ab-112">HTTPS avec SNI</span><span class="sxs-lookup"><span data-stu-id="626ab-112">HTTPS with SNI</span></span>
* <span data-ttu-id="626ab-113">HTTP/2 sur TLS (Windows 10 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-113">HTTP/2 over TLS (Windows 10 or later)</span></span>
* <span data-ttu-id="626ab-114">Transmission de fichier directe</span><span class="sxs-lookup"><span data-stu-id="626ab-114">Direct file transmission</span></span>
* <span data-ttu-id="626ab-115">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="626ab-115">Response caching</span></span>
* <span data-ttu-id="626ab-116">WebSockets (Windows 8 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-116">WebSockets (Windows 8 or later)</span></span>

<span data-ttu-id="626ab-117">Versions de Windows prises en charge :</span><span class="sxs-lookup"><span data-stu-id="626ab-117">Supported Windows versions:</span></span>

* <span data-ttu-id="626ab-118">Windows 7 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-118">Windows 7 or later</span></span>
* <span data-ttu-id="626ab-119">Windows Server 2008 R2 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-119">Windows Server 2008 R2 or later</span></span>

<span data-ttu-id="626ab-120">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="626ab-120">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="when-to-use-httpsys"></a><span data-ttu-id="626ab-121">Quand utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-121">When to use HTTP.sys</span></span>

<span data-ttu-id="626ab-122">HTTP.sys est utile pour les déploiements lorsque :</span><span class="sxs-lookup"><span data-stu-id="626ab-122">HTTP.sys is useful for deployments where:</span></span>

* <span data-ttu-id="626ab-123">Il est nécessaire d’exposer directement le serveur à Internet sans passer par IIS.</span><span class="sxs-lookup"><span data-stu-id="626ab-123">There's a need to expose the server directly to the Internet without using IIS.</span></span>

  ![HTTP.sys communique directement avec Internet](httpsys/_static/httpsys-to-internet.png)

* <span data-ttu-id="626ab-125">Un déploiement interne requiert une fonctionnalité qui n’est pas disponible dans Kestrel.</span><span class="sxs-lookup"><span data-stu-id="626ab-125">An internal deployment requires a feature not available in Kestrel.</span></span> <span data-ttu-id="626ab-126">Pour plus d’informations, consultez [Kestrel et HTTP.sys](xref:fundamentals/servers/index#kestrel-vs-httpsys)</span><span class="sxs-lookup"><span data-stu-id="626ab-126">For more information, see [Kestrel vs. HTTP.sys](xref:fundamentals/servers/index#kestrel-vs-httpsys)</span></span>

  ![HTTP.sys communique directement avec le réseau interne](httpsys/_static/httpsys-to-internal.png)

<span data-ttu-id="626ab-128">HTTP.sys est une technologie aboutie qui assure une protection contre de nombreux types d’attaques et offre la robustesse, la sécurité et l’extensibilité d’un serveur web haut de gamme.</span><span class="sxs-lookup"><span data-stu-id="626ab-128">HTTP.sys is mature technology that protects against many types of attacks and provides the robustness, security, and scalability of a full-featured web server.</span></span> <span data-ttu-id="626ab-129">Pour sa part, IIS s’exécute en tant qu’écouteur HTTP sur HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-129">IIS itself runs as an HTTP listener on top of HTTP.sys.</span></span>

## <a name="http2-support"></a><span data-ttu-id="626ab-130">Assistance HTTP/2</span><span class="sxs-lookup"><span data-stu-id="626ab-130">HTTP/2 support</span></span>

<span data-ttu-id="626ab-131">[HTTP/2](https://httpwg.org/specs/rfc7540.html) est activé pour les applications ASP.NET Core si les conditions de base suivantes sont remplies :</span><span class="sxs-lookup"><span data-stu-id="626ab-131">[HTTP/2](https://httpwg.org/specs/rfc7540.html) is enabled for ASP.NET Core apps if the following base requirements are met:</span></span>

* <span data-ttu-id="626ab-132">Windows Server 2016/Windows 10 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-132">Windows Server 2016/Windows 10 or later</span></span>
* <span data-ttu-id="626ab-133">Connexion [ALPN (Application-Layer Protocol Negotiation)](https://tools.ietf.org/html/rfc7301#section-3)</span><span class="sxs-lookup"><span data-stu-id="626ab-133">[Application-Layer Protocol Negotiation (ALPN)](https://tools.ietf.org/html/rfc7301#section-3) connection</span></span>
* <span data-ttu-id="626ab-134">TLS 1.2 ou connexion ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-134">TLS 1.2 or later connection</span></span>

<span data-ttu-id="626ab-135">Si une connexion HTTP/2 est établie, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) retourne `HTTP/2`.</span><span class="sxs-lookup"><span data-stu-id="626ab-135">If an HTTP/2 connection is established, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) reports `HTTP/2`.</span></span>

<span data-ttu-id="626ab-136">HTTP/2 est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="626ab-136">HTTP/2 is enabled by default.</span></span> <span data-ttu-id="626ab-137">Si une connexion HTTP/2 n’est pas établie, la connexion revient à HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="626ab-137">If an HTTP/2 connection isn't established, the connection falls back to HTTP/1.1.</span></span> <span data-ttu-id="626ab-138">Dans une prochaine version de Windows, les indicateurs de configuration HTTP/2 seront disponibles, y compris la possibilité de désactivation de HTTP/2 avec HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-138">In a future release of Windows, HTTP/2 configuration flags will be available, including the ability to disable HTTP/2 with HTTP.sys.</span></span>

## <a name="kernel-mode-authentication-with-kerberos"></a><span data-ttu-id="626ab-139">Authentification en mode noyau avec Kerberos</span><span class="sxs-lookup"><span data-stu-id="626ab-139">Kernel mode authentication with Kerberos</span></span>

<span data-ttu-id="626ab-140">HTTP.sys délègue l’authentification en mode noyau avec le protocole d’authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="626ab-140">HTTP.sys delegates to kernel mode authentication with the Kerberos authentication protocol.</span></span> <span data-ttu-id="626ab-141">L’authentification en mode utilisateur n’est pas prise en charge avec Kerberos et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-141">User mode authentication isn't supported with Kerberos and HTTP.sys.</span></span> <span data-ttu-id="626ab-142">Le compte d’ordinateur doit être utilisé pour déchiffrer le ticket/jeton Kerberos obtenu à partir d’Active Directory et transféré par le client au serveur afin d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-142">The machine account must be used to decrypt the Kerberos token/ticket that's obtained from Active Directory and forwarded by the client to the server to authenticate the user.</span></span> <span data-ttu-id="626ab-143">Inscrivez le nom de principal du service (SPN) pour l’hôte, et non l’utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-143">Register the Service Principal Name (SPN) for the host, not the user of the app.</span></span>

## <a name="how-to-use-httpsys"></a><span data-ttu-id="626ab-144">Comment utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-144">How to use HTTP.sys</span></span>

### <a name="configure-the-aspnet-core-app-to-use-httpsys"></a><span data-ttu-id="626ab-145">Configurer l’application ASP.NET Core afin d’utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-145">Configure the ASP.NET Core app to use HTTP.sys</span></span>

<span data-ttu-id="626ab-146">Appelez la méthode d’extension <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> au moment de générer l’hôte, en spécifiant les options <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions> nécessaires.</span><span class="sxs-lookup"><span data-stu-id="626ab-146">Call the <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> extension method when building the host, specifying any required <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions>.</span></span> <span data-ttu-id="626ab-147">L’exemple suivant définit les options sur leurs valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-147">The following example sets options to their default values:</span></span>

[!code-csharp[](httpsys/samples/3.x/SampleApp/Program.cs?name=snippet1&highlight=5-13)]

<span data-ttu-id="626ab-148">Le reste de la configuration de HTTP.sys est géré par le biais des [paramètres du Registre](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span><span class="sxs-lookup"><span data-stu-id="626ab-148">Additional HTTP.sys configuration is handled through [registry settings](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span>

<span data-ttu-id="626ab-149">**Options HTTP.sys**</span><span class="sxs-lookup"><span data-stu-id="626ab-149">**HTTP.sys options**</span></span>

| <span data-ttu-id="626ab-150">Propriété</span><span class="sxs-lookup"><span data-stu-id="626ab-150">Property</span></span> | <span data-ttu-id="626ab-151">Description</span><span class="sxs-lookup"><span data-stu-id="626ab-151">Description</span></span> | <span data-ttu-id="626ab-152">Default</span><span class="sxs-lookup"><span data-stu-id="626ab-152">Default</span></span> |
| -------- | ----------- | :-----: |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.AllowSynchronousIO> | <span data-ttu-id="626ab-153">Contrôle si l’entrée/sortie synchrone est autorisée pour le `HttpContext.Request.Body` et le `HttpContext.Response.Body`.</span><span class="sxs-lookup"><span data-stu-id="626ab-153">Control whether synchronous input/output is allowed for the `HttpContext.Request.Body` and `HttpContext.Response.Body`.</span></span> | `false` |
| [<span data-ttu-id="626ab-154">Authentication.AllowAnonymous</span><span class="sxs-lookup"><span data-stu-id="626ab-154">Authentication.AllowAnonymous</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.AllowAnonymous) | <span data-ttu-id="626ab-155">Autorise les requêtes anonymes.</span><span class="sxs-lookup"><span data-stu-id="626ab-155">Allow anonymous requests.</span></span> | `true` |
| [<span data-ttu-id="626ab-156">Authentication.Schemes</span><span class="sxs-lookup"><span data-stu-id="626ab-156">Authentication.Schemes</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.Schemes) | <span data-ttu-id="626ab-157">Spécifie les schémas d’authentification autorisés.</span><span class="sxs-lookup"><span data-stu-id="626ab-157">Specify the allowed authentication schemes.</span></span> <span data-ttu-id="626ab-158">Peut être modifié à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-158">May be modified at any time prior to disposing the listener.</span></span> <span data-ttu-id="626ab-159">Les valeurs sont fournies par l' [énumération AuthenticationSchemes](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic` , `Kerberos` ,, `Negotiate` `None` et `NTLM` .</span><span class="sxs-lookup"><span data-stu-id="626ab-159">Values are provided by the [AuthenticationSchemes enum](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic`, `Kerberos`, `Negotiate`, `None`, and `NTLM`.</span></span> | `None` |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.EnableResponseCaching> | <span data-ttu-id="626ab-160">Tente la mise en cache [en mode noyau](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) pour les réponses comportant un en-tête compatible.</span><span class="sxs-lookup"><span data-stu-id="626ab-160">Attempt [kernel-mode](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) caching for responses with eligible headers.</span></span> <span data-ttu-id="626ab-161">La réponse peut ne pas inclure d’en-tête `Set-Cookie`, `Vary` ou `Pragma`.</span><span class="sxs-lookup"><span data-stu-id="626ab-161">The response may not include `Set-Cookie`, `Vary`, or `Pragma` headers.</span></span> <span data-ttu-id="626ab-162">Elle doit comporter un en-tête `Cache-Control``public` et soit une valeur `shared-max-age` ou `max-age`, soit un en-tête `Expires`.</span><span class="sxs-lookup"><span data-stu-id="626ab-162">It must include a `Cache-Control` header that's `public` and either a `shared-max-age` or `max-age` value, or an `Expires` header.</span></span> | `true` |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.Http503Verbosity> | <span data-ttu-id="626ab-163">Le comportement de HTTP.sys lors du rejet des demandes en raison de conditions de limitation.</span><span class="sxs-lookup"><span data-stu-id="626ab-163">The HTTP.sys behavior when rejecting requests due to throttling conditions.</span></span> | [<span data-ttu-id="626ab-164">Http503VerbosityLevel. <br> Bases</span><span class="sxs-lookup"><span data-stu-id="626ab-164">Http503VerbosityLevel.<br>Basic</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.Http503VerbosityLevel) |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxAccepts> | <span data-ttu-id="626ab-165">Nombre maximal d'acceptations simultanées.</span><span class="sxs-lookup"><span data-stu-id="626ab-165">The maximum number of concurrent accepts.</span></span> | <span data-ttu-id="626ab-166">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span><span class="sxs-lookup"><span data-stu-id="626ab-166">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxConnections> | <span data-ttu-id="626ab-167">Nombre maximum de connexions simultanées à accepter.</span><span class="sxs-lookup"><span data-stu-id="626ab-167">The maximum number of concurrent connections to accept.</span></span> <span data-ttu-id="626ab-168">Utilisez `-1` pour signifier l’infini,</span><span class="sxs-lookup"><span data-stu-id="626ab-168">Use `-1` for infinite.</span></span> <span data-ttu-id="626ab-169">et `null` pour utiliser le paramètre du Registre qui s’applique à l’ordinateur dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="626ab-169">Use `null` to use the registry's machine-wide setting.</span></span> | `null`<br><span data-ttu-id="626ab-170">(au niveau de l’ordinateur</span><span class="sxs-lookup"><span data-stu-id="626ab-170">(machine-wide</span></span><br><span data-ttu-id="626ab-171">défini</span><span class="sxs-lookup"><span data-stu-id="626ab-171">setting)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> | <span data-ttu-id="626ab-172">Consultez la section <a href="#maxrequestbodysize">MaxRequestBodySize</a>.</span><span class="sxs-lookup"><span data-stu-id="626ab-172">See the <a href="#maxrequestbodysize">MaxRequestBodySize</a> section.</span></span> | <span data-ttu-id="626ab-173">30 000 000 octets</span><span class="sxs-lookup"><span data-stu-id="626ab-173">30000000 bytes</span></span><br><span data-ttu-id="626ab-174">(env. 28,6 Mo)</span><span class="sxs-lookup"><span data-stu-id="626ab-174">(~28.6 MB)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.RequestQueueLimit> | <span data-ttu-id="626ab-175">Nombre maximal de demandes pouvant être placées en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="626ab-175">The maximum number of requests that can be queued.</span></span> | <span data-ttu-id="626ab-176">1 000</span><span class="sxs-lookup"><span data-stu-id="626ab-176">1000</span></span> |
| `RequestQueueMode` | <span data-ttu-id="626ab-177">Cela indique si le serveur est responsable de la création et de la configuration de la file d’attente des demandes, ou s’il doit être attaché à une file d’attente existante.</span><span class="sxs-lookup"><span data-stu-id="626ab-177">This indicates whether the server is responsible for creating and configuring the request queue, or if it should attach to an existing queue.</span></span><br><span data-ttu-id="626ab-178">La plupart des options de configuration existantes ne s’appliquent pas lors de l’attachement à une file d’attente existante.</span><span class="sxs-lookup"><span data-stu-id="626ab-178">Most existing configuration options do not apply when attaching to an existing queue.</span></span> | `RequestQueueMode.Create` |
| `RequestQueueName` | <span data-ttu-id="626ab-179">Nom de la file d’attente de demandes de HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-179">The name of the HTTP.sys request queue.</span></span> | <span data-ttu-id="626ab-180">`null` (File d’attente anonyme)</span><span class="sxs-lookup"><span data-stu-id="626ab-180">`null` (Anonymous queue)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.ThrowWriteExceptions> | <span data-ttu-id="626ab-181">Indique si les écritures dans le corps de la réponse qui échouent en raison d’une déconnexion du client doivent lever des exceptions ou se terminer normalement.</span><span class="sxs-lookup"><span data-stu-id="626ab-181">Indicate if response body writes that fail due to client disconnects should throw exceptions or complete normally.</span></span> | `false`<br><span data-ttu-id="626ab-182">(se terminer normalement)</span><span class="sxs-lookup"><span data-stu-id="626ab-182">(complete normally)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.Timeouts> | <span data-ttu-id="626ab-183">Expose la configuration <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> de HTTP.sys, également paramétrable dans le Registre.</span><span class="sxs-lookup"><span data-stu-id="626ab-183">Expose the HTTP.sys <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> configuration, which may also be configured in the registry.</span></span> <span data-ttu-id="626ab-184">Suivez les liens de l’API pour en savoir plus sur chaque paramètre, y compris les valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-184">Follow the API links to learn more about each setting, including default values:</span></span><ul><li><span data-ttu-id="626ab-185"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody?displayProperty=nameWithType>: Temps accordé à l’API du serveur HTTP pour vider le corps d’entité sur une connexion Keep-Alive.</span><span class="sxs-lookup"><span data-stu-id="626ab-185"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody?displayProperty=nameWithType>: Time allowed for the HTTP Server API to drain the entity body on a Keep-Alive connection.</span></span></li><li><span data-ttu-id="626ab-186"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody?displayProperty=nameWithType>: Temps autorisé pour l’arrivée du corps d’entité de la requête.</span><span class="sxs-lookup"><span data-stu-id="626ab-186"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody?displayProperty=nameWithType>: Time allowed for the request entity body to arrive.</span></span></li><li><span data-ttu-id="626ab-187"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait?displayProperty=nameWithType>: Temps accordé à l’API du serveur HTTP pour analyser l’en-tête de la demande.</span><span class="sxs-lookup"><span data-stu-id="626ab-187"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait?displayProperty=nameWithType>: Time allowed for the HTTP Server API to parse the request header.</span></span></li><li><span data-ttu-id="626ab-188"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection?displayProperty=nameWithType>: Durée autorisée pour une connexion inactive.</span><span class="sxs-lookup"><span data-stu-id="626ab-188"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection?displayProperty=nameWithType>: Time allowed for an idle connection.</span></span></li><li><span data-ttu-id="626ab-189"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond?displayProperty=nameWithType>: Taux d’envoi minimal pour la réponse.</span><span class="sxs-lookup"><span data-stu-id="626ab-189"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond?displayProperty=nameWithType>: The minimum send rate for the response.</span></span></li><li><span data-ttu-id="626ab-190"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue?displayProperty=nameWithType>: Durée pendant laquelle la demande doit rester dans la file d’attente des demandes avant que l’application la récupère.</span><span class="sxs-lookup"><span data-stu-id="626ab-190"><xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue?displayProperty=nameWithType>: Time allowed for the request to remain in the request queue before the app picks it up.</span></span></li></ul> |  |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> | <span data-ttu-id="626ab-191">Spécifiez <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> à inscrire auprès de HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-191">Specify the <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> to register with HTTP.sys.</span></span> <span data-ttu-id="626ab-192">Le plus utile est <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add%2A?displayProperty=nameWithType> , qui est utilisé pour ajouter un préfixe à la collection.</span><span class="sxs-lookup"><span data-stu-id="626ab-192">The most useful is <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add%2A?displayProperty=nameWithType>, which is used to add a prefix to the collection.</span></span> <span data-ttu-id="626ab-193">Ces choix peuvent être modifiés à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-193">These may be modified at any time prior to disposing the listener.</span></span> |  |

<a name="maxrequestbodysize"></a>

<span data-ttu-id="626ab-194">**MaxRequestBodySize**</span><span class="sxs-lookup"><span data-stu-id="626ab-194">**MaxRequestBodySize**</span></span>

<span data-ttu-id="626ab-195">Taille maximale autorisée pour le corps d’une demande, en octets.</span><span class="sxs-lookup"><span data-stu-id="626ab-195">The maximum allowed size of any request body in bytes.</span></span> <span data-ttu-id="626ab-196">Lorsque la valeur est `null`, elle est illimitée.</span><span class="sxs-lookup"><span data-stu-id="626ab-196">When set to `null`, the maximum request body size is unlimited.</span></span> <span data-ttu-id="626ab-197">Cette limite est sans effet sur les connexions mises à niveau, qui sont illimitées.</span><span class="sxs-lookup"><span data-stu-id="626ab-197">This limit has no effect on upgraded connections, which are always unlimited.</span></span>

<span data-ttu-id="626ab-198">Pour remplacer la limite d’un seul `IActionResult` dans une application MVC ASP.NET Core, nous vous recommandons d’utiliser l’attribut <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> sur une méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="626ab-198">The recommended method to override the limit in an ASP.NET Core MVC app for a single `IActionResult` is to use the <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> attribute on an action method:</span></span>

```csharp
[RequestSizeLimit(100000000)]
public IActionResult MyActionMethod()
```

<span data-ttu-id="626ab-199">Une exception est levée si l’application tente de configurer la limite sur une demande dont l’application a commencé la lecture.</span><span class="sxs-lookup"><span data-stu-id="626ab-199">An exception is thrown if the app attempts to configure the limit on a request after the app has started reading the request.</span></span> <span data-ttu-id="626ab-200">La propriété `IsReadOnly` indique si la propriété `MaxRequestBodySize` est en lecture seule, et donc s’il est trop tard pour configurer la limite.</span><span class="sxs-lookup"><span data-stu-id="626ab-200">An `IsReadOnly` property can be used to indicate if the `MaxRequestBodySize` property is in a read-only state, meaning it's too late to configure the limit.</span></span>

<span data-ttu-id="626ab-201">Si l’application doit remplacer <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> par requête, utilisez <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature> :</span><span class="sxs-lookup"><span data-stu-id="626ab-201">If the app should override <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> per-request, use the <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature>:</span></span>

[!code-csharp[](httpsys/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=6-7)]

<span data-ttu-id="626ab-202">Si vous utilisez Visual Studio, vérifiez que l’application n’est pas configurée pour exécuter IIS ou IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-202">If using Visual Studio, make sure the app isn't configured to run IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-203">Dans Visual Studio, le profil de démarrage par défaut est destiné à IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-203">In Visual Studio, the default launch profile is for IIS Express.</span></span> <span data-ttu-id="626ab-204">Pour exécuter le projet en tant qu’application console, changez manuellement le profil sélectionné, comme dans la capture d’écran suivante :</span><span class="sxs-lookup"><span data-stu-id="626ab-204">To run the project as a console app, manually change the selected profile, as shown in the following screen shot:</span></span>

![Sélectionner le profil d’application console](httpsys/_static/vs-choose-profile.png)

### <a name="configure-windows-server"></a><span data-ttu-id="626ab-206">Configurer Windows Server</span><span class="sxs-lookup"><span data-stu-id="626ab-206">Configure Windows Server</span></span>

1. <span data-ttu-id="626ab-207">Identifiez les ports à ouvrir pour l’application et utilisez le [pare-feu Windows](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) ou les applets de commande PowerShell [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) pour ouvrir les ports du pare-feu et ainsi permettre au trafic d’atteindre HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-207">Determine the ports to open for the app and use [Windows Firewall](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) or the [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) PowerShell cmdlet to open firewall ports to allow traffic to reach HTTP.sys.</span></span> <span data-ttu-id="626ab-208">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-208">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-209">Lors du déploiement sur une machine virtuelle Azure, ouvrez les ports dans le [groupe de sécurité réseau](/azure/virtual-machines/windows/nsg-quickstart-portal).</span><span class="sxs-lookup"><span data-stu-id="626ab-209">When deploying to an Azure VM, open the ports in the [Network Security Group](/azure/virtual-machines/windows/nsg-quickstart-portal).</span></span> <span data-ttu-id="626ab-210">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-210">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-211">Obtenez et installez des certificats X.509, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="626ab-211">Obtain and install X.509 certificates, if required.</span></span>

   <span data-ttu-id="626ab-212">Sous Windows, créez des certificats auto-signés à l’aide de la [cmdlet PowerShell New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate).</span><span class="sxs-lookup"><span data-stu-id="626ab-212">On Windows, create self-signed certificates using the [New-SelfSignedCertificate PowerShell cmdlet](/powershell/module/pkiclient/new-selfsignedcertificate).</span></span> <span data-ttu-id="626ab-213">Vous trouverez un exemple non pris en charge sur la page [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span><span class="sxs-lookup"><span data-stu-id="626ab-213">For an unsupported example, see [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span></span>

   <span data-ttu-id="626ab-214">Installez des certificats auto-signés ou signés par l’autorité de certification dans le magasin **Ordinateur Local** > **Personnel** du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-214">Install either self-signed or CA-signed certificates in the server's **Local Machine** > **Personal** store.</span></span>

1. <span data-ttu-id="626ab-215">Si l’application est un [déploiement dépendant de .NET Framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), installez .NET Core, .NET Framework ou les deux (si l’application est une application .NET Core ciblant .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="626ab-215">If the app is a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), install .NET Core, .NET Framework, or both (if the app is a .NET Core app targeting the .NET Framework).</span></span>

   * <span data-ttu-id="626ab-216">**.Net Core**: si l’application requiert .net Core, obtenez et exécutez le programme d’installation du **Runtime .net Core** à partir des [téléchargements .net Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-216">**.NET Core**: If the app requires .NET Core, obtain and run the **.NET Core Runtime** installer from [.NET Core Downloads](https://dotnet.microsoft.com/download).</span></span> <span data-ttu-id="626ab-217">N’installez pas le Kit SDK complet sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-217">Don't install the full SDK on the server.</span></span>
   * <span data-ttu-id="626ab-218">**.NET Framework**: si l’application requiert des .NET Framework, consultez le [Guide d’installation de .NET Framework](/dotnet/framework/install/).</span><span class="sxs-lookup"><span data-stu-id="626ab-218">**.NET Framework**: If the app requires .NET Framework, see the [.NET Framework installation guide](/dotnet/framework/install/).</span></span> <span data-ttu-id="626ab-219">Installez la version requise de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="626ab-219">Install the required .NET Framework.</span></span> <span data-ttu-id="626ab-220">Le programme d’installation du .NET Framework le plus récent est disponible depuis la page [Téléchargements .NET Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-220">The installer for the latest .NET Framework is available from the [.NET Core Downloads](https://dotnet.microsoft.com/download) page.</span></span>

   <span data-ttu-id="626ab-221">Si l’application est un [déploiement autonome](/dotnet/core/deploying/#self-contained-deployments-scd), elle inclut le runtime dans son déploiement.</span><span class="sxs-lookup"><span data-stu-id="626ab-221">If the app is a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), the app includes the runtime in its deployment.</span></span> <span data-ttu-id="626ab-222">Aucune installation de framework n’est requise sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-222">No framework installation is required on the server.</span></span>

1. <span data-ttu-id="626ab-223">Configurez les ports et les URL de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-223">Configure URLs and ports in the app.</span></span>

   <span data-ttu-id="626ab-224">Par défaut, ASP.NET Core est lié à `http://localhost:5000`.</span><span class="sxs-lookup"><span data-stu-id="626ab-224">By default, ASP.NET Core binds to `http://localhost:5000`.</span></span> <span data-ttu-id="626ab-225">Pour configurer les ports et les préfixes d’URL, il existe plusieurs possibilités :</span><span class="sxs-lookup"><span data-stu-id="626ab-225">To configure URL prefixes and ports, options include:</span></span>

   * <xref:Microsoft.AspNetCore.Hosting.HostingAbstractionsWebHostBuilderExtensions.UseUrls*>
   * <span data-ttu-id="626ab-226">Arguments de ligne de commande `urls`</span><span class="sxs-lookup"><span data-stu-id="626ab-226">`urls` command-line argument</span></span>
   * <span data-ttu-id="626ab-227">`ASPNETCORE_URLS` variable d’environnement</span><span class="sxs-lookup"><span data-stu-id="626ab-227">`ASPNETCORE_URLS` environment variable</span></span>
   * <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes>

   <span data-ttu-id="626ab-228">L’exemple de code suivant montre comment utiliser <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> avec l’adresse IP locale du serveur `10.0.0.4` sur le port 443 :</span><span class="sxs-lookup"><span data-stu-id="626ab-228">The following code example shows how to use <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> with the server's local IP address `10.0.0.4` on port 443:</span></span>

   [!code-csharp[](httpsys/samples_snapshot/3.x/Program.cs?highlight=7)]

   <span data-ttu-id="626ab-229">`UrlPrefixes` présente l’avantage de générer immédiatement un message d’erreur en cas de préfixe mal formé.</span><span class="sxs-lookup"><span data-stu-id="626ab-229">An advantage of `UrlPrefixes` is that an error message is generated immediately for improperly formatted prefixes.</span></span>

   <span data-ttu-id="626ab-230">Les paramètres de `UrlPrefixes` remplacent les paramètres `UseUrls`/`urls`/`ASPNETCORE_URLS`.</span><span class="sxs-lookup"><span data-stu-id="626ab-230">The settings in `UrlPrefixes` override `UseUrls`/`urls`/`ASPNETCORE_URLS` settings.</span></span> <span data-ttu-id="626ab-231">Par conséquent, avec `UseUrls`, `urls` et la variable d’environnement `ASPNETCORE_URLS`, il est plus facile de basculer entre Kestrel et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-231">Therefore, an advantage of `UseUrls`, `urls`, and the `ASPNETCORE_URLS` environment variable is that it's easier to switch between Kestrel and HTTP.sys.</span></span>

   <span data-ttu-id="626ab-232">HTTP.sys utilise les [formats de chaîne UrlPrefix de l’API de serveur HTTP](/windows/win32/http/urlprefix-strings).</span><span class="sxs-lookup"><span data-stu-id="626ab-232">HTTP.sys uses the [HTTP Server API UrlPrefix string formats](/windows/win32/http/urlprefix-strings).</span></span>

   > [!WARNING]
   > <span data-ttu-id="626ab-233">Les liaisons génériques de niveau supérieur (`http://*:80/` et `http://+:80`) ne doivent **pas** être utilisées.</span><span class="sxs-lookup"><span data-stu-id="626ab-233">Top-level wildcard bindings (`http://*:80/` and `http://+:80`) should **not** be used.</span></span> <span data-ttu-id="626ab-234">Les liaisons génériques de niveau supérieur créent des failles de sécurité dans l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-234">Top-level wildcard bindings create app security vulnerabilities.</span></span> <span data-ttu-id="626ab-235">Cela s’applique aux caractères génériques forts et faibles.</span><span class="sxs-lookup"><span data-stu-id="626ab-235">This applies to both strong and weak wildcards.</span></span> <span data-ttu-id="626ab-236">Utilisez des noms d’hôte ou des adresses IP explicites plutôt que des caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="626ab-236">Use explicit host names or IP addresses rather than wildcards.</span></span> <span data-ttu-id="626ab-237">Une liaison générique de sous-domaine (par exemple, `*.mysub.com`) ne constitue pas un risque de sécurité si vous contrôlez le domaine parent en entier (par opposition à `*.com`, qui est vulnérable).</span><span class="sxs-lookup"><span data-stu-id="626ab-237">Subdomain wildcard binding (for example, `*.mysub.com`) isn't a security risk if you control the entire parent domain (as opposed to `*.com`, which is vulnerable).</span></span> <span data-ttu-id="626ab-238">Pour plus d’informations, consultez [RFC 7230 : Section 5,4 : Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span><span class="sxs-lookup"><span data-stu-id="626ab-238">For more information, see [RFC 7230: Section 5.4: Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span></span>

1. <span data-ttu-id="626ab-239">Préenregistrez les préfixes d’URL sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-239">Preregister URL prefixes on the server.</span></span>

   <span data-ttu-id="626ab-240">L’outil intégré pour configurer HTTP.sys est *netsh.exe*.</span><span class="sxs-lookup"><span data-stu-id="626ab-240">The built-in tool for configuring HTTP.sys is *netsh.exe*.</span></span> <span data-ttu-id="626ab-241">*netsh.exe* permet de réserver des préfixes d’URL et d’assigner des certificats X.509.</span><span class="sxs-lookup"><span data-stu-id="626ab-241">*netsh.exe* is used to reserve URL prefixes and assign X.509 certificates.</span></span> <span data-ttu-id="626ab-242">L’outil requiert des privilèges Administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-242">The tool requires administrator privileges.</span></span>

   <span data-ttu-id="626ab-243">Utilisez l’outil *netsh.exe* pour enregistrer les URL pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-243">Use the *netsh.exe* tool to register URLs for the app:</span></span>

   ```console
   netsh http add urlacl url=<URL> user=<USER>
   ```

   * <span data-ttu-id="626ab-244">`<URL>`: Le Uniform Resource Locator qualifié complet (URL).</span><span class="sxs-lookup"><span data-stu-id="626ab-244">`<URL>`: The fully qualified Uniform Resource Locator (URL).</span></span> <span data-ttu-id="626ab-245">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-245">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-246">Utilisez un nom d’hôte ou une adresse IP locale valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-246">Use a valid hostname or local IP address.</span></span> <span data-ttu-id="626ab-247">*L’URL doit inclure une barre oblique de fin.*</span><span class="sxs-lookup"><span data-stu-id="626ab-247">*The URL must include a trailing slash.*</span></span>
   * <span data-ttu-id="626ab-248">`<USER>`: Spécifie le nom d’utilisateur ou de groupe d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="626ab-248">`<USER>`: Specifies the user or user-group name.</span></span>

   <span data-ttu-id="626ab-249">Dans l’exemple suivant, l’adresse IP locale du serveur est `10.0.0.4` :</span><span class="sxs-lookup"><span data-stu-id="626ab-249">In the following example, the local IP address of the server is `10.0.0.4`:</span></span>

   ```console
   netsh http add urlacl url=https://10.0.0.4:443/ user=Users
   ```

   <span data-ttu-id="626ab-250">Lorsqu’une URL est inscrite, l’outil répond avec `URL reservation successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-250">When a URL is registered, the tool responds with `URL reservation successfully added`.</span></span>

   <span data-ttu-id="626ab-251">Pour supprimer une URL inscrite, utilisez la commande `delete urlacl` :</span><span class="sxs-lookup"><span data-stu-id="626ab-251">To delete a registered URL, use the `delete urlacl` command:</span></span>

   ```console
   netsh http delete urlacl url=<URL>
   ```

1. <span data-ttu-id="626ab-252">Inscrivez les certificats X.509 sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-252">Register X.509 certificates on the server.</span></span>

   <span data-ttu-id="626ab-253">Utilisez l’outil *netsh.exe* pour enregistrer les certificats pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-253">Use the *netsh.exe* tool to register certificates for the app:</span></span>

   ```console
   netsh http add sslcert ipport=<IP>:<PORT> certhash=<THUMBPRINT> appid="{<GUID>}"
   ```

   * <span data-ttu-id="626ab-254">`<IP>`: Spécifie l’adresse IP locale pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-254">`<IP>`: Specifies the local IP address for the binding.</span></span> <span data-ttu-id="626ab-255">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-255">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-256">Utilisez une adresse IP valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-256">Use a valid IP address.</span></span>
   * <span data-ttu-id="626ab-257">`<PORT>`: Spécifie le port pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-257">`<PORT>`: Specifies the port for the binding.</span></span>
   * <span data-ttu-id="626ab-258">`<THUMBPRINT>`: Empreinte numérique du certificat X. 509.</span><span class="sxs-lookup"><span data-stu-id="626ab-258">`<THUMBPRINT>`: The X.509 certificate thumbprint.</span></span>
   * <span data-ttu-id="626ab-259">`<GUID>`: GUID généré par le développeur pour représenter l’application à des fins d’information.</span><span class="sxs-lookup"><span data-stu-id="626ab-259">`<GUID>`: A developer-generated GUID to represent the app for informational purposes.</span></span>

   <span data-ttu-id="626ab-260">À titre de référence, stockez le GUID dans l’application en tant que balise de package :</span><span class="sxs-lookup"><span data-stu-id="626ab-260">For reference purposes, store the GUID in the app as a package tag:</span></span>

   * <span data-ttu-id="626ab-261">Dans Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-261">In Visual Studio:</span></span>
     * <span data-ttu-id="626ab-262">Ouvrez les propriétés du projet de l’application en cliquant avec le bouton droit sur l’application dans **l’Explorateur de solutions** et en sélectionnant **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="626ab-262">Open the app's project properties by right-clicking on the app in **Solution Explorer** and selecting **Properties**.</span></span>
     * <span data-ttu-id="626ab-263">Sélectionnez l’onglet **Package**.</span><span class="sxs-lookup"><span data-stu-id="626ab-263">Select the **Package** tab.</span></span>
     * <span data-ttu-id="626ab-264">Entrez le GUID que vous avez créé dans le champ **Balises**.</span><span class="sxs-lookup"><span data-stu-id="626ab-264">Enter the GUID that you created in the **Tags** field.</span></span>
   * <span data-ttu-id="626ab-265">Si vous n’utilisez pas Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-265">When not using Visual Studio:</span></span>
     * <span data-ttu-id="626ab-266">Ouvrez le chemin d’accès vers le fichier de projet de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-266">Open the app's project file.</span></span>
     * <span data-ttu-id="626ab-267">Ajoutez une propriété `<PackageTags>` à un `<PropertyGroup>` nouveau ou existant avec le GUID que vous avez créé :</span><span class="sxs-lookup"><span data-stu-id="626ab-267">Add a `<PackageTags>` property to a new or existing `<PropertyGroup>` with the GUID that you created:</span></span>

       ```xml
       <PropertyGroup>
         <PackageTags>9412ee86-c21b-4eb8-bd89-f650fbf44931</PackageTags>
       </PropertyGroup>
       ```

   <span data-ttu-id="626ab-268">Dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="626ab-268">In the following example:</span></span>

   * <span data-ttu-id="626ab-269">L’adresse IP locale du serveur est `10.0.0.4`.</span><span class="sxs-lookup"><span data-stu-id="626ab-269">The local IP address of the server is `10.0.0.4`.</span></span>
   * <span data-ttu-id="626ab-270">Un générateur de GUID aléatoire en ligne fournit la valeur `appid`.</span><span class="sxs-lookup"><span data-stu-id="626ab-270">An online random GUID generator provides the `appid` value.</span></span>

   ```console
   netsh http add sslcert 
       ipport=10.0.0.4:443 
       certhash=b66ee04419d4ee37464ab8785ff02449980eae10 
       appid="{9412ee86-c21b-4eb8-bd89-f650fbf44931}"
   ```

   <span data-ttu-id="626ab-271">Lorsqu’un certificat est inscrit, l’outil répond avec `SSL Certificate successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-271">When a certificate is registered, the tool responds with `SSL Certificate successfully added`.</span></span>

   <span data-ttu-id="626ab-272">Pour supprimer l’inscription d’un certificat, utilisez la commande `delete sslcert` :</span><span class="sxs-lookup"><span data-stu-id="626ab-272">To delete a certificate registration, use the `delete sslcert` command:</span></span>

   ```console
   netsh http delete sslcert ipport=<IP>:<PORT>
   ```

   <span data-ttu-id="626ab-273">Documentation de référence de *netsh.exe* :</span><span class="sxs-lookup"><span data-stu-id="626ab-273">Reference documentation for *netsh.exe*:</span></span>

   * <span data-ttu-id="626ab-274">[Commandes netsh pour le protocole HTTP (Hypertext Transfer Protocol)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="626ab-274">[Netsh Commands for Hypertext Transfer Protocol (HTTP)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span></span>
   * [<span data-ttu-id="626ab-275">Chaînes UrlPrefix</span><span class="sxs-lookup"><span data-stu-id="626ab-275">UrlPrefix Strings</span></span>](/windows/win32/http/urlprefix-strings)

1. <span data-ttu-id="626ab-276">Exécutez l'application.</span><span class="sxs-lookup"><span data-stu-id="626ab-276">Run the app.</span></span>

   <span data-ttu-id="626ab-277">Les privilèges administrateur ne sont pas requis pour exécuter l’application lors d’une liaison à localhost à l’aide de HTTP (pas HTTPS) avec un numéro de port supérieur à 1024.</span><span class="sxs-lookup"><span data-stu-id="626ab-277">Administrator privileges aren't required to run the app when binding to localhost using HTTP (not HTTPS) with a port number greater than 1024.</span></span> <span data-ttu-id="626ab-278">Pour les autres configurations (par exemple, l’utilisation d’une adresse IP locale ou la liaison au port 443), exécutez l’application avec des privilèges administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-278">For other configurations (for example, using a local IP address or binding to port 443), run the app with administrator privileges.</span></span>

   <span data-ttu-id="626ab-279">L’application répond à l’adresse IP publique du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-279">The app responds at the server's public IP address.</span></span> <span data-ttu-id="626ab-280">Dans cet exemple, le serveur est contacté à partir d’Internet à son adresse IP publique `104.214.79.47`.</span><span class="sxs-lookup"><span data-stu-id="626ab-280">In this example, the server is reached from the Internet at its public IP address of `104.214.79.47`.</span></span>

   <span data-ttu-id="626ab-281">Un certificat de développement est utilisé dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="626ab-281">A development certificate is used in this example.</span></span> <span data-ttu-id="626ab-282">La page est chargée en toute sécurité après le contournement de l’avertissement de certificat non approuvé du navigateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-282">The page loads securely after bypassing the browser's untrusted certificate warning.</span></span>

   ![Fenêtre de navigateur affichant la page Index de l’application chargée](httpsys/_static/browser.png)

## <a name="proxy-server-and-load-balancer-scenarios"></a><span data-ttu-id="626ab-284">Scénarios avec un serveur proxy et un équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="626ab-284">Proxy server and load balancer scenarios</span></span>

<span data-ttu-id="626ab-285">Pour les applications hébergées par HTTP.sys qui interagissent avec les demandes provenant d’Internet ou d’un réseau d’entreprise, une configuration supplémentaire peut être nécessaire en cas d’hébergement derrière des serveurs proxy et des équilibreurs de charge.</span><span class="sxs-lookup"><span data-stu-id="626ab-285">For apps hosted by HTTP.sys that interact with requests from the Internet or a corporate network, additional configuration might be required when hosting behind proxy servers and load balancers.</span></span> <span data-ttu-id="626ab-286">Pour plus d’informations, consultez l’article [Configurer ASP.NET Core pour l’utilisation de serveurs proxy et d’équilibreurs de charge](xref:host-and-deploy/proxy-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="626ab-286">For more information, see [Configure ASP.NET Core to work with proxy servers and load balancers](xref:host-and-deploy/proxy-load-balancer).</span></span>

## <a name="advanced-http2-features-to-support-grpc"></a><span data-ttu-id="626ab-287">Fonctionnalités HTTP/2 avancées pour la prise en charge de gRPC</span><span class="sxs-lookup"><span data-stu-id="626ab-287">Advanced HTTP/2 features to support gRPC</span></span>

<span data-ttu-id="626ab-288">Des fonctionnalités HTTP/2 supplémentaires dans HTTP.sys prennent en charge gRPC, notamment la prise en charge des codes de fin de réponse et l’envoi d’images de réinitialisation.</span><span class="sxs-lookup"><span data-stu-id="626ab-288">Additional HTTP/2 features in HTTP.sys support gRPC, including support for response trailers and sending reset frames.</span></span>

<span data-ttu-id="626ab-289">Configuration requise pour exécuter gRPC avec HTTP.sys :</span><span class="sxs-lookup"><span data-stu-id="626ab-289">Requirements to run gRPC with HTTP.sys:</span></span>

* <span data-ttu-id="626ab-290">Windows 10, version 19041,508 ou ultérieure du système d’exploitation</span><span class="sxs-lookup"><span data-stu-id="626ab-290">Windows 10, OS Build 19041.508 or later</span></span>
* <span data-ttu-id="626ab-291">TLS 1.2 ou connexion ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-291">TLS 1.2 or later connection</span></span>

### <a name="trailers"></a><span data-ttu-id="626ab-292">Bandes-annonce</span><span class="sxs-lookup"><span data-stu-id="626ab-292">Trailers</span></span>

[!INCLUDE[](~/includes/trailers.md)]

### <a name="reset"></a><span data-ttu-id="626ab-293">Réinitialiser</span><span class="sxs-lookup"><span data-stu-id="626ab-293">Reset</span></span>

[!INCLUDE[](~/includes/reset.md)]

## <a name="additional-resources"></a><span data-ttu-id="626ab-294">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="626ab-294">Additional resources</span></span>

* [<span data-ttu-id="626ab-295">Activer l’authentification Windows avec HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-295">Enable Windows Authentication with HTTP.sys</span></span>](xref:security/authentication/windowsauth#httpsys)
* [<span data-ttu-id="626ab-296">API de serveur HTTP</span><span class="sxs-lookup"><span data-stu-id="626ab-296">HTTP Server API</span></span>](/windows/win32/http/http-api-start-page)
* [<span data-ttu-id="626ab-297">Référentiel GitHub aspnet/HttpSysServer (code source)</span><span class="sxs-lookup"><span data-stu-id="626ab-297">aspnet/HttpSysServer GitHub repository (source code)</span></span>](https://github.com/aspnet/HttpSysServer/)
* [<span data-ttu-id="626ab-298">L’hôte</span><span class="sxs-lookup"><span data-stu-id="626ab-298">The host</span></span>](xref:fundamentals/index#host)
* <xref:test/troubleshoot>

::: moniker-end

::: moniker range="= aspnetcore-3.0"

<span data-ttu-id="626ab-299">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) est un [serveur web pour ASP.NET Core](xref:fundamentals/servers/index) qui s’exécute uniquement sous Windows.</span><span class="sxs-lookup"><span data-stu-id="626ab-299">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) is a [web server for ASP.NET Core](xref:fundamentals/servers/index) that only runs on Windows.</span></span> <span data-ttu-id="626ab-300">HTTP.sys est une alternative au serveur [Kestrel](xref:fundamentals/servers/kestrel) et offre des fonctionnalités supplémentaires par rapport à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="626ab-300">HTTP.sys is an alternative to [Kestrel](xref:fundamentals/servers/kestrel) server and offers some features that Kestrel doesn't provide.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="626ab-301">HTTP.sys est incompatible avec le [Module ASP.NET Core](xref:host-and-deploy/aspnet-core-module) et n’est pas utilisable avec IIS ni IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-301">HTTP.sys isn't compatible with the [ASP.NET Core Module](xref:host-and-deploy/aspnet-core-module) and can't be used with IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-302">HTTP.sys prend en charge les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="626ab-302">HTTP.sys supports the following features:</span></span>

* [<span data-ttu-id="626ab-303">Authentification Windows</span><span class="sxs-lookup"><span data-stu-id="626ab-303">Windows Authentication</span></span>](xref:security/authentication/windowsauth)
* <span data-ttu-id="626ab-304">Partage de port</span><span class="sxs-lookup"><span data-stu-id="626ab-304">Port sharing</span></span>
* <span data-ttu-id="626ab-305">HTTPS avec SNI</span><span class="sxs-lookup"><span data-stu-id="626ab-305">HTTPS with SNI</span></span>
* <span data-ttu-id="626ab-306">HTTP/2 sur TLS (Windows 10 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-306">HTTP/2 over TLS (Windows 10 or later)</span></span>
* <span data-ttu-id="626ab-307">Transmission de fichier directe</span><span class="sxs-lookup"><span data-stu-id="626ab-307">Direct file transmission</span></span>
* <span data-ttu-id="626ab-308">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="626ab-308">Response caching</span></span>
* <span data-ttu-id="626ab-309">WebSockets (Windows 8 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-309">WebSockets (Windows 8 or later)</span></span>

<span data-ttu-id="626ab-310">Versions de Windows prises en charge :</span><span class="sxs-lookup"><span data-stu-id="626ab-310">Supported Windows versions:</span></span>

* <span data-ttu-id="626ab-311">Windows 7 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-311">Windows 7 or later</span></span>
* <span data-ttu-id="626ab-312">Windows Server 2008 R2 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-312">Windows Server 2008 R2 or later</span></span>

<span data-ttu-id="626ab-313">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="626ab-313">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="when-to-use-httpsys"></a><span data-ttu-id="626ab-314">Quand utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-314">When to use HTTP.sys</span></span>

<span data-ttu-id="626ab-315">HTTP.sys est utile pour les déploiements lorsque :</span><span class="sxs-lookup"><span data-stu-id="626ab-315">HTTP.sys is useful for deployments where:</span></span>

* <span data-ttu-id="626ab-316">Il est nécessaire d’exposer directement le serveur à Internet sans passer par IIS.</span><span class="sxs-lookup"><span data-stu-id="626ab-316">There's a need to expose the server directly to the Internet without using IIS.</span></span>

  ![HTTP.sys communique directement avec Internet](httpsys/_static/httpsys-to-internet.png)

* <span data-ttu-id="626ab-318">Un déploiement interne implique une fonctionnalité qui n’est pas disponible dans Kestrel, par exemple, [l’authentification Windows](xref:security/authentication/windowsauth).</span><span class="sxs-lookup"><span data-stu-id="626ab-318">An internal deployment requires a feature not available in Kestrel, such as [Windows Authentication](xref:security/authentication/windowsauth).</span></span>

  ![HTTP.sys communique directement avec le réseau interne](httpsys/_static/httpsys-to-internal.png)

<span data-ttu-id="626ab-320">HTTP.sys est une technologie aboutie qui assure une protection contre de nombreux types d’attaques et offre la robustesse, la sécurité et l’extensibilité d’un serveur web haut de gamme.</span><span class="sxs-lookup"><span data-stu-id="626ab-320">HTTP.sys is mature technology that protects against many types of attacks and provides the robustness, security, and scalability of a full-featured web server.</span></span> <span data-ttu-id="626ab-321">Pour sa part, IIS s’exécute en tant qu’écouteur HTTP sur HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-321">IIS itself runs as an HTTP listener on top of HTTP.sys.</span></span>

## <a name="http2-support"></a><span data-ttu-id="626ab-322">Assistance HTTP/2</span><span class="sxs-lookup"><span data-stu-id="626ab-322">HTTP/2 support</span></span>

<span data-ttu-id="626ab-323">[HTTP/2](https://httpwg.org/specs/rfc7540.html) est activé pour les applications ASP.NET Core si les conditions de base suivantes sont remplies :</span><span class="sxs-lookup"><span data-stu-id="626ab-323">[HTTP/2](https://httpwg.org/specs/rfc7540.html) is enabled for ASP.NET Core apps if the following base requirements are met:</span></span>

* <span data-ttu-id="626ab-324">Windows Server 2016/Windows 10 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-324">Windows Server 2016/Windows 10 or later</span></span>
* <span data-ttu-id="626ab-325">Connexion [ALPN (Application-Layer Protocol Negotiation)](https://tools.ietf.org/html/rfc7301#section-3)</span><span class="sxs-lookup"><span data-stu-id="626ab-325">[Application-Layer Protocol Negotiation (ALPN)](https://tools.ietf.org/html/rfc7301#section-3) connection</span></span>
* <span data-ttu-id="626ab-326">TLS 1.2 ou connexion ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-326">TLS 1.2 or later connection</span></span>

<span data-ttu-id="626ab-327">Si une connexion HTTP/2 est établie, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) retourne `HTTP/2`.</span><span class="sxs-lookup"><span data-stu-id="626ab-327">If an HTTP/2 connection is established, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) reports `HTTP/2`.</span></span>

<span data-ttu-id="626ab-328">HTTP/2 est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="626ab-328">HTTP/2 is enabled by default.</span></span> <span data-ttu-id="626ab-329">Si une connexion HTTP/2 n’est pas établie, la connexion revient à HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="626ab-329">If an HTTP/2 connection isn't established, the connection falls back to HTTP/1.1.</span></span> <span data-ttu-id="626ab-330">Dans une prochaine version de Windows, les indicateurs de configuration HTTP/2 seront disponibles, y compris la possibilité de désactivation de HTTP/2 avec HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-330">In a future release of Windows, HTTP/2 configuration flags will be available, including the ability to disable HTTP/2 with HTTP.sys.</span></span>

## <a name="kernel-mode-authentication-with-kerberos"></a><span data-ttu-id="626ab-331">Authentification en mode noyau avec Kerberos</span><span class="sxs-lookup"><span data-stu-id="626ab-331">Kernel mode authentication with Kerberos</span></span>

<span data-ttu-id="626ab-332">HTTP.sys délègue l’authentification en mode noyau avec le protocole d’authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="626ab-332">HTTP.sys delegates to kernel mode authentication with the Kerberos authentication protocol.</span></span> <span data-ttu-id="626ab-333">L’authentification en mode utilisateur n’est pas prise en charge avec Kerberos et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-333">User mode authentication isn't supported with Kerberos and HTTP.sys.</span></span> <span data-ttu-id="626ab-334">Le compte d’ordinateur doit être utilisé pour déchiffrer le ticket/jeton Kerberos obtenu à partir d’Active Directory et transféré par le client au serveur afin d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-334">The machine account must be used to decrypt the Kerberos token/ticket that's obtained from Active Directory and forwarded by the client to the server to authenticate the user.</span></span> <span data-ttu-id="626ab-335">Inscrivez le nom de principal du service (SPN) pour l’hôte, et non l’utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-335">Register the Service Principal Name (SPN) for the host, not the user of the app.</span></span>

## <a name="how-to-use-httpsys"></a><span data-ttu-id="626ab-336">Comment utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-336">How to use HTTP.sys</span></span>

### <a name="configure-the-aspnet-core-app-to-use-httpsys"></a><span data-ttu-id="626ab-337">Configurer l’application ASP.NET Core afin d’utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-337">Configure the ASP.NET Core app to use HTTP.sys</span></span>

<span data-ttu-id="626ab-338">Appelez la méthode d’extension <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> au moment de générer l’hôte, en spécifiant les options <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions> nécessaires.</span><span class="sxs-lookup"><span data-stu-id="626ab-338">Call the <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> extension method when building the host, specifying any required <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions>.</span></span> <span data-ttu-id="626ab-339">L’exemple suivant définit les options sur leurs valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-339">The following example sets options to their default values:</span></span>

[!code-csharp[](httpsys/samples/3.x/SampleApp/Program.cs?name=snippet1&highlight=5-13)]

<span data-ttu-id="626ab-340">Le reste de la configuration de HTTP.sys est géré par le biais des [paramètres du Registre](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span><span class="sxs-lookup"><span data-stu-id="626ab-340">Additional HTTP.sys configuration is handled through [registry settings](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span>

<span data-ttu-id="626ab-341">**Options HTTP.sys**</span><span class="sxs-lookup"><span data-stu-id="626ab-341">**HTTP.sys options**</span></span>

| <span data-ttu-id="626ab-342">Propriété</span><span class="sxs-lookup"><span data-stu-id="626ab-342">Property</span></span> | <span data-ttu-id="626ab-343">Description</span><span class="sxs-lookup"><span data-stu-id="626ab-343">Description</span></span> | <span data-ttu-id="626ab-344">Default</span><span class="sxs-lookup"><span data-stu-id="626ab-344">Default</span></span> |
| -------- | ----------- | :-----: |
| [<span data-ttu-id="626ab-345">AllowSynchronousIO</span><span class="sxs-lookup"><span data-stu-id="626ab-345">AllowSynchronousIO</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.AllowSynchronousIO) | <span data-ttu-id="626ab-346">Contrôle si l’entrée/sortie synchrone est autorisée pour le `HttpContext.Request.Body` et le `HttpContext.Response.Body`.</span><span class="sxs-lookup"><span data-stu-id="626ab-346">Control whether synchronous input/output is allowed for the `HttpContext.Request.Body` and `HttpContext.Response.Body`.</span></span> | `false` |
| [<span data-ttu-id="626ab-347">Authentication.AllowAnonymous</span><span class="sxs-lookup"><span data-stu-id="626ab-347">Authentication.AllowAnonymous</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.AllowAnonymous) | <span data-ttu-id="626ab-348">Autorise les requêtes anonymes.</span><span class="sxs-lookup"><span data-stu-id="626ab-348">Allow anonymous requests.</span></span> | `true` |
| [<span data-ttu-id="626ab-349">Authentication.Schemes</span><span class="sxs-lookup"><span data-stu-id="626ab-349">Authentication.Schemes</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.Schemes) | <span data-ttu-id="626ab-350">Spécifie les schémas d’authentification autorisés.</span><span class="sxs-lookup"><span data-stu-id="626ab-350">Specify the allowed authentication schemes.</span></span> <span data-ttu-id="626ab-351">Peut être modifié à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-351">May be modified at any time prior to disposing the listener.</span></span> <span data-ttu-id="626ab-352">Les valeurs sont fournies par l' [énumération AuthenticationSchemes](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic` , `Kerberos` ,, `Negotiate` `None` et `NTLM` .</span><span class="sxs-lookup"><span data-stu-id="626ab-352">Values are provided by the [AuthenticationSchemes enum](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic`, `Kerberos`, `Negotiate`, `None`, and `NTLM`.</span></span> | `None` |
| [<span data-ttu-id="626ab-353">EnableResponseCaching</span><span class="sxs-lookup"><span data-stu-id="626ab-353">EnableResponseCaching</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.EnableResponseCaching) | <span data-ttu-id="626ab-354">Tente la mise en cache [en mode noyau](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) pour les réponses comportant un en-tête compatible.</span><span class="sxs-lookup"><span data-stu-id="626ab-354">Attempt [kernel-mode](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) caching for responses with eligible headers.</span></span> <span data-ttu-id="626ab-355">La réponse peut ne pas inclure d’en-tête `Set-Cookie`, `Vary` ou `Pragma`.</span><span class="sxs-lookup"><span data-stu-id="626ab-355">The response may not include `Set-Cookie`, `Vary`, or `Pragma` headers.</span></span> <span data-ttu-id="626ab-356">Elle doit comporter un en-tête `Cache-Control``public` et soit une valeur `shared-max-age` ou `max-age`, soit un en-tête `Expires`.</span><span class="sxs-lookup"><span data-stu-id="626ab-356">It must include a `Cache-Control` header that's `public` and either a `shared-max-age` or `max-age` value, or an `Expires` header.</span></span> | `true` |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxAccepts> | <span data-ttu-id="626ab-357">Nombre maximal d'acceptations simultanées.</span><span class="sxs-lookup"><span data-stu-id="626ab-357">The maximum number of concurrent accepts.</span></span> | <span data-ttu-id="626ab-358">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span><span class="sxs-lookup"><span data-stu-id="626ab-358">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxConnections> | <span data-ttu-id="626ab-359">Nombre maximum de connexions simultanées à accepter.</span><span class="sxs-lookup"><span data-stu-id="626ab-359">The maximum number of concurrent connections to accept.</span></span> <span data-ttu-id="626ab-360">Utilisez `-1` pour signifier l’infini,</span><span class="sxs-lookup"><span data-stu-id="626ab-360">Use `-1` for infinite.</span></span> <span data-ttu-id="626ab-361">et `null` pour utiliser le paramètre du Registre qui s’applique à l’ordinateur dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="626ab-361">Use `null` to use the registry's machine-wide setting.</span></span> | `null`<br><span data-ttu-id="626ab-362">(au niveau de l’ordinateur</span><span class="sxs-lookup"><span data-stu-id="626ab-362">(machine-wide</span></span><br><span data-ttu-id="626ab-363">défini</span><span class="sxs-lookup"><span data-stu-id="626ab-363">setting)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> | <span data-ttu-id="626ab-364">Consultez la section <a href="#maxrequestbodysize">MaxRequestBodySize</a>.</span><span class="sxs-lookup"><span data-stu-id="626ab-364">See the <a href="#maxrequestbodysize">MaxRequestBodySize</a> section.</span></span> | <span data-ttu-id="626ab-365">30 000 000 octets</span><span class="sxs-lookup"><span data-stu-id="626ab-365">30000000 bytes</span></span><br><span data-ttu-id="626ab-366">(env. 28,6 Mo)</span><span class="sxs-lookup"><span data-stu-id="626ab-366">(~28.6 MB)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.RequestQueueLimit> | <span data-ttu-id="626ab-367">Nombre maximal de demandes pouvant être placées en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="626ab-367">The maximum number of requests that can be queued.</span></span> | <span data-ttu-id="626ab-368">1 000</span><span class="sxs-lookup"><span data-stu-id="626ab-368">1000</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.ThrowWriteExceptions> | <span data-ttu-id="626ab-369">Indique si les écritures dans le corps de la réponse qui échouent en raison d’une déconnexion du client doivent lever des exceptions ou se terminer normalement.</span><span class="sxs-lookup"><span data-stu-id="626ab-369">Indicate if response body writes that fail due to client disconnects should throw exceptions or complete normally.</span></span> | `false`<br><span data-ttu-id="626ab-370">(se terminer normalement)</span><span class="sxs-lookup"><span data-stu-id="626ab-370">(complete normally)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.Timeouts> | <span data-ttu-id="626ab-371">Expose la configuration <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> de HTTP.sys, également paramétrable dans le Registre.</span><span class="sxs-lookup"><span data-stu-id="626ab-371">Expose the HTTP.sys <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> configuration, which may also be configured in the registry.</span></span> <span data-ttu-id="626ab-372">Suivez les liens de l’API pour en savoir plus sur chaque paramètre, y compris les valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-372">Follow the API links to learn more about each setting, including default values:</span></span><ul><li><span data-ttu-id="626ab-373">[TimeoutManager. DrainEntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody): temps accordé à l’API du serveur http pour vider le corps d’entité sur une connexion Keep-Alive.</span><span class="sxs-lookup"><span data-stu-id="626ab-373">[TimeoutManager.DrainEntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody): Time allowed for the HTTP Server API to drain the entity body on a Keep-Alive connection.</span></span></li><li><span data-ttu-id="626ab-374">[TimeoutManager. EntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody): temps autorisé pour l’arrivée du corps d’entité de la requête.</span><span class="sxs-lookup"><span data-stu-id="626ab-374">[TimeoutManager.EntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody): Time allowed for the request entity body to arrive.</span></span></li><li><span data-ttu-id="626ab-375">[TimeoutManager. HeaderWait](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait): temps accordé à l’API du serveur http pour analyser l’en-tête de la demande.</span><span class="sxs-lookup"><span data-stu-id="626ab-375">[TimeoutManager.HeaderWait](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait): Time allowed for the HTTP Server API to parse the request header.</span></span></li><li><span data-ttu-id="626ab-376">[TimeoutManager. IdleConnection](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection): temps autorisé pour une connexion inactive.</span><span class="sxs-lookup"><span data-stu-id="626ab-376">[TimeoutManager.IdleConnection](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection): Time allowed for an idle connection.</span></span></li><li><span data-ttu-id="626ab-377">[TimeoutManager. MinSendBytesPerSecond](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond): taux d’envoi minimal pour la réponse.</span><span class="sxs-lookup"><span data-stu-id="626ab-377">[TimeoutManager.MinSendBytesPerSecond](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond): The minimum send rate for the response.</span></span></li><li><span data-ttu-id="626ab-378">[TimeoutManager. RequestQueue](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue): temps pendant lequel la demande doit rester dans la file d’attente des demandes avant que l’application la récupère.</span><span class="sxs-lookup"><span data-stu-id="626ab-378">[TimeoutManager.RequestQueue](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue): Time allowed for the request to remain in the request queue before the app picks it up.</span></span></li></ul> |  |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> | <span data-ttu-id="626ab-379">Spécifiez <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> à inscrire auprès de HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-379">Specify the <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> to register with HTTP.sys.</span></span> <span data-ttu-id="626ab-380">La plus utile est [UrlPrefixCollection.Add](xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add*), qui permet d’ajouter un préfixe à la collection.</span><span class="sxs-lookup"><span data-stu-id="626ab-380">The most useful is [UrlPrefixCollection.Add](xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add*), which is used to add a prefix to the collection.</span></span> <span data-ttu-id="626ab-381">Ces choix peuvent être modifiés à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-381">These may be modified at any time prior to disposing the listener.</span></span> |  |

<a name="maxrequestbodysize"></a>

<span data-ttu-id="626ab-382">**MaxRequestBodySize**</span><span class="sxs-lookup"><span data-stu-id="626ab-382">**MaxRequestBodySize**</span></span>

<span data-ttu-id="626ab-383">Taille maximale autorisée pour le corps d’une demande, en octets.</span><span class="sxs-lookup"><span data-stu-id="626ab-383">The maximum allowed size of any request body in bytes.</span></span> <span data-ttu-id="626ab-384">Lorsque la valeur est `null`, elle est illimitée.</span><span class="sxs-lookup"><span data-stu-id="626ab-384">When set to `null`, the maximum request body size is unlimited.</span></span> <span data-ttu-id="626ab-385">Cette limite est sans effet sur les connexions mises à niveau, qui sont illimitées.</span><span class="sxs-lookup"><span data-stu-id="626ab-385">This limit has no effect on upgraded connections, which are always unlimited.</span></span>

<span data-ttu-id="626ab-386">Pour remplacer la limite d’un seul `IActionResult` dans une application MVC ASP.NET Core, nous vous recommandons d’utiliser l’attribut <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> sur une méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="626ab-386">The recommended method to override the limit in an ASP.NET Core MVC app for a single `IActionResult` is to use the <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> attribute on an action method:</span></span>

```csharp
[RequestSizeLimit(100000000)]
public IActionResult MyActionMethod()
```

<span data-ttu-id="626ab-387">Une exception est levée si l’application tente de configurer la limite sur une demande dont l’application a commencé la lecture.</span><span class="sxs-lookup"><span data-stu-id="626ab-387">An exception is thrown if the app attempts to configure the limit on a request after the app has started reading the request.</span></span> <span data-ttu-id="626ab-388">La propriété `IsReadOnly` indique si la propriété `MaxRequestBodySize` est en lecture seule, et donc s’il est trop tard pour configurer la limite.</span><span class="sxs-lookup"><span data-stu-id="626ab-388">An `IsReadOnly` property can be used to indicate if the `MaxRequestBodySize` property is in a read-only state, meaning it's too late to configure the limit.</span></span>

<span data-ttu-id="626ab-389">Si l’application doit remplacer <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> par requête, utilisez <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature> :</span><span class="sxs-lookup"><span data-stu-id="626ab-389">If the app should override <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> per-request, use the <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature>:</span></span>

[!code-csharp[](httpsys/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=6-7)]

<span data-ttu-id="626ab-390">Si vous utilisez Visual Studio, vérifiez que l’application n’est pas configurée pour exécuter IIS ou IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-390">If using Visual Studio, make sure the app isn't configured to run IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-391">Dans Visual Studio, le profil de démarrage par défaut est destiné à IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-391">In Visual Studio, the default launch profile is for IIS Express.</span></span> <span data-ttu-id="626ab-392">Pour exécuter le projet en tant qu’application console, changez manuellement le profil sélectionné, comme dans la capture d’écran suivante :</span><span class="sxs-lookup"><span data-stu-id="626ab-392">To run the project as a console app, manually change the selected profile, as shown in the following screen shot:</span></span>

![Sélectionner le profil d’application console](httpsys/_static/vs-choose-profile.png)

### <a name="configure-windows-server"></a><span data-ttu-id="626ab-394">Configurer Windows Server</span><span class="sxs-lookup"><span data-stu-id="626ab-394">Configure Windows Server</span></span>

1. <span data-ttu-id="626ab-395">Identifiez les ports à ouvrir pour l’application et utilisez le [pare-feu Windows](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) ou les applets de commande PowerShell [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) pour ouvrir les ports du pare-feu et ainsi permettre au trafic d’atteindre HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-395">Determine the ports to open for the app and use [Windows Firewall](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) or the [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) PowerShell cmdlet to open firewall ports to allow traffic to reach HTTP.sys.</span></span> <span data-ttu-id="626ab-396">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-396">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-397">Lors du déploiement sur une machine virtuelle Azure, ouvrez les ports dans le [groupe de sécurité réseau](/azure/virtual-machines/windows/nsg-quickstart-portal).</span><span class="sxs-lookup"><span data-stu-id="626ab-397">When deploying to an Azure VM, open the ports in the [Network Security Group](/azure/virtual-machines/windows/nsg-quickstart-portal).</span></span> <span data-ttu-id="626ab-398">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-398">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-399">Obtenez et installez des certificats X.509, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="626ab-399">Obtain and install X.509 certificates, if required.</span></span>

   <span data-ttu-id="626ab-400">Sous Windows, créez des certificats auto-signés à l’aide de la [cmdlet PowerShell New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate).</span><span class="sxs-lookup"><span data-stu-id="626ab-400">On Windows, create self-signed certificates using the [New-SelfSignedCertificate PowerShell cmdlet](/powershell/module/pkiclient/new-selfsignedcertificate).</span></span> <span data-ttu-id="626ab-401">Vous trouverez un exemple non pris en charge sur la page [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span><span class="sxs-lookup"><span data-stu-id="626ab-401">For an unsupported example, see [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span></span>

   <span data-ttu-id="626ab-402">Installez des certificats auto-signés ou signés par l’autorité de certification dans le magasin **Ordinateur Local** > **Personnel** du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-402">Install either self-signed or CA-signed certificates in the server's **Local Machine** > **Personal** store.</span></span>

1. <span data-ttu-id="626ab-403">Si l’application est un [déploiement dépendant de .NET Framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), installez .NET Core, .NET Framework ou les deux (si l’application est une application .NET Core ciblant .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="626ab-403">If the app is a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), install .NET Core, .NET Framework, or both (if the app is a .NET Core app targeting the .NET Framework).</span></span>

   * <span data-ttu-id="626ab-404">**.Net Core**: si l’application requiert .net Core, obtenez et exécutez le programme d’installation du **Runtime .net Core** à partir des [téléchargements .net Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-404">**.NET Core**: If the app requires .NET Core, obtain and run the **.NET Core Runtime** installer from [.NET Core Downloads](https://dotnet.microsoft.com/download).</span></span> <span data-ttu-id="626ab-405">N’installez pas le Kit SDK complet sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-405">Don't install the full SDK on the server.</span></span>
   * <span data-ttu-id="626ab-406">**.NET Framework**: si l’application requiert des .NET Framework, consultez le [Guide d’installation de .NET Framework](/dotnet/framework/install/).</span><span class="sxs-lookup"><span data-stu-id="626ab-406">**.NET Framework**: If the app requires .NET Framework, see the [.NET Framework installation guide](/dotnet/framework/install/).</span></span> <span data-ttu-id="626ab-407">Installez la version requise de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="626ab-407">Install the required .NET Framework.</span></span> <span data-ttu-id="626ab-408">Le programme d’installation du .NET Framework le plus récent est disponible depuis la page [Téléchargements .NET Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-408">The installer for the latest .NET Framework is available from the [.NET Core Downloads](https://dotnet.microsoft.com/download) page.</span></span>

   <span data-ttu-id="626ab-409">Si l’application est un [déploiement autonome](/dotnet/core/deploying/#self-contained-deployments-scd), elle inclut le runtime dans son déploiement.</span><span class="sxs-lookup"><span data-stu-id="626ab-409">If the app is a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), the app includes the runtime in its deployment.</span></span> <span data-ttu-id="626ab-410">Aucune installation de framework n’est requise sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-410">No framework installation is required on the server.</span></span>

1. <span data-ttu-id="626ab-411">Configurez les ports et les URL de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-411">Configure URLs and ports in the app.</span></span>

   <span data-ttu-id="626ab-412">Par défaut, ASP.NET Core est lié à `http://localhost:5000`.</span><span class="sxs-lookup"><span data-stu-id="626ab-412">By default, ASP.NET Core binds to `http://localhost:5000`.</span></span> <span data-ttu-id="626ab-413">Pour configurer les ports et les préfixes d’URL, il existe plusieurs possibilités :</span><span class="sxs-lookup"><span data-stu-id="626ab-413">To configure URL prefixes and ports, options include:</span></span>

   * <xref:Microsoft.AspNetCore.Hosting.HostingAbstractionsWebHostBuilderExtensions.UseUrls*>
   * <span data-ttu-id="626ab-414">Arguments de ligne de commande `urls`</span><span class="sxs-lookup"><span data-stu-id="626ab-414">`urls` command-line argument</span></span>
   * <span data-ttu-id="626ab-415">`ASPNETCORE_URLS` variable d’environnement</span><span class="sxs-lookup"><span data-stu-id="626ab-415">`ASPNETCORE_URLS` environment variable</span></span>
   * <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes>

   <span data-ttu-id="626ab-416">L’exemple de code suivant montre comment utiliser <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> avec l’adresse IP locale du serveur `10.0.0.4` sur le port 443 :</span><span class="sxs-lookup"><span data-stu-id="626ab-416">The following code example shows how to use <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> with the server's local IP address `10.0.0.4` on port 443:</span></span>

   [!code-csharp[](httpsys/samples_snapshot/3.x/Program.cs?highlight=7)]

   <span data-ttu-id="626ab-417">`UrlPrefixes` présente l’avantage de générer immédiatement un message d’erreur en cas de préfixe mal formé.</span><span class="sxs-lookup"><span data-stu-id="626ab-417">An advantage of `UrlPrefixes` is that an error message is generated immediately for improperly formatted prefixes.</span></span>

   <span data-ttu-id="626ab-418">Les paramètres de `UrlPrefixes` remplacent les paramètres `UseUrls`/`urls`/`ASPNETCORE_URLS`.</span><span class="sxs-lookup"><span data-stu-id="626ab-418">The settings in `UrlPrefixes` override `UseUrls`/`urls`/`ASPNETCORE_URLS` settings.</span></span> <span data-ttu-id="626ab-419">Par conséquent, avec `UseUrls`, `urls` et la variable d’environnement `ASPNETCORE_URLS`, il est plus facile de basculer entre Kestrel et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-419">Therefore, an advantage of `UseUrls`, `urls`, and the `ASPNETCORE_URLS` environment variable is that it's easier to switch between Kestrel and HTTP.sys.</span></span>

   <span data-ttu-id="626ab-420">HTTP.sys utilise les [formats de chaîne UrlPrefix de l’API de serveur HTTP](/windows/win32/http/urlprefix-strings).</span><span class="sxs-lookup"><span data-stu-id="626ab-420">HTTP.sys uses the [HTTP Server API UrlPrefix string formats](/windows/win32/http/urlprefix-strings).</span></span>

   > [!WARNING]
   > <span data-ttu-id="626ab-421">Les liaisons génériques de niveau supérieur (`http://*:80/` et `http://+:80`) ne doivent **pas** être utilisées.</span><span class="sxs-lookup"><span data-stu-id="626ab-421">Top-level wildcard bindings (`http://*:80/` and `http://+:80`) should **not** be used.</span></span> <span data-ttu-id="626ab-422">Les liaisons génériques de niveau supérieur créent des failles de sécurité dans l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-422">Top-level wildcard bindings create app security vulnerabilities.</span></span> <span data-ttu-id="626ab-423">Cela s’applique aux caractères génériques forts et faibles.</span><span class="sxs-lookup"><span data-stu-id="626ab-423">This applies to both strong and weak wildcards.</span></span> <span data-ttu-id="626ab-424">Utilisez des noms d’hôte ou des adresses IP explicites plutôt que des caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="626ab-424">Use explicit host names or IP addresses rather than wildcards.</span></span> <span data-ttu-id="626ab-425">Une liaison générique de sous-domaine (par exemple, `*.mysub.com`) ne constitue pas un risque de sécurité si vous contrôlez le domaine parent en entier (par opposition à `*.com`, qui est vulnérable).</span><span class="sxs-lookup"><span data-stu-id="626ab-425">Subdomain wildcard binding (for example, `*.mysub.com`) isn't a security risk if you control the entire parent domain (as opposed to `*.com`, which is vulnerable).</span></span> <span data-ttu-id="626ab-426">Pour plus d’informations, consultez [RFC 7230 : Section 5,4 : Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span><span class="sxs-lookup"><span data-stu-id="626ab-426">For more information, see [RFC 7230: Section 5.4: Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span></span>

1. <span data-ttu-id="626ab-427">Préenregistrez les préfixes d’URL sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-427">Preregister URL prefixes on the server.</span></span>

   <span data-ttu-id="626ab-428">L’outil intégré pour configurer HTTP.sys est *netsh.exe*.</span><span class="sxs-lookup"><span data-stu-id="626ab-428">The built-in tool for configuring HTTP.sys is *netsh.exe*.</span></span> <span data-ttu-id="626ab-429">*netsh.exe* permet de réserver des préfixes d’URL et d’assigner des certificats X.509.</span><span class="sxs-lookup"><span data-stu-id="626ab-429">*netsh.exe* is used to reserve URL prefixes and assign X.509 certificates.</span></span> <span data-ttu-id="626ab-430">L’outil requiert des privilèges Administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-430">The tool requires administrator privileges.</span></span>

   <span data-ttu-id="626ab-431">Utilisez l’outil *netsh.exe* pour enregistrer les URL pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-431">Use the *netsh.exe* tool to register URLs for the app:</span></span>

   ```console
   netsh http add urlacl url=<URL> user=<USER>
   ```

   * <span data-ttu-id="626ab-432">`<URL>`: Le Uniform Resource Locator qualifié complet (URL).</span><span class="sxs-lookup"><span data-stu-id="626ab-432">`<URL>`: The fully qualified Uniform Resource Locator (URL).</span></span> <span data-ttu-id="626ab-433">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-433">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-434">Utilisez un nom d’hôte ou une adresse IP locale valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-434">Use a valid hostname or local IP address.</span></span> <span data-ttu-id="626ab-435">*L’URL doit inclure une barre oblique de fin.*</span><span class="sxs-lookup"><span data-stu-id="626ab-435">*The URL must include a trailing slash.*</span></span>
   * <span data-ttu-id="626ab-436">`<USER>`: Spécifie le nom d’utilisateur ou de groupe d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="626ab-436">`<USER>`: Specifies the user or user-group name.</span></span>

   <span data-ttu-id="626ab-437">Dans l’exemple suivant, l’adresse IP locale du serveur est `10.0.0.4` :</span><span class="sxs-lookup"><span data-stu-id="626ab-437">In the following example, the local IP address of the server is `10.0.0.4`:</span></span>

   ```console
   netsh http add urlacl url=https://10.0.0.4:443/ user=Users
   ```

   <span data-ttu-id="626ab-438">Lorsqu’une URL est inscrite, l’outil répond avec `URL reservation successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-438">When a URL is registered, the tool responds with `URL reservation successfully added`.</span></span>

   <span data-ttu-id="626ab-439">Pour supprimer une URL inscrite, utilisez la commande `delete urlacl` :</span><span class="sxs-lookup"><span data-stu-id="626ab-439">To delete a registered URL, use the `delete urlacl` command:</span></span>

   ```console
   netsh http delete urlacl url=<URL>
   ```

1. <span data-ttu-id="626ab-440">Inscrivez les certificats X.509 sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-440">Register X.509 certificates on the server.</span></span>

   <span data-ttu-id="626ab-441">Utilisez l’outil *netsh.exe* pour enregistrer les certificats pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-441">Use the *netsh.exe* tool to register certificates for the app:</span></span>

   ```console
   netsh http add sslcert ipport=<IP>:<PORT> certhash=<THUMBPRINT> appid="{<GUID>}"
   ```

   * <span data-ttu-id="626ab-442">`<IP>`: Spécifie l’adresse IP locale pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-442">`<IP>`: Specifies the local IP address for the binding.</span></span> <span data-ttu-id="626ab-443">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-443">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-444">Utilisez une adresse IP valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-444">Use a valid IP address.</span></span>
   * <span data-ttu-id="626ab-445">`<PORT>`: Spécifie le port pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-445">`<PORT>`: Specifies the port for the binding.</span></span>
   * <span data-ttu-id="626ab-446">`<THUMBPRINT>`: Empreinte numérique du certificat X. 509.</span><span class="sxs-lookup"><span data-stu-id="626ab-446">`<THUMBPRINT>`: The X.509 certificate thumbprint.</span></span>
   * <span data-ttu-id="626ab-447">`<GUID>`: GUID généré par le développeur pour représenter l’application à des fins d’information.</span><span class="sxs-lookup"><span data-stu-id="626ab-447">`<GUID>`: A developer-generated GUID to represent the app for informational purposes.</span></span>

   <span data-ttu-id="626ab-448">À titre de référence, stockez le GUID dans l’application en tant que balise de package :</span><span class="sxs-lookup"><span data-stu-id="626ab-448">For reference purposes, store the GUID in the app as a package tag:</span></span>

   * <span data-ttu-id="626ab-449">Dans Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-449">In Visual Studio:</span></span>
     * <span data-ttu-id="626ab-450">Ouvrez les propriétés du projet de l’application en cliquant avec le bouton droit sur l’application dans **l’Explorateur de solutions** et en sélectionnant **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="626ab-450">Open the app's project properties by right-clicking on the app in **Solution Explorer** and selecting **Properties**.</span></span>
     * <span data-ttu-id="626ab-451">Sélectionnez l’onglet **Package**.</span><span class="sxs-lookup"><span data-stu-id="626ab-451">Select the **Package** tab.</span></span>
     * <span data-ttu-id="626ab-452">Entrez le GUID que vous avez créé dans le champ **Balises**.</span><span class="sxs-lookup"><span data-stu-id="626ab-452">Enter the GUID that you created in the **Tags** field.</span></span>
   * <span data-ttu-id="626ab-453">Si vous n’utilisez pas Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-453">When not using Visual Studio:</span></span>
     * <span data-ttu-id="626ab-454">Ouvrez le chemin d’accès vers le fichier de projet de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-454">Open the app's project file.</span></span>
     * <span data-ttu-id="626ab-455">Ajoutez une propriété `<PackageTags>` à un `<PropertyGroup>` nouveau ou existant avec le GUID que vous avez créé :</span><span class="sxs-lookup"><span data-stu-id="626ab-455">Add a `<PackageTags>` property to a new or existing `<PropertyGroup>` with the GUID that you created:</span></span>

       ```xml
       <PropertyGroup>
         <PackageTags>9412ee86-c21b-4eb8-bd89-f650fbf44931</PackageTags>
       </PropertyGroup>
       ```

   <span data-ttu-id="626ab-456">Dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="626ab-456">In the following example:</span></span>

   * <span data-ttu-id="626ab-457">L’adresse IP locale du serveur est `10.0.0.4`.</span><span class="sxs-lookup"><span data-stu-id="626ab-457">The local IP address of the server is `10.0.0.4`.</span></span>
   * <span data-ttu-id="626ab-458">Un générateur de GUID aléatoire en ligne fournit la valeur `appid`.</span><span class="sxs-lookup"><span data-stu-id="626ab-458">An online random GUID generator provides the `appid` value.</span></span>

   ```console
   netsh http add sslcert 
       ipport=10.0.0.4:443 
       certhash=b66ee04419d4ee37464ab8785ff02449980eae10 
       appid="{9412ee86-c21b-4eb8-bd89-f650fbf44931}"
   ```

   <span data-ttu-id="626ab-459">Lorsqu’un certificat est inscrit, l’outil répond avec `SSL Certificate successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-459">When a certificate is registered, the tool responds with `SSL Certificate successfully added`.</span></span>

   <span data-ttu-id="626ab-460">Pour supprimer l’inscription d’un certificat, utilisez la commande `delete sslcert` :</span><span class="sxs-lookup"><span data-stu-id="626ab-460">To delete a certificate registration, use the `delete sslcert` command:</span></span>

   ```console
   netsh http delete sslcert ipport=<IP>:<PORT>
   ```

   <span data-ttu-id="626ab-461">Documentation de référence de *netsh.exe* :</span><span class="sxs-lookup"><span data-stu-id="626ab-461">Reference documentation for *netsh.exe*:</span></span>

   * <span data-ttu-id="626ab-462">[Commandes netsh pour le protocole HTTP (Hypertext Transfer Protocol)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="626ab-462">[Netsh Commands for Hypertext Transfer Protocol (HTTP)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span></span>
   * [<span data-ttu-id="626ab-463">Chaînes UrlPrefix</span><span class="sxs-lookup"><span data-stu-id="626ab-463">UrlPrefix Strings</span></span>](/windows/win32/http/urlprefix-strings)

1. <span data-ttu-id="626ab-464">Exécutez l'application.</span><span class="sxs-lookup"><span data-stu-id="626ab-464">Run the app.</span></span>

   <span data-ttu-id="626ab-465">Les privilèges administrateur ne sont pas requis pour exécuter l’application lors d’une liaison à localhost à l’aide de HTTP (pas HTTPS) avec un numéro de port supérieur à 1024.</span><span class="sxs-lookup"><span data-stu-id="626ab-465">Administrator privileges aren't required to run the app when binding to localhost using HTTP (not HTTPS) with a port number greater than 1024.</span></span> <span data-ttu-id="626ab-466">Pour les autres configurations (par exemple, l’utilisation d’une adresse IP locale ou la liaison au port 443), exécutez l’application avec des privilèges administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-466">For other configurations (for example, using a local IP address or binding to port 443), run the app with administrator privileges.</span></span>

   <span data-ttu-id="626ab-467">L’application répond à l’adresse IP publique du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-467">The app responds at the server's public IP address.</span></span> <span data-ttu-id="626ab-468">Dans cet exemple, le serveur est contacté à partir d’Internet à son adresse IP publique `104.214.79.47`.</span><span class="sxs-lookup"><span data-stu-id="626ab-468">In this example, the server is reached from the Internet at its public IP address of `104.214.79.47`.</span></span>

   <span data-ttu-id="626ab-469">Un certificat de développement est utilisé dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="626ab-469">A development certificate is used in this example.</span></span> <span data-ttu-id="626ab-470">La page est chargée en toute sécurité après le contournement de l’avertissement de certificat non approuvé du navigateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-470">The page loads securely after bypassing the browser's untrusted certificate warning.</span></span>

   ![Fenêtre de navigateur affichant la page Index de l’application chargée](httpsys/_static/browser.png)

## <a name="proxy-server-and-load-balancer-scenarios"></a><span data-ttu-id="626ab-472">Scénarios avec un serveur proxy et un équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="626ab-472">Proxy server and load balancer scenarios</span></span>

<span data-ttu-id="626ab-473">Pour les applications hébergées par HTTP.sys qui interagissent avec les demandes provenant d’Internet ou d’un réseau d’entreprise, une configuration supplémentaire peut être nécessaire en cas d’hébergement derrière des serveurs proxy et des équilibreurs de charge.</span><span class="sxs-lookup"><span data-stu-id="626ab-473">For apps hosted by HTTP.sys that interact with requests from the Internet or a corporate network, additional configuration might be required when hosting behind proxy servers and load balancers.</span></span> <span data-ttu-id="626ab-474">Pour plus d’informations, consultez l’article [Configurer ASP.NET Core pour l’utilisation de serveurs proxy et d’équilibreurs de charge](xref:host-and-deploy/proxy-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="626ab-474">For more information, see [Configure ASP.NET Core to work with proxy servers and load balancers](xref:host-and-deploy/proxy-load-balancer).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="626ab-475">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="626ab-475">Additional resources</span></span>

* [<span data-ttu-id="626ab-476">Activer l’authentification Windows avec HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-476">Enable Windows Authentication with HTTP.sys</span></span>](xref:security/authentication/windowsauth#httpsys)
* [<span data-ttu-id="626ab-477">API de serveur HTTP</span><span class="sxs-lookup"><span data-stu-id="626ab-477">HTTP Server API</span></span>](/windows/win32/http/http-api-start-page)
* [<span data-ttu-id="626ab-478">Référentiel GitHub aspnet/HttpSysServer (code source)</span><span class="sxs-lookup"><span data-stu-id="626ab-478">aspnet/HttpSysServer GitHub repository (source code)</span></span>](https://github.com/aspnet/HttpSysServer/)
* [<span data-ttu-id="626ab-479">L’hôte</span><span class="sxs-lookup"><span data-stu-id="626ab-479">The host</span></span>](xref:fundamentals/index#host)
* <xref:test/troubleshoot>

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="626ab-480">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) est un [serveur web pour ASP.NET Core](xref:fundamentals/servers/index) qui s’exécute uniquement sous Windows.</span><span class="sxs-lookup"><span data-stu-id="626ab-480">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) is a [web server for ASP.NET Core](xref:fundamentals/servers/index) that only runs on Windows.</span></span> <span data-ttu-id="626ab-481">HTTP.sys est une alternative au serveur [Kestrel](xref:fundamentals/servers/kestrel) et offre des fonctionnalités supplémentaires par rapport à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="626ab-481">HTTP.sys is an alternative to [Kestrel](xref:fundamentals/servers/kestrel) server and offers some features that Kestrel doesn't provide.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="626ab-482">HTTP.sys est incompatible avec le [Module ASP.NET Core](xref:host-and-deploy/aspnet-core-module) et n’est pas utilisable avec IIS ni IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-482">HTTP.sys isn't compatible with the [ASP.NET Core Module](xref:host-and-deploy/aspnet-core-module) and can't be used with IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-483">HTTP.sys prend en charge les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="626ab-483">HTTP.sys supports the following features:</span></span>

* [<span data-ttu-id="626ab-484">Authentification Windows</span><span class="sxs-lookup"><span data-stu-id="626ab-484">Windows Authentication</span></span>](xref:security/authentication/windowsauth)
* <span data-ttu-id="626ab-485">Partage de port</span><span class="sxs-lookup"><span data-stu-id="626ab-485">Port sharing</span></span>
* <span data-ttu-id="626ab-486">HTTPS avec SNI</span><span class="sxs-lookup"><span data-stu-id="626ab-486">HTTPS with SNI</span></span>
* <span data-ttu-id="626ab-487">HTTP/2 sur TLS (Windows 10 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-487">HTTP/2 over TLS (Windows 10 or later)</span></span>
* <span data-ttu-id="626ab-488">Transmission de fichier directe</span><span class="sxs-lookup"><span data-stu-id="626ab-488">Direct file transmission</span></span>
* <span data-ttu-id="626ab-489">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="626ab-489">Response caching</span></span>
* <span data-ttu-id="626ab-490">WebSockets (Windows 8 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-490">WebSockets (Windows 8 or later)</span></span>

<span data-ttu-id="626ab-491">Versions de Windows prises en charge :</span><span class="sxs-lookup"><span data-stu-id="626ab-491">Supported Windows versions:</span></span>

* <span data-ttu-id="626ab-492">Windows 7 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-492">Windows 7 or later</span></span>
* <span data-ttu-id="626ab-493">Windows Server 2008 R2 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-493">Windows Server 2008 R2 or later</span></span>

<span data-ttu-id="626ab-494">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="626ab-494">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="when-to-use-httpsys"></a><span data-ttu-id="626ab-495">Quand utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-495">When to use HTTP.sys</span></span>

<span data-ttu-id="626ab-496">HTTP.sys est utile pour les déploiements lorsque :</span><span class="sxs-lookup"><span data-stu-id="626ab-496">HTTP.sys is useful for deployments where:</span></span>

* <span data-ttu-id="626ab-497">Il est nécessaire d’exposer directement le serveur à Internet sans passer par IIS.</span><span class="sxs-lookup"><span data-stu-id="626ab-497">There's a need to expose the server directly to the Internet without using IIS.</span></span>

  ![HTTP.sys communique directement avec Internet](httpsys/_static/httpsys-to-internet.png)

* <span data-ttu-id="626ab-499">Un déploiement interne implique une fonctionnalité qui n’est pas disponible dans Kestrel, par exemple, [l’authentification Windows](xref:security/authentication/windowsauth).</span><span class="sxs-lookup"><span data-stu-id="626ab-499">An internal deployment requires a feature not available in Kestrel, such as [Windows Authentication](xref:security/authentication/windowsauth).</span></span>

  ![HTTP.sys communique directement avec le réseau interne](httpsys/_static/httpsys-to-internal.png)

<span data-ttu-id="626ab-501">HTTP.sys est une technologie aboutie qui assure une protection contre de nombreux types d’attaques et offre la robustesse, la sécurité et l’extensibilité d’un serveur web haut de gamme.</span><span class="sxs-lookup"><span data-stu-id="626ab-501">HTTP.sys is mature technology that protects against many types of attacks and provides the robustness, security, and scalability of a full-featured web server.</span></span> <span data-ttu-id="626ab-502">Pour sa part, IIS s’exécute en tant qu’écouteur HTTP sur HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-502">IIS itself runs as an HTTP listener on top of HTTP.sys.</span></span>

## <a name="http2-support"></a><span data-ttu-id="626ab-503">Assistance HTTP/2</span><span class="sxs-lookup"><span data-stu-id="626ab-503">HTTP/2 support</span></span>

<span data-ttu-id="626ab-504">[HTTP/2](https://httpwg.org/specs/rfc7540.html) est activé pour les applications ASP.NET Core si les conditions de base suivantes sont remplies :</span><span class="sxs-lookup"><span data-stu-id="626ab-504">[HTTP/2](https://httpwg.org/specs/rfc7540.html) is enabled for ASP.NET Core apps if the following base requirements are met:</span></span>

* <span data-ttu-id="626ab-505">Windows Server 2016/Windows 10 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-505">Windows Server 2016/Windows 10 or later</span></span>
* <span data-ttu-id="626ab-506">Connexion [ALPN (Application-Layer Protocol Negotiation)](https://tools.ietf.org/html/rfc7301#section-3)</span><span class="sxs-lookup"><span data-stu-id="626ab-506">[Application-Layer Protocol Negotiation (ALPN)](https://tools.ietf.org/html/rfc7301#section-3) connection</span></span>
* <span data-ttu-id="626ab-507">TLS 1.2 ou connexion ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-507">TLS 1.2 or later connection</span></span>

<span data-ttu-id="626ab-508">Si une connexion HTTP/2 est établie, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) retourne `HTTP/2`.</span><span class="sxs-lookup"><span data-stu-id="626ab-508">If an HTTP/2 connection is established, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) reports `HTTP/2`.</span></span>

<span data-ttu-id="626ab-509">HTTP/2 est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="626ab-509">HTTP/2 is enabled by default.</span></span> <span data-ttu-id="626ab-510">Si une connexion HTTP/2 n’est pas établie, la connexion revient à HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="626ab-510">If an HTTP/2 connection isn't established, the connection falls back to HTTP/1.1.</span></span> <span data-ttu-id="626ab-511">Dans une prochaine version de Windows, les indicateurs de configuration HTTP/2 seront disponibles, y compris la possibilité de désactivation de HTTP/2 avec HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-511">In a future release of Windows, HTTP/2 configuration flags will be available, including the ability to disable HTTP/2 with HTTP.sys.</span></span>

## <a name="kernel-mode-authentication-with-kerberos"></a><span data-ttu-id="626ab-512">Authentification en mode noyau avec Kerberos</span><span class="sxs-lookup"><span data-stu-id="626ab-512">Kernel mode authentication with Kerberos</span></span>

<span data-ttu-id="626ab-513">HTTP.sys délègue l’authentification en mode noyau avec le protocole d’authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="626ab-513">HTTP.sys delegates to kernel mode authentication with the Kerberos authentication protocol.</span></span> <span data-ttu-id="626ab-514">L’authentification en mode utilisateur n’est pas prise en charge avec Kerberos et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-514">User mode authentication isn't supported with Kerberos and HTTP.sys.</span></span> <span data-ttu-id="626ab-515">Le compte d’ordinateur doit être utilisé pour déchiffrer le ticket/jeton Kerberos obtenu à partir d’Active Directory et transféré par le client au serveur afin d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-515">The machine account must be used to decrypt the Kerberos token/ticket that's obtained from Active Directory and forwarded by the client to the server to authenticate the user.</span></span> <span data-ttu-id="626ab-516">Inscrivez le nom de principal du service (SPN) pour l’hôte, et non l’utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-516">Register the Service Principal Name (SPN) for the host, not the user of the app.</span></span>

## <a name="how-to-use-httpsys"></a><span data-ttu-id="626ab-517">Comment utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-517">How to use HTTP.sys</span></span>

### <a name="configure-the-aspnet-core-app-to-use-httpsys"></a><span data-ttu-id="626ab-518">Configurer l’application ASP.NET Core afin d’utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-518">Configure the ASP.NET Core app to use HTTP.sys</span></span>

<span data-ttu-id="626ab-519">Une référence de package dans le fichier projet n’est pas requise lors de l’utilisation de l' [offre Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) ([NuGet.org](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)).</span><span class="sxs-lookup"><span data-stu-id="626ab-519">A package reference in the project file isn't required when using the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) ([nuget.org](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)).</span></span> <span data-ttu-id="626ab-520">Si vous n'utilisez pas le métapaquet `Microsoft.AspNetCore.App`, ajoutez une référence de package à [Microsoft.AspNetCore.Server.HttpSys](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.HttpSys/).</span><span class="sxs-lookup"><span data-stu-id="626ab-520">When not using the `Microsoft.AspNetCore.App` metapackage, add a package reference to [Microsoft.AspNetCore.Server.HttpSys](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.HttpSys/).</span></span>

<span data-ttu-id="626ab-521">Appelez la méthode d’extension <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> au moment de générer l’hôte, en spécifiant les options <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions> nécessaires.</span><span class="sxs-lookup"><span data-stu-id="626ab-521">Call the <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> extension method when building the host, specifying any required <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions>.</span></span> <span data-ttu-id="626ab-522">L’exemple suivant définit les options sur leurs valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-522">The following example sets options to their default values:</span></span>

[!code-csharp[](httpsys/samples/2.x/SampleApp/Program.cs?name=snippet1&highlight=4-12)]

<span data-ttu-id="626ab-523">Le reste de la configuration de HTTP.sys est géré par le biais des [paramètres du Registre](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span><span class="sxs-lookup"><span data-stu-id="626ab-523">Additional HTTP.sys configuration is handled through [registry settings](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span>

<span data-ttu-id="626ab-524">**Options HTTP.sys**</span><span class="sxs-lookup"><span data-stu-id="626ab-524">**HTTP.sys options**</span></span>

| <span data-ttu-id="626ab-525">Propriété</span><span class="sxs-lookup"><span data-stu-id="626ab-525">Property</span></span> | <span data-ttu-id="626ab-526">Description</span><span class="sxs-lookup"><span data-stu-id="626ab-526">Description</span></span> | <span data-ttu-id="626ab-527">Default</span><span class="sxs-lookup"><span data-stu-id="626ab-527">Default</span></span> |
| -------- | ----------- | :-----: |
| [<span data-ttu-id="626ab-528">AllowSynchronousIO</span><span class="sxs-lookup"><span data-stu-id="626ab-528">AllowSynchronousIO</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.AllowSynchronousIO) | <span data-ttu-id="626ab-529">Contrôle si l’entrée/sortie synchrone est autorisée pour le `HttpContext.Request.Body` et le `HttpContext.Response.Body`.</span><span class="sxs-lookup"><span data-stu-id="626ab-529">Control whether synchronous input/output is allowed for the `HttpContext.Request.Body` and `HttpContext.Response.Body`.</span></span> | `true` |
| [<span data-ttu-id="626ab-530">Authentication.AllowAnonymous</span><span class="sxs-lookup"><span data-stu-id="626ab-530">Authentication.AllowAnonymous</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.AllowAnonymous) | <span data-ttu-id="626ab-531">Autorise les requêtes anonymes.</span><span class="sxs-lookup"><span data-stu-id="626ab-531">Allow anonymous requests.</span></span> | `true` |
| [<span data-ttu-id="626ab-532">Authentication.Schemes</span><span class="sxs-lookup"><span data-stu-id="626ab-532">Authentication.Schemes</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.Schemes) | <span data-ttu-id="626ab-533">Spécifie les schémas d’authentification autorisés.</span><span class="sxs-lookup"><span data-stu-id="626ab-533">Specify the allowed authentication schemes.</span></span> <span data-ttu-id="626ab-534">Peut être modifié à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-534">May be modified at any time prior to disposing the listener.</span></span> <span data-ttu-id="626ab-535">Les valeurs sont fournies par l' [énumération AuthenticationSchemes](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic` , `Kerberos` ,, `Negotiate` `None` et `NTLM` .</span><span class="sxs-lookup"><span data-stu-id="626ab-535">Values are provided by the [AuthenticationSchemes enum](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic`, `Kerberos`, `Negotiate`, `None`, and `NTLM`.</span></span> | `None` |
| [<span data-ttu-id="626ab-536">EnableResponseCaching</span><span class="sxs-lookup"><span data-stu-id="626ab-536">EnableResponseCaching</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.EnableResponseCaching) | <span data-ttu-id="626ab-537">Tente la mise en cache [en mode noyau](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) pour les réponses comportant un en-tête compatible.</span><span class="sxs-lookup"><span data-stu-id="626ab-537">Attempt [kernel-mode](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) caching for responses with eligible headers.</span></span> <span data-ttu-id="626ab-538">La réponse peut ne pas inclure d’en-tête `Set-Cookie`, `Vary` ou `Pragma`.</span><span class="sxs-lookup"><span data-stu-id="626ab-538">The response may not include `Set-Cookie`, `Vary`, or `Pragma` headers.</span></span> <span data-ttu-id="626ab-539">Elle doit comporter un en-tête `Cache-Control``public` et soit une valeur `shared-max-age` ou `max-age`, soit un en-tête `Expires`.</span><span class="sxs-lookup"><span data-stu-id="626ab-539">It must include a `Cache-Control` header that's `public` and either a `shared-max-age` or `max-age` value, or an `Expires` header.</span></span> | `true` |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxAccepts> | <span data-ttu-id="626ab-540">Nombre maximal d'acceptations simultanées.</span><span class="sxs-lookup"><span data-stu-id="626ab-540">The maximum number of concurrent accepts.</span></span> | <span data-ttu-id="626ab-541">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span><span class="sxs-lookup"><span data-stu-id="626ab-541">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxConnections> | <span data-ttu-id="626ab-542">Nombre maximum de connexions simultanées à accepter.</span><span class="sxs-lookup"><span data-stu-id="626ab-542">The maximum number of concurrent connections to accept.</span></span> <span data-ttu-id="626ab-543">Utilisez `-1` pour signifier l’infini,</span><span class="sxs-lookup"><span data-stu-id="626ab-543">Use `-1` for infinite.</span></span> <span data-ttu-id="626ab-544">et `null` pour utiliser le paramètre du Registre qui s’applique à l’ordinateur dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="626ab-544">Use `null` to use the registry's machine-wide setting.</span></span> | `null`<br><span data-ttu-id="626ab-545">(au niveau de l’ordinateur</span><span class="sxs-lookup"><span data-stu-id="626ab-545">(machine-wide</span></span><br><span data-ttu-id="626ab-546">défini</span><span class="sxs-lookup"><span data-stu-id="626ab-546">setting)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> | <span data-ttu-id="626ab-547">Consultez la section <a href="#maxrequestbodysize">MaxRequestBodySize</a>.</span><span class="sxs-lookup"><span data-stu-id="626ab-547">See the <a href="#maxrequestbodysize">MaxRequestBodySize</a> section.</span></span> | <span data-ttu-id="626ab-548">30 000 000 octets</span><span class="sxs-lookup"><span data-stu-id="626ab-548">30000000 bytes</span></span><br><span data-ttu-id="626ab-549">(env. 28,6 Mo)</span><span class="sxs-lookup"><span data-stu-id="626ab-549">(~28.6 MB)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.RequestQueueLimit> | <span data-ttu-id="626ab-550">Nombre maximal de demandes pouvant être placées en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="626ab-550">The maximum number of requests that can be queued.</span></span> | <span data-ttu-id="626ab-551">1 000</span><span class="sxs-lookup"><span data-stu-id="626ab-551">1000</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.ThrowWriteExceptions> | <span data-ttu-id="626ab-552">Indique si les écritures dans le corps de la réponse qui échouent en raison d’une déconnexion du client doivent lever des exceptions ou se terminer normalement.</span><span class="sxs-lookup"><span data-stu-id="626ab-552">Indicate if response body writes that fail due to client disconnects should throw exceptions or complete normally.</span></span> | `false`<br><span data-ttu-id="626ab-553">(se terminer normalement)</span><span class="sxs-lookup"><span data-stu-id="626ab-553">(complete normally)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.Timeouts> | <span data-ttu-id="626ab-554">Expose la configuration <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> de HTTP.sys, également paramétrable dans le Registre.</span><span class="sxs-lookup"><span data-stu-id="626ab-554">Expose the HTTP.sys <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> configuration, which may also be configured in the registry.</span></span> <span data-ttu-id="626ab-555">Suivez les liens de l’API pour en savoir plus sur chaque paramètre, y compris les valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-555">Follow the API links to learn more about each setting, including default values:</span></span><ul><li><span data-ttu-id="626ab-556">[TimeoutManager. DrainEntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody): temps accordé à l’API du serveur http pour vider le corps d’entité sur une connexion Keep-Alive.</span><span class="sxs-lookup"><span data-stu-id="626ab-556">[TimeoutManager.DrainEntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody): Time allowed for the HTTP Server API to drain the entity body on a Keep-Alive connection.</span></span></li><li><span data-ttu-id="626ab-557">[TimeoutManager. EntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody): temps autorisé pour l’arrivée du corps d’entité de la requête.</span><span class="sxs-lookup"><span data-stu-id="626ab-557">[TimeoutManager.EntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody): Time allowed for the request entity body to arrive.</span></span></li><li><span data-ttu-id="626ab-558">[TimeoutManager. HeaderWait](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait): temps accordé à l’API du serveur http pour analyser l’en-tête de la demande.</span><span class="sxs-lookup"><span data-stu-id="626ab-558">[TimeoutManager.HeaderWait](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait): Time allowed for the HTTP Server API to parse the request header.</span></span></li><li><span data-ttu-id="626ab-559">[TimeoutManager. IdleConnection](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection): temps autorisé pour une connexion inactive.</span><span class="sxs-lookup"><span data-stu-id="626ab-559">[TimeoutManager.IdleConnection](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection): Time allowed for an idle connection.</span></span></li><li><span data-ttu-id="626ab-560">[TimeoutManager. MinSendBytesPerSecond](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond): taux d’envoi minimal pour la réponse.</span><span class="sxs-lookup"><span data-stu-id="626ab-560">[TimeoutManager.MinSendBytesPerSecond](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond): The minimum send rate for the response.</span></span></li><li><span data-ttu-id="626ab-561">[TimeoutManager. RequestQueue](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue): temps pendant lequel la demande doit rester dans la file d’attente des demandes avant que l’application la récupère.</span><span class="sxs-lookup"><span data-stu-id="626ab-561">[TimeoutManager.RequestQueue](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue): Time allowed for the request to remain in the request queue before the app picks it up.</span></span></li></ul> |  |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> | <span data-ttu-id="626ab-562">Spécifiez <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> à inscrire auprès de HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-562">Specify the <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> to register with HTTP.sys.</span></span> <span data-ttu-id="626ab-563">La plus utile est [UrlPrefixCollection.Add](xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add*), qui permet d’ajouter un préfixe à la collection.</span><span class="sxs-lookup"><span data-stu-id="626ab-563">The most useful is [UrlPrefixCollection.Add](xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add*), which is used to add a prefix to the collection.</span></span> <span data-ttu-id="626ab-564">Ces choix peuvent être modifiés à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-564">These may be modified at any time prior to disposing the listener.</span></span> |  |

<a name="maxrequestbodysize"></a>

<span data-ttu-id="626ab-565">**MaxRequestBodySize**</span><span class="sxs-lookup"><span data-stu-id="626ab-565">**MaxRequestBodySize**</span></span>

<span data-ttu-id="626ab-566">Taille maximale autorisée pour le corps d’une demande, en octets.</span><span class="sxs-lookup"><span data-stu-id="626ab-566">The maximum allowed size of any request body in bytes.</span></span> <span data-ttu-id="626ab-567">Lorsque la valeur est `null`, elle est illimitée.</span><span class="sxs-lookup"><span data-stu-id="626ab-567">When set to `null`, the maximum request body size is unlimited.</span></span> <span data-ttu-id="626ab-568">Cette limite est sans effet sur les connexions mises à niveau, qui sont illimitées.</span><span class="sxs-lookup"><span data-stu-id="626ab-568">This limit has no effect on upgraded connections, which are always unlimited.</span></span>

<span data-ttu-id="626ab-569">Pour remplacer la limite d’un seul `IActionResult` dans une application MVC ASP.NET Core, nous vous recommandons d’utiliser l’attribut <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> sur une méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="626ab-569">The recommended method to override the limit in an ASP.NET Core MVC app for a single `IActionResult` is to use the <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> attribute on an action method:</span></span>

```csharp
[RequestSizeLimit(100000000)]
public IActionResult MyActionMethod()
```

<span data-ttu-id="626ab-570">Une exception est levée si l’application tente de configurer la limite sur une demande dont l’application a commencé la lecture.</span><span class="sxs-lookup"><span data-stu-id="626ab-570">An exception is thrown if the app attempts to configure the limit on a request after the app has started reading the request.</span></span> <span data-ttu-id="626ab-571">La propriété `IsReadOnly` indique si la propriété `MaxRequestBodySize` est en lecture seule, et donc s’il est trop tard pour configurer la limite.</span><span class="sxs-lookup"><span data-stu-id="626ab-571">An `IsReadOnly` property can be used to indicate if the `MaxRequestBodySize` property is in a read-only state, meaning it's too late to configure the limit.</span></span>

<span data-ttu-id="626ab-572">Si l’application doit remplacer <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> par requête, utilisez <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature> :</span><span class="sxs-lookup"><span data-stu-id="626ab-572">If the app should override <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> per-request, use the <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature>:</span></span>

[!code-csharp[](httpsys/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=6-7)]

<span data-ttu-id="626ab-573">Si vous utilisez Visual Studio, vérifiez que l’application n’est pas configurée pour exécuter IIS ou IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-573">If using Visual Studio, make sure the app isn't configured to run IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-574">Dans Visual Studio, le profil de démarrage par défaut est destiné à IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-574">In Visual Studio, the default launch profile is for IIS Express.</span></span> <span data-ttu-id="626ab-575">Pour exécuter le projet en tant qu’application console, changez manuellement le profil sélectionné, comme dans la capture d’écran suivante :</span><span class="sxs-lookup"><span data-stu-id="626ab-575">To run the project as a console app, manually change the selected profile, as shown in the following screen shot:</span></span>

![Sélectionner le profil d’application console](httpsys/_static/vs-choose-profile.png)

### <a name="configure-windows-server"></a><span data-ttu-id="626ab-577">Configurer Windows Server</span><span class="sxs-lookup"><span data-stu-id="626ab-577">Configure Windows Server</span></span>

1. <span data-ttu-id="626ab-578">Identifiez les ports à ouvrir pour l’application et utilisez le [pare-feu Windows](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) ou les applets de commande PowerShell [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) pour ouvrir les ports du pare-feu et ainsi permettre au trafic d’atteindre HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-578">Determine the ports to open for the app and use [Windows Firewall](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) or the [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) PowerShell cmdlet to open firewall ports to allow traffic to reach HTTP.sys.</span></span> <span data-ttu-id="626ab-579">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-579">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-580">Lors du déploiement sur une machine virtuelle Azure, ouvrez les ports dans le [groupe de sécurité réseau](/azure/virtual-machines/windows/nsg-quickstart-portal).</span><span class="sxs-lookup"><span data-stu-id="626ab-580">When deploying to an Azure VM, open the ports in the [Network Security Group](/azure/virtual-machines/windows/nsg-quickstart-portal).</span></span> <span data-ttu-id="626ab-581">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-581">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-582">Obtenez et installez des certificats X.509, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="626ab-582">Obtain and install X.509 certificates, if required.</span></span>

   <span data-ttu-id="626ab-583">Sous Windows, créez des certificats auto-signés à l’aide de la [cmdlet PowerShell New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate).</span><span class="sxs-lookup"><span data-stu-id="626ab-583">On Windows, create self-signed certificates using the [New-SelfSignedCertificate PowerShell cmdlet](/powershell/module/pkiclient/new-selfsignedcertificate).</span></span> <span data-ttu-id="626ab-584">Vous trouverez un exemple non pris en charge sur la page [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span><span class="sxs-lookup"><span data-stu-id="626ab-584">For an unsupported example, see [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span></span>

   <span data-ttu-id="626ab-585">Installez des certificats auto-signés ou signés par l’autorité de certification dans le magasin **Ordinateur Local** > **Personnel** du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-585">Install either self-signed or CA-signed certificates in the server's **Local Machine** > **Personal** store.</span></span>

1. <span data-ttu-id="626ab-586">Si l’application est un [déploiement dépendant de .NET Framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), installez .NET Core, .NET Framework ou les deux (si l’application est une application .NET Core ciblant .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="626ab-586">If the app is a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), install .NET Core, .NET Framework, or both (if the app is a .NET Core app targeting the .NET Framework).</span></span>

   * <span data-ttu-id="626ab-587">**.Net Core**: si l’application requiert .net Core, obtenez et exécutez le programme d’installation du **Runtime .net Core** à partir des [téléchargements .net Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-587">**.NET Core**: If the app requires .NET Core, obtain and run the **.NET Core Runtime** installer from [.NET Core Downloads](https://dotnet.microsoft.com/download).</span></span> <span data-ttu-id="626ab-588">N’installez pas le Kit SDK complet sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-588">Don't install the full SDK on the server.</span></span>
   * <span data-ttu-id="626ab-589">**.NET Framework**: si l’application requiert des .NET Framework, consultez le [Guide d’installation de .NET Framework](/dotnet/framework/install/).</span><span class="sxs-lookup"><span data-stu-id="626ab-589">**.NET Framework**: If the app requires .NET Framework, see the [.NET Framework installation guide](/dotnet/framework/install/).</span></span> <span data-ttu-id="626ab-590">Installez la version requise de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="626ab-590">Install the required .NET Framework.</span></span> <span data-ttu-id="626ab-591">Le programme d’installation du .NET Framework le plus récent est disponible depuis la page [Téléchargements .NET Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-591">The installer for the latest .NET Framework is available from the [.NET Core Downloads](https://dotnet.microsoft.com/download) page.</span></span>

   <span data-ttu-id="626ab-592">Si l’application est un [déploiement autonome](/dotnet/core/deploying/#self-contained-deployments-scd), elle inclut le runtime dans son déploiement.</span><span class="sxs-lookup"><span data-stu-id="626ab-592">If the app is a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), the app includes the runtime in its deployment.</span></span> <span data-ttu-id="626ab-593">Aucune installation de framework n’est requise sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-593">No framework installation is required on the server.</span></span>

1. <span data-ttu-id="626ab-594">Configurez les ports et les URL de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-594">Configure URLs and ports in the app.</span></span>

   <span data-ttu-id="626ab-595">Par défaut, ASP.NET Core est lié à `http://localhost:5000`.</span><span class="sxs-lookup"><span data-stu-id="626ab-595">By default, ASP.NET Core binds to `http://localhost:5000`.</span></span> <span data-ttu-id="626ab-596">Pour configurer les ports et les préfixes d’URL, il existe plusieurs possibilités :</span><span class="sxs-lookup"><span data-stu-id="626ab-596">To configure URL prefixes and ports, options include:</span></span>

   * <xref:Microsoft.AspNetCore.Hosting.HostingAbstractionsWebHostBuilderExtensions.UseUrls*>
   * <span data-ttu-id="626ab-597">Arguments de ligne de commande `urls`</span><span class="sxs-lookup"><span data-stu-id="626ab-597">`urls` command-line argument</span></span>
   * <span data-ttu-id="626ab-598">`ASPNETCORE_URLS` variable d’environnement</span><span class="sxs-lookup"><span data-stu-id="626ab-598">`ASPNETCORE_URLS` environment variable</span></span>
   * <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes>

   <span data-ttu-id="626ab-599">L’exemple de code suivant montre comment utiliser <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> avec l’adresse IP locale du serveur `10.0.0.4` sur le port 443 :</span><span class="sxs-lookup"><span data-stu-id="626ab-599">The following code example shows how to use <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> with the server's local IP address `10.0.0.4` on port 443:</span></span>

   [!code-csharp[](httpsys/samples_snapshot/2.x/Program.cs?highlight=6)]

   <span data-ttu-id="626ab-600">`UrlPrefixes` présente l’avantage de générer immédiatement un message d’erreur en cas de préfixe mal formé.</span><span class="sxs-lookup"><span data-stu-id="626ab-600">An advantage of `UrlPrefixes` is that an error message is generated immediately for improperly formatted prefixes.</span></span>

   <span data-ttu-id="626ab-601">Les paramètres de `UrlPrefixes` remplacent les paramètres `UseUrls`/`urls`/`ASPNETCORE_URLS`.</span><span class="sxs-lookup"><span data-stu-id="626ab-601">The settings in `UrlPrefixes` override `UseUrls`/`urls`/`ASPNETCORE_URLS` settings.</span></span> <span data-ttu-id="626ab-602">Par conséquent, avec `UseUrls`, `urls` et la variable d’environnement `ASPNETCORE_URLS`, il est plus facile de basculer entre Kestrel et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-602">Therefore, an advantage of `UseUrls`, `urls`, and the `ASPNETCORE_URLS` environment variable is that it's easier to switch between Kestrel and HTTP.sys.</span></span>

   <span data-ttu-id="626ab-603">HTTP.sys utilise les [formats de chaîne UrlPrefix de l’API de serveur HTTP](/windows/win32/http/urlprefix-strings).</span><span class="sxs-lookup"><span data-stu-id="626ab-603">HTTP.sys uses the [HTTP Server API UrlPrefix string formats](/windows/win32/http/urlprefix-strings).</span></span>

   > [!WARNING]
   > <span data-ttu-id="626ab-604">Les liaisons génériques de niveau supérieur (`http://*:80/` et `http://+:80`) ne doivent **pas** être utilisées.</span><span class="sxs-lookup"><span data-stu-id="626ab-604">Top-level wildcard bindings (`http://*:80/` and `http://+:80`) should **not** be used.</span></span> <span data-ttu-id="626ab-605">Les liaisons génériques de niveau supérieur créent des failles de sécurité dans l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-605">Top-level wildcard bindings create app security vulnerabilities.</span></span> <span data-ttu-id="626ab-606">Cela s’applique aux caractères génériques forts et faibles.</span><span class="sxs-lookup"><span data-stu-id="626ab-606">This applies to both strong and weak wildcards.</span></span> <span data-ttu-id="626ab-607">Utilisez des noms d’hôte ou des adresses IP explicites plutôt que des caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="626ab-607">Use explicit host names or IP addresses rather than wildcards.</span></span> <span data-ttu-id="626ab-608">Une liaison générique de sous-domaine (par exemple, `*.mysub.com`) ne constitue pas un risque de sécurité si vous contrôlez le domaine parent en entier (par opposition à `*.com`, qui est vulnérable).</span><span class="sxs-lookup"><span data-stu-id="626ab-608">Subdomain wildcard binding (for example, `*.mysub.com`) isn't a security risk if you control the entire parent domain (as opposed to `*.com`, which is vulnerable).</span></span> <span data-ttu-id="626ab-609">Pour plus d’informations, consultez [RFC 7230 : Section 5,4 : Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span><span class="sxs-lookup"><span data-stu-id="626ab-609">For more information, see [RFC 7230: Section 5.4: Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span></span>

1. <span data-ttu-id="626ab-610">Préenregistrez les préfixes d’URL sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-610">Preregister URL prefixes on the server.</span></span>

   <span data-ttu-id="626ab-611">L’outil intégré pour configurer HTTP.sys est *netsh.exe*.</span><span class="sxs-lookup"><span data-stu-id="626ab-611">The built-in tool for configuring HTTP.sys is *netsh.exe*.</span></span> <span data-ttu-id="626ab-612">*netsh.exe* permet de réserver des préfixes d’URL et d’assigner des certificats X.509.</span><span class="sxs-lookup"><span data-stu-id="626ab-612">*netsh.exe* is used to reserve URL prefixes and assign X.509 certificates.</span></span> <span data-ttu-id="626ab-613">L’outil requiert des privilèges Administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-613">The tool requires administrator privileges.</span></span>

   <span data-ttu-id="626ab-614">Utilisez l’outil *netsh.exe* pour enregistrer les URL pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-614">Use the *netsh.exe* tool to register URLs for the app:</span></span>

   ```console
   netsh http add urlacl url=<URL> user=<USER>
   ```

   * <span data-ttu-id="626ab-615">`<URL>`: Le Uniform Resource Locator qualifié complet (URL).</span><span class="sxs-lookup"><span data-stu-id="626ab-615">`<URL>`: The fully qualified Uniform Resource Locator (URL).</span></span> <span data-ttu-id="626ab-616">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-616">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-617">Utilisez un nom d’hôte ou une adresse IP locale valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-617">Use a valid hostname or local IP address.</span></span> <span data-ttu-id="626ab-618">*L’URL doit inclure une barre oblique de fin.*</span><span class="sxs-lookup"><span data-stu-id="626ab-618">*The URL must include a trailing slash.*</span></span>
   * <span data-ttu-id="626ab-619">`<USER>`: Spécifie le nom d’utilisateur ou de groupe d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="626ab-619">`<USER>`: Specifies the user or user-group name.</span></span>

   <span data-ttu-id="626ab-620">Dans l’exemple suivant, l’adresse IP locale du serveur est `10.0.0.4` :</span><span class="sxs-lookup"><span data-stu-id="626ab-620">In the following example, the local IP address of the server is `10.0.0.4`:</span></span>

   ```console
   netsh http add urlacl url=https://10.0.0.4:443/ user=Users
   ```

   <span data-ttu-id="626ab-621">Lorsqu’une URL est inscrite, l’outil répond avec `URL reservation successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-621">When a URL is registered, the tool responds with `URL reservation successfully added`.</span></span>

   <span data-ttu-id="626ab-622">Pour supprimer une URL inscrite, utilisez la commande `delete urlacl` :</span><span class="sxs-lookup"><span data-stu-id="626ab-622">To delete a registered URL, use the `delete urlacl` command:</span></span>

   ```console
   netsh http delete urlacl url=<URL>
   ```

1. <span data-ttu-id="626ab-623">Inscrivez les certificats X.509 sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-623">Register X.509 certificates on the server.</span></span>

   <span data-ttu-id="626ab-624">Utilisez l’outil *netsh.exe* pour enregistrer les certificats pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-624">Use the *netsh.exe* tool to register certificates for the app:</span></span>

   ```console
   netsh http add sslcert ipport=<IP>:<PORT> certhash=<THUMBPRINT> appid="{<GUID>}"
   ```

   * <span data-ttu-id="626ab-625">`<IP>`: Spécifie l’adresse IP locale pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-625">`<IP>`: Specifies the local IP address for the binding.</span></span> <span data-ttu-id="626ab-626">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-626">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-627">Utilisez une adresse IP valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-627">Use a valid IP address.</span></span>
   * <span data-ttu-id="626ab-628">`<PORT>`: Spécifie le port pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-628">`<PORT>`: Specifies the port for the binding.</span></span>
   * <span data-ttu-id="626ab-629">`<THUMBPRINT>`: Empreinte numérique du certificat X. 509.</span><span class="sxs-lookup"><span data-stu-id="626ab-629">`<THUMBPRINT>`: The X.509 certificate thumbprint.</span></span>
   * <span data-ttu-id="626ab-630">`<GUID>`: GUID généré par le développeur pour représenter l’application à des fins d’information.</span><span class="sxs-lookup"><span data-stu-id="626ab-630">`<GUID>`: A developer-generated GUID to represent the app for informational purposes.</span></span>

   <span data-ttu-id="626ab-631">À titre de référence, stockez le GUID dans l’application en tant que balise de package :</span><span class="sxs-lookup"><span data-stu-id="626ab-631">For reference purposes, store the GUID in the app as a package tag:</span></span>

   * <span data-ttu-id="626ab-632">Dans Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-632">In Visual Studio:</span></span>
     * <span data-ttu-id="626ab-633">Ouvrez les propriétés du projet de l’application en cliquant avec le bouton droit sur l’application dans **l’Explorateur de solutions** et en sélectionnant **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="626ab-633">Open the app's project properties by right-clicking on the app in **Solution Explorer** and selecting **Properties**.</span></span>
     * <span data-ttu-id="626ab-634">Sélectionnez l’onglet **Package**.</span><span class="sxs-lookup"><span data-stu-id="626ab-634">Select the **Package** tab.</span></span>
     * <span data-ttu-id="626ab-635">Entrez le GUID que vous avez créé dans le champ **Balises**.</span><span class="sxs-lookup"><span data-stu-id="626ab-635">Enter the GUID that you created in the **Tags** field.</span></span>
   * <span data-ttu-id="626ab-636">Si vous n’utilisez pas Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-636">When not using Visual Studio:</span></span>
     * <span data-ttu-id="626ab-637">Ouvrez le chemin d’accès vers le fichier de projet de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-637">Open the app's project file.</span></span>
     * <span data-ttu-id="626ab-638">Ajoutez une propriété `<PackageTags>` à un `<PropertyGroup>` nouveau ou existant avec le GUID que vous avez créé :</span><span class="sxs-lookup"><span data-stu-id="626ab-638">Add a `<PackageTags>` property to a new or existing `<PropertyGroup>` with the GUID that you created:</span></span>

       ```xml
       <PropertyGroup>
         <PackageTags>9412ee86-c21b-4eb8-bd89-f650fbf44931</PackageTags>
       </PropertyGroup>
       ```

   <span data-ttu-id="626ab-639">Dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="626ab-639">In the following example:</span></span>

   * <span data-ttu-id="626ab-640">L’adresse IP locale du serveur est `10.0.0.4`.</span><span class="sxs-lookup"><span data-stu-id="626ab-640">The local IP address of the server is `10.0.0.4`.</span></span>
   * <span data-ttu-id="626ab-641">Un générateur de GUID aléatoire en ligne fournit la valeur `appid`.</span><span class="sxs-lookup"><span data-stu-id="626ab-641">An online random GUID generator provides the `appid` value.</span></span>

   ```console
   netsh http add sslcert 
       ipport=10.0.0.4:443 
       certhash=b66ee04419d4ee37464ab8785ff02449980eae10 
       appid="{9412ee86-c21b-4eb8-bd89-f650fbf44931}"
   ```

   <span data-ttu-id="626ab-642">Lorsqu’un certificat est inscrit, l’outil répond avec `SSL Certificate successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-642">When a certificate is registered, the tool responds with `SSL Certificate successfully added`.</span></span>

   <span data-ttu-id="626ab-643">Pour supprimer l’inscription d’un certificat, utilisez la commande `delete sslcert` :</span><span class="sxs-lookup"><span data-stu-id="626ab-643">To delete a certificate registration, use the `delete sslcert` command:</span></span>

   ```console
   netsh http delete sslcert ipport=<IP>:<PORT>
   ```

   <span data-ttu-id="626ab-644">Documentation de référence de *netsh.exe* :</span><span class="sxs-lookup"><span data-stu-id="626ab-644">Reference documentation for *netsh.exe*:</span></span>

   * <span data-ttu-id="626ab-645">[Commandes netsh pour le protocole HTTP (Hypertext Transfer Protocol)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="626ab-645">[Netsh Commands for Hypertext Transfer Protocol (HTTP)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span></span>
   * [<span data-ttu-id="626ab-646">Chaînes UrlPrefix</span><span class="sxs-lookup"><span data-stu-id="626ab-646">UrlPrefix Strings</span></span>](/windows/win32/http/urlprefix-strings)

1. <span data-ttu-id="626ab-647">Exécutez l'application.</span><span class="sxs-lookup"><span data-stu-id="626ab-647">Run the app.</span></span>

   <span data-ttu-id="626ab-648">Les privilèges administrateur ne sont pas requis pour exécuter l’application lors d’une liaison à localhost à l’aide de HTTP (pas HTTPS) avec un numéro de port supérieur à 1024.</span><span class="sxs-lookup"><span data-stu-id="626ab-648">Administrator privileges aren't required to run the app when binding to localhost using HTTP (not HTTPS) with a port number greater than 1024.</span></span> <span data-ttu-id="626ab-649">Pour les autres configurations (par exemple, l’utilisation d’une adresse IP locale ou la liaison au port 443), exécutez l’application avec des privilèges administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-649">For other configurations (for example, using a local IP address or binding to port 443), run the app with administrator privileges.</span></span>

   <span data-ttu-id="626ab-650">L’application répond à l’adresse IP publique du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-650">The app responds at the server's public IP address.</span></span> <span data-ttu-id="626ab-651">Dans cet exemple, le serveur est contacté à partir d’Internet à son adresse IP publique `104.214.79.47`.</span><span class="sxs-lookup"><span data-stu-id="626ab-651">In this example, the server is reached from the Internet at its public IP address of `104.214.79.47`.</span></span>

   <span data-ttu-id="626ab-652">Un certificat de développement est utilisé dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="626ab-652">A development certificate is used in this example.</span></span> <span data-ttu-id="626ab-653">La page est chargée en toute sécurité après le contournement de l’avertissement de certificat non approuvé du navigateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-653">The page loads securely after bypassing the browser's untrusted certificate warning.</span></span>

   ![Fenêtre de navigateur affichant la page Index de l’application chargée](httpsys/_static/browser.png)

## <a name="proxy-server-and-load-balancer-scenarios"></a><span data-ttu-id="626ab-655">Scénarios avec un serveur proxy et un équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="626ab-655">Proxy server and load balancer scenarios</span></span>

<span data-ttu-id="626ab-656">Pour les applications hébergées par HTTP.sys qui interagissent avec les demandes provenant d’Internet ou d’un réseau d’entreprise, une configuration supplémentaire peut être nécessaire en cas d’hébergement derrière des serveurs proxy et des équilibreurs de charge.</span><span class="sxs-lookup"><span data-stu-id="626ab-656">For apps hosted by HTTP.sys that interact with requests from the Internet or a corporate network, additional configuration might be required when hosting behind proxy servers and load balancers.</span></span> <span data-ttu-id="626ab-657">Pour plus d’informations, consultez l’article [Configurer ASP.NET Core pour l’utilisation de serveurs proxy et d’équilibreurs de charge](xref:host-and-deploy/proxy-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="626ab-657">For more information, see [Configure ASP.NET Core to work with proxy servers and load balancers](xref:host-and-deploy/proxy-load-balancer).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="626ab-658">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="626ab-658">Additional resources</span></span>

* [<span data-ttu-id="626ab-659">Activer l’authentification Windows avec HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-659">Enable Windows Authentication with HTTP.sys</span></span>](xref:security/authentication/windowsauth#httpsys)
* [<span data-ttu-id="626ab-660">API de serveur HTTP</span><span class="sxs-lookup"><span data-stu-id="626ab-660">HTTP Server API</span></span>](/windows/win32/http/http-api-start-page)
* [<span data-ttu-id="626ab-661">Référentiel GitHub aspnet/HttpSysServer (code source)</span><span class="sxs-lookup"><span data-stu-id="626ab-661">aspnet/HttpSysServer GitHub repository (source code)</span></span>](https://github.com/aspnet/HttpSysServer/)
* [<span data-ttu-id="626ab-662">L’hôte</span><span class="sxs-lookup"><span data-stu-id="626ab-662">The host</span></span>](xref:fundamentals/index#host)
* <xref:test/troubleshoot>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="626ab-663">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) est un [serveur web pour ASP.NET Core](xref:fundamentals/servers/index) qui s’exécute uniquement sous Windows.</span><span class="sxs-lookup"><span data-stu-id="626ab-663">[HTTP.sys](/iis/get-started/introduction-to-iis/introduction-to-iis-architecture#hypertext-transfer-protocol-stack-httpsys) is a [web server for ASP.NET Core](xref:fundamentals/servers/index) that only runs on Windows.</span></span> <span data-ttu-id="626ab-664">HTTP.sys est une alternative au serveur [Kestrel](xref:fundamentals/servers/kestrel) et offre des fonctionnalités supplémentaires par rapport à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="626ab-664">HTTP.sys is an alternative to [Kestrel](xref:fundamentals/servers/kestrel) server and offers some features that Kestrel doesn't provide.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="626ab-665">HTTP.sys est incompatible avec le [Module ASP.NET Core](xref:host-and-deploy/aspnet-core-module) et n’est pas utilisable avec IIS ni IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-665">HTTP.sys isn't compatible with the [ASP.NET Core Module](xref:host-and-deploy/aspnet-core-module) and can't be used with IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-666">HTTP.sys prend en charge les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="626ab-666">HTTP.sys supports the following features:</span></span>

* [<span data-ttu-id="626ab-667">Authentification Windows</span><span class="sxs-lookup"><span data-stu-id="626ab-667">Windows Authentication</span></span>](xref:security/authentication/windowsauth)
* <span data-ttu-id="626ab-668">Partage de port</span><span class="sxs-lookup"><span data-stu-id="626ab-668">Port sharing</span></span>
* <span data-ttu-id="626ab-669">HTTPS avec SNI</span><span class="sxs-lookup"><span data-stu-id="626ab-669">HTTPS with SNI</span></span>
* <span data-ttu-id="626ab-670">HTTP/2 sur TLS (Windows 10 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-670">HTTP/2 over TLS (Windows 10 or later)</span></span>
* <span data-ttu-id="626ab-671">Transmission de fichier directe</span><span class="sxs-lookup"><span data-stu-id="626ab-671">Direct file transmission</span></span>
* <span data-ttu-id="626ab-672">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="626ab-672">Response caching</span></span>
* <span data-ttu-id="626ab-673">WebSockets (Windows 8 et versions ultérieures)</span><span class="sxs-lookup"><span data-stu-id="626ab-673">WebSockets (Windows 8 or later)</span></span>

<span data-ttu-id="626ab-674">Versions de Windows prises en charge :</span><span class="sxs-lookup"><span data-stu-id="626ab-674">Supported Windows versions:</span></span>

* <span data-ttu-id="626ab-675">Windows 7 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-675">Windows 7 or later</span></span>
* <span data-ttu-id="626ab-676">Windows Server 2008 R2 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-676">Windows Server 2008 R2 or later</span></span>

<span data-ttu-id="626ab-677">[Afficher ou télécharger l’exemple de code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([procédure de téléchargement](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="626ab-677">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/fundamentals/servers/httpsys/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="when-to-use-httpsys"></a><span data-ttu-id="626ab-678">Quand utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-678">When to use HTTP.sys</span></span>

<span data-ttu-id="626ab-679">HTTP.sys est utile pour les déploiements lorsque :</span><span class="sxs-lookup"><span data-stu-id="626ab-679">HTTP.sys is useful for deployments where:</span></span>

* <span data-ttu-id="626ab-680">Il est nécessaire d’exposer directement le serveur à Internet sans passer par IIS.</span><span class="sxs-lookup"><span data-stu-id="626ab-680">There's a need to expose the server directly to the Internet without using IIS.</span></span>

  ![HTTP.sys communique directement avec Internet](httpsys/_static/httpsys-to-internet.png)

* <span data-ttu-id="626ab-682">Un déploiement interne implique une fonctionnalité qui n’est pas disponible dans Kestrel, par exemple, [l’authentification Windows](xref:security/authentication/windowsauth).</span><span class="sxs-lookup"><span data-stu-id="626ab-682">An internal deployment requires a feature not available in Kestrel, such as [Windows Authentication](xref:security/authentication/windowsauth).</span></span>

  ![HTTP.sys communique directement avec le réseau interne](httpsys/_static/httpsys-to-internal.png)

<span data-ttu-id="626ab-684">HTTP.sys est une technologie aboutie qui assure une protection contre de nombreux types d’attaques et offre la robustesse, la sécurité et l’extensibilité d’un serveur web haut de gamme.</span><span class="sxs-lookup"><span data-stu-id="626ab-684">HTTP.sys is mature technology that protects against many types of attacks and provides the robustness, security, and scalability of a full-featured web server.</span></span> <span data-ttu-id="626ab-685">Pour sa part, IIS s’exécute en tant qu’écouteur HTTP sur HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-685">IIS itself runs as an HTTP listener on top of HTTP.sys.</span></span>

## <a name="http2-support"></a><span data-ttu-id="626ab-686">Assistance HTTP/2</span><span class="sxs-lookup"><span data-stu-id="626ab-686">HTTP/2 support</span></span>

<span data-ttu-id="626ab-687">[HTTP/2](https://httpwg.org/specs/rfc7540.html) est activé pour les applications ASP.NET Core si les conditions de base suivantes sont remplies :</span><span class="sxs-lookup"><span data-stu-id="626ab-687">[HTTP/2](https://httpwg.org/specs/rfc7540.html) is enabled for ASP.NET Core apps if the following base requirements are met:</span></span>

* <span data-ttu-id="626ab-688">Windows Server 2016/Windows 10 ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-688">Windows Server 2016/Windows 10 or later</span></span>
* <span data-ttu-id="626ab-689">Connexion [ALPN (Application-Layer Protocol Negotiation)](https://tools.ietf.org/html/rfc7301#section-3)</span><span class="sxs-lookup"><span data-stu-id="626ab-689">[Application-Layer Protocol Negotiation (ALPN)](https://tools.ietf.org/html/rfc7301#section-3) connection</span></span>
* <span data-ttu-id="626ab-690">TLS 1.2 ou connexion ultérieure</span><span class="sxs-lookup"><span data-stu-id="626ab-690">TLS 1.2 or later connection</span></span>

<span data-ttu-id="626ab-691">Si une connexion HTTP/2 est établie, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) retourne `HTTP/1.1`.</span><span class="sxs-lookup"><span data-stu-id="626ab-691">If an HTTP/2 connection is established, [HttpRequest.Protocol](xref:Microsoft.AspNetCore.Http.HttpRequest.Protocol*) reports `HTTP/1.1`.</span></span>

<span data-ttu-id="626ab-692">HTTP/2 est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="626ab-692">HTTP/2 is enabled by default.</span></span> <span data-ttu-id="626ab-693">Si une connexion HTTP/2 n’est pas établie, la connexion revient à HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="626ab-693">If an HTTP/2 connection isn't established, the connection falls back to HTTP/1.1.</span></span> <span data-ttu-id="626ab-694">Dans une prochaine version de Windows, les indicateurs de configuration HTTP/2 seront disponibles, y compris la possibilité de désactivation de HTTP/2 avec HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-694">In a future release of Windows, HTTP/2 configuration flags will be available, including the ability to disable HTTP/2 with HTTP.sys.</span></span>

## <a name="kernel-mode-authentication-with-kerberos"></a><span data-ttu-id="626ab-695">Authentification en mode noyau avec Kerberos</span><span class="sxs-lookup"><span data-stu-id="626ab-695">Kernel mode authentication with Kerberos</span></span>

<span data-ttu-id="626ab-696">HTTP.sys délègue l’authentification en mode noyau avec le protocole d’authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="626ab-696">HTTP.sys delegates to kernel mode authentication with the Kerberos authentication protocol.</span></span> <span data-ttu-id="626ab-697">L’authentification en mode utilisateur n’est pas prise en charge avec Kerberos et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-697">User mode authentication isn't supported with Kerberos and HTTP.sys.</span></span> <span data-ttu-id="626ab-698">Le compte d’ordinateur doit être utilisé pour déchiffrer le ticket/jeton Kerberos obtenu à partir d’Active Directory et transféré par le client au serveur afin d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-698">The machine account must be used to decrypt the Kerberos token/ticket that's obtained from Active Directory and forwarded by the client to the server to authenticate the user.</span></span> <span data-ttu-id="626ab-699">Inscrivez le nom de principal du service (SPN) pour l’hôte, et non l’utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-699">Register the Service Principal Name (SPN) for the host, not the user of the app.</span></span>

## <a name="how-to-use-httpsys"></a><span data-ttu-id="626ab-700">Comment utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-700">How to use HTTP.sys</span></span>

### <a name="configure-the-aspnet-core-app-to-use-httpsys"></a><span data-ttu-id="626ab-701">Configurer l’application ASP.NET Core afin d’utiliser HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-701">Configure the ASP.NET Core app to use HTTP.sys</span></span>

<span data-ttu-id="626ab-702">Une référence de package dans le fichier projet n’est pas requise lors de l’utilisation de l' [offre Microsoft. AspNetCore. app](xref:fundamentals/metapackage-app) ([NuGet.org](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)).</span><span class="sxs-lookup"><span data-stu-id="626ab-702">A package reference in the project file isn't required when using the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) ([nuget.org](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)).</span></span> <span data-ttu-id="626ab-703">Si vous n'utilisez pas le métapaquet `Microsoft.AspNetCore.App`, ajoutez une référence de package à [Microsoft.AspNetCore.Server.HttpSys](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.HttpSys/).</span><span class="sxs-lookup"><span data-stu-id="626ab-703">When not using the `Microsoft.AspNetCore.App` metapackage, add a package reference to [Microsoft.AspNetCore.Server.HttpSys](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.HttpSys/).</span></span>

<span data-ttu-id="626ab-704">Appelez la méthode d’extension <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> au moment de générer l’hôte, en spécifiant les options <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions> nécessaires.</span><span class="sxs-lookup"><span data-stu-id="626ab-704">Call the <xref:Microsoft.AspNetCore.Hosting.WebHostBuilderHttpSysExtensions.UseHttpSys*> extension method when building the host, specifying any required <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions>.</span></span> <span data-ttu-id="626ab-705">L’exemple suivant définit les options sur leurs valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-705">The following example sets options to their default values:</span></span>

[!code-csharp[](httpsys/samples/2.x/SampleApp/Program.cs?name=snippet1&highlight=4-12)]

<span data-ttu-id="626ab-706">Le reste de la configuration de HTTP.sys est géré par le biais des [paramètres du Registre](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span><span class="sxs-lookup"><span data-stu-id="626ab-706">Additional HTTP.sys configuration is handled through [registry settings](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span>

<span data-ttu-id="626ab-707">**Options HTTP.sys**</span><span class="sxs-lookup"><span data-stu-id="626ab-707">**HTTP.sys options**</span></span>

| <span data-ttu-id="626ab-708">Propriété</span><span class="sxs-lookup"><span data-stu-id="626ab-708">Property</span></span> | <span data-ttu-id="626ab-709">Description</span><span class="sxs-lookup"><span data-stu-id="626ab-709">Description</span></span> | <span data-ttu-id="626ab-710">Default</span><span class="sxs-lookup"><span data-stu-id="626ab-710">Default</span></span> |
| -------- | ----------- | :-----: |
| [<span data-ttu-id="626ab-711">AllowSynchronousIO</span><span class="sxs-lookup"><span data-stu-id="626ab-711">AllowSynchronousIO</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.AllowSynchronousIO) | <span data-ttu-id="626ab-712">Contrôle si l’entrée/sortie synchrone est autorisée pour le `HttpContext.Request.Body` et le `HttpContext.Response.Body`.</span><span class="sxs-lookup"><span data-stu-id="626ab-712">Control whether synchronous input/output is allowed for the `HttpContext.Request.Body` and `HttpContext.Response.Body`.</span></span> | `true` |
| [<span data-ttu-id="626ab-713">Authentication.AllowAnonymous</span><span class="sxs-lookup"><span data-stu-id="626ab-713">Authentication.AllowAnonymous</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.AllowAnonymous) | <span data-ttu-id="626ab-714">Autorise les requêtes anonymes.</span><span class="sxs-lookup"><span data-stu-id="626ab-714">Allow anonymous requests.</span></span> | `true` |
| [<span data-ttu-id="626ab-715">Authentication.Schemes</span><span class="sxs-lookup"><span data-stu-id="626ab-715">Authentication.Schemes</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationManager.Schemes) | <span data-ttu-id="626ab-716">Spécifie les schémas d’authentification autorisés.</span><span class="sxs-lookup"><span data-stu-id="626ab-716">Specify the allowed authentication schemes.</span></span> <span data-ttu-id="626ab-717">Peut être modifié à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-717">May be modified at any time prior to disposing the listener.</span></span> <span data-ttu-id="626ab-718">Les valeurs sont fournies par l' [énumération AuthenticationSchemes](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic` , `Kerberos` ,, `Negotiate` `None` et `NTLM` .</span><span class="sxs-lookup"><span data-stu-id="626ab-718">Values are provided by the [AuthenticationSchemes enum](xref:Microsoft.AspNetCore.Server.HttpSys.AuthenticationSchemes): `Basic`, `Kerberos`, `Negotiate`, `None`, and `NTLM`.</span></span> | `None` |
| [<span data-ttu-id="626ab-719">EnableResponseCaching</span><span class="sxs-lookup"><span data-stu-id="626ab-719">EnableResponseCaching</span></span>](xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.EnableResponseCaching) | <span data-ttu-id="626ab-720">Tente la mise en cache [en mode noyau](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) pour les réponses comportant un en-tête compatible.</span><span class="sxs-lookup"><span data-stu-id="626ab-720">Attempt [kernel-mode](/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode) caching for responses with eligible headers.</span></span> <span data-ttu-id="626ab-721">La réponse peut ne pas inclure d’en-tête `Set-Cookie`, `Vary` ou `Pragma`.</span><span class="sxs-lookup"><span data-stu-id="626ab-721">The response may not include `Set-Cookie`, `Vary`, or `Pragma` headers.</span></span> <span data-ttu-id="626ab-722">Elle doit comporter un en-tête `Cache-Control``public` et soit une valeur `shared-max-age` ou `max-age`, soit un en-tête `Expires`.</span><span class="sxs-lookup"><span data-stu-id="626ab-722">It must include a `Cache-Control` header that's `public` and either a `shared-max-age` or `max-age` value, or an `Expires` header.</span></span> | `true` |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxAccepts> | <span data-ttu-id="626ab-723">Nombre maximal d'acceptations simultanées.</span><span class="sxs-lookup"><span data-stu-id="626ab-723">The maximum number of concurrent accepts.</span></span> | <span data-ttu-id="626ab-724">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span><span class="sxs-lookup"><span data-stu-id="626ab-724">5 &times; [Environment.<br>ProcessorCount](xref:System.Environment.ProcessorCount)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxConnections> | <span data-ttu-id="626ab-725">Nombre maximum de connexions simultanées à accepter.</span><span class="sxs-lookup"><span data-stu-id="626ab-725">The maximum number of concurrent connections to accept.</span></span> <span data-ttu-id="626ab-726">Utilisez `-1` pour signifier l’infini,</span><span class="sxs-lookup"><span data-stu-id="626ab-726">Use `-1` for infinite.</span></span> <span data-ttu-id="626ab-727">et `null` pour utiliser le paramètre du Registre qui s’applique à l’ordinateur dans son ensemble.</span><span class="sxs-lookup"><span data-stu-id="626ab-727">Use `null` to use the registry's machine-wide setting.</span></span> | `null`<br><span data-ttu-id="626ab-728">(au niveau de l’ordinateur</span><span class="sxs-lookup"><span data-stu-id="626ab-728">(machine-wide</span></span><br><span data-ttu-id="626ab-729">défini</span><span class="sxs-lookup"><span data-stu-id="626ab-729">setting)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> | <span data-ttu-id="626ab-730">Consultez la section <a href="#maxrequestbodysize">MaxRequestBodySize</a>.</span><span class="sxs-lookup"><span data-stu-id="626ab-730">See the <a href="#maxrequestbodysize">MaxRequestBodySize</a> section.</span></span> | <span data-ttu-id="626ab-731">30 000 000 octets</span><span class="sxs-lookup"><span data-stu-id="626ab-731">30000000 bytes</span></span><br><span data-ttu-id="626ab-732">(env. 28,6 Mo)</span><span class="sxs-lookup"><span data-stu-id="626ab-732">(~28.6 MB)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.RequestQueueLimit> | <span data-ttu-id="626ab-733">Nombre maximal de demandes pouvant être placées en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="626ab-733">The maximum number of requests that can be queued.</span></span> | <span data-ttu-id="626ab-734">1 000</span><span class="sxs-lookup"><span data-stu-id="626ab-734">1000</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.ThrowWriteExceptions> | <span data-ttu-id="626ab-735">Indique si les écritures dans le corps de la réponse qui échouent en raison d’une déconnexion du client doivent lever des exceptions ou se terminer normalement.</span><span class="sxs-lookup"><span data-stu-id="626ab-735">Indicate if response body writes that fail due to client disconnects should throw exceptions or complete normally.</span></span> | `false`<br><span data-ttu-id="626ab-736">(se terminer normalement)</span><span class="sxs-lookup"><span data-stu-id="626ab-736">(complete normally)</span></span> |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.Timeouts> | <span data-ttu-id="626ab-737">Expose la configuration <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> de HTTP.sys, également paramétrable dans le Registre.</span><span class="sxs-lookup"><span data-stu-id="626ab-737">Expose the HTTP.sys <xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager> configuration, which may also be configured in the registry.</span></span> <span data-ttu-id="626ab-738">Suivez les liens de l’API pour en savoir plus sur chaque paramètre, y compris les valeurs par défaut :</span><span class="sxs-lookup"><span data-stu-id="626ab-738">Follow the API links to learn more about each setting, including default values:</span></span><ul><li><span data-ttu-id="626ab-739">[TimeoutManager. DrainEntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody): temps accordé à l’API du serveur http pour vider le corps d’entité sur une connexion Keep-Alive.</span><span class="sxs-lookup"><span data-stu-id="626ab-739">[TimeoutManager.DrainEntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.DrainEntityBody): Time allowed for the HTTP Server API to drain the entity body on a Keep-Alive connection.</span></span></li><li><span data-ttu-id="626ab-740">[TimeoutManager. EntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody): temps autorisé pour l’arrivée du corps d’entité de la requête.</span><span class="sxs-lookup"><span data-stu-id="626ab-740">[TimeoutManager.EntityBody](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.EntityBody): Time allowed for the request entity body to arrive.</span></span></li><li><span data-ttu-id="626ab-741">[TimeoutManager. HeaderWait](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait): temps accordé à l’API du serveur http pour analyser l’en-tête de la demande.</span><span class="sxs-lookup"><span data-stu-id="626ab-741">[TimeoutManager.HeaderWait](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.HeaderWait): Time allowed for the HTTP Server API to parse the request header.</span></span></li><li><span data-ttu-id="626ab-742">[TimeoutManager. IdleConnection](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection): temps autorisé pour une connexion inactive.</span><span class="sxs-lookup"><span data-stu-id="626ab-742">[TimeoutManager.IdleConnection](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.IdleConnection): Time allowed for an idle connection.</span></span></li><li><span data-ttu-id="626ab-743">[TimeoutManager. MinSendBytesPerSecond](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond): taux d’envoi minimal pour la réponse.</span><span class="sxs-lookup"><span data-stu-id="626ab-743">[TimeoutManager.MinSendBytesPerSecond](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.MinSendBytesPerSecond): The minimum send rate for the response.</span></span></li><li><span data-ttu-id="626ab-744">[TimeoutManager. RequestQueue](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue): temps pendant lequel la demande doit rester dans la file d’attente des demandes avant que l’application la récupère.</span><span class="sxs-lookup"><span data-stu-id="626ab-744">[TimeoutManager.RequestQueue](xref:Microsoft.AspNetCore.Server.HttpSys.TimeoutManager.RequestQueue): Time allowed for the request to remain in the request queue before the app picks it up.</span></span></li></ul> |  |
| <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> | <span data-ttu-id="626ab-745">Spécifiez <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> à inscrire auprès de HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-745">Specify the <xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection> to register with HTTP.sys.</span></span> <span data-ttu-id="626ab-746">La plus utile est [UrlPrefixCollection.Add](xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add*), qui permet d’ajouter un préfixe à la collection.</span><span class="sxs-lookup"><span data-stu-id="626ab-746">The most useful is [UrlPrefixCollection.Add](xref:Microsoft.AspNetCore.Server.HttpSys.UrlPrefixCollection.Add*), which is used to add a prefix to the collection.</span></span> <span data-ttu-id="626ab-747">Ces choix peuvent être modifiés à tout moment avant la suppression de l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="626ab-747">These may be modified at any time prior to disposing the listener.</span></span> |  |

<a name="maxrequestbodysize"></a>

<span data-ttu-id="626ab-748">**MaxRequestBodySize**</span><span class="sxs-lookup"><span data-stu-id="626ab-748">**MaxRequestBodySize**</span></span>

<span data-ttu-id="626ab-749">Taille maximale autorisée pour le corps d’une demande, en octets.</span><span class="sxs-lookup"><span data-stu-id="626ab-749">The maximum allowed size of any request body in bytes.</span></span> <span data-ttu-id="626ab-750">Lorsque la valeur est `null`, elle est illimitée.</span><span class="sxs-lookup"><span data-stu-id="626ab-750">When set to `null`, the maximum request body size is unlimited.</span></span> <span data-ttu-id="626ab-751">Cette limite est sans effet sur les connexions mises à niveau, qui sont illimitées.</span><span class="sxs-lookup"><span data-stu-id="626ab-751">This limit has no effect on upgraded connections, which are always unlimited.</span></span>

<span data-ttu-id="626ab-752">Pour remplacer la limite d’un seul `IActionResult` dans une application MVC ASP.NET Core, nous vous recommandons d’utiliser l’attribut <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> sur une méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="626ab-752">The recommended method to override the limit in an ASP.NET Core MVC app for a single `IActionResult` is to use the <xref:Microsoft.AspNetCore.Mvc.RequestSizeLimitAttribute> attribute on an action method:</span></span>

```csharp
[RequestSizeLimit(100000000)]
public IActionResult MyActionMethod()
```

<span data-ttu-id="626ab-753">Une exception est levée si l’application tente de configurer la limite sur une demande dont l’application a commencé la lecture.</span><span class="sxs-lookup"><span data-stu-id="626ab-753">An exception is thrown if the app attempts to configure the limit on a request after the app has started reading the request.</span></span> <span data-ttu-id="626ab-754">La propriété `IsReadOnly` indique si la propriété `MaxRequestBodySize` est en lecture seule, et donc s’il est trop tard pour configurer la limite.</span><span class="sxs-lookup"><span data-stu-id="626ab-754">An `IsReadOnly` property can be used to indicate if the `MaxRequestBodySize` property is in a read-only state, meaning it's too late to configure the limit.</span></span>

<span data-ttu-id="626ab-755">Si l’application doit remplacer <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> par requête, utilisez <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature> :</span><span class="sxs-lookup"><span data-stu-id="626ab-755">If the app should override <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.MaxRequestBodySize> per-request, use the <xref:Microsoft.AspNetCore.Http.Features.IHttpMaxRequestBodySizeFeature>:</span></span>

[!code-csharp[](httpsys/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=6-7)]

<span data-ttu-id="626ab-756">Si vous utilisez Visual Studio, vérifiez que l’application n’est pas configurée pour exécuter IIS ou IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-756">If using Visual Studio, make sure the app isn't configured to run IIS or IIS Express.</span></span>

<span data-ttu-id="626ab-757">Dans Visual Studio, le profil de démarrage par défaut est destiné à IIS Express.</span><span class="sxs-lookup"><span data-stu-id="626ab-757">In Visual Studio, the default launch profile is for IIS Express.</span></span> <span data-ttu-id="626ab-758">Pour exécuter le projet en tant qu’application console, changez manuellement le profil sélectionné, comme dans la capture d’écran suivante :</span><span class="sxs-lookup"><span data-stu-id="626ab-758">To run the project as a console app, manually change the selected profile, as shown in the following screen shot:</span></span>

![Sélectionner le profil d’application console](httpsys/_static/vs-choose-profile.png)

### <a name="configure-windows-server"></a><span data-ttu-id="626ab-760">Configurer Windows Server</span><span class="sxs-lookup"><span data-stu-id="626ab-760">Configure Windows Server</span></span>

1. <span data-ttu-id="626ab-761">Identifiez les ports à ouvrir pour l’application et utilisez le [pare-feu Windows](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) ou les applets de commande PowerShell [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) pour ouvrir les ports du pare-feu et ainsi permettre au trafic d’atteindre HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-761">Determine the ports to open for the app and use [Windows Firewall](/windows/security/threat-protection/windows-firewall/create-an-inbound-port-rule) or the [New-NetFirewallRule](/powershell/module/netsecurity/new-netfirewallrule) PowerShell cmdlet to open firewall ports to allow traffic to reach HTTP.sys.</span></span> <span data-ttu-id="626ab-762">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-762">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-763">Lors du déploiement sur une machine virtuelle Azure, ouvrez les ports dans le [groupe de sécurité réseau](/azure/virtual-machines/windows/nsg-quickstart-portal).</span><span class="sxs-lookup"><span data-stu-id="626ab-763">When deploying to an Azure VM, open the ports in the [Network Security Group](/azure/virtual-machines/windows/nsg-quickstart-portal).</span></span> <span data-ttu-id="626ab-764">Dans les commandes et la configuration de l’application suivantes, le port 443 est utilisé.</span><span class="sxs-lookup"><span data-stu-id="626ab-764">In the following commands and app configuration, port 443 is used.</span></span>

1. <span data-ttu-id="626ab-765">Obtenez et installez des certificats X.509, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="626ab-765">Obtain and install X.509 certificates, if required.</span></span>

   <span data-ttu-id="626ab-766">Sous Windows, créez des certificats auto-signés à l’aide de la [cmdlet PowerShell New-SelfSignedCertificate](/powershell/module/pkiclient/new-selfsignedcertificate).</span><span class="sxs-lookup"><span data-stu-id="626ab-766">On Windows, create self-signed certificates using the [New-SelfSignedCertificate PowerShell cmdlet](/powershell/module/pkiclient/new-selfsignedcertificate).</span></span> <span data-ttu-id="626ab-767">Vous trouverez un exemple non pris en charge sur la page [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span><span class="sxs-lookup"><span data-stu-id="626ab-767">For an unsupported example, see [UpdateIISExpressSSLForChrome.ps1](https://github.com/dotnet/AspNetCore.Docs/tree/main/aspnetcore/includes/make-x509-cert/UpdateIISExpressSSLForChrome.ps1).</span></span>

   <span data-ttu-id="626ab-768">Installez des certificats auto-signés ou signés par l’autorité de certification dans le magasin **Ordinateur Local** > **Personnel** du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-768">Install either self-signed or CA-signed certificates in the server's **Local Machine** > **Personal** store.</span></span>

1. <span data-ttu-id="626ab-769">Si l’application est un [déploiement dépendant de .NET Framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), installez .NET Core, .NET Framework ou les deux (si l’application est une application .NET Core ciblant .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="626ab-769">If the app is a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), install .NET Core, .NET Framework, or both (if the app is a .NET Core app targeting the .NET Framework).</span></span>

   * <span data-ttu-id="626ab-770">**.Net Core**: si l’application requiert .net Core, obtenez et exécutez le programme d’installation du **Runtime .net Core** à partir des [téléchargements .net Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-770">**.NET Core**: If the app requires .NET Core, obtain and run the **.NET Core Runtime** installer from [.NET Core Downloads](https://dotnet.microsoft.com/download).</span></span> <span data-ttu-id="626ab-771">N’installez pas le Kit SDK complet sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-771">Don't install the full SDK on the server.</span></span>
   * <span data-ttu-id="626ab-772">**.NET Framework**: si l’application requiert des .NET Framework, consultez le [Guide d’installation de .NET Framework](/dotnet/framework/install/).</span><span class="sxs-lookup"><span data-stu-id="626ab-772">**.NET Framework**: If the app requires .NET Framework, see the [.NET Framework installation guide](/dotnet/framework/install/).</span></span> <span data-ttu-id="626ab-773">Installez la version requise de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="626ab-773">Install the required .NET Framework.</span></span> <span data-ttu-id="626ab-774">Le programme d’installation du .NET Framework le plus récent est disponible depuis la page [Téléchargements .NET Core](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="626ab-774">The installer for the latest .NET Framework is available from the [.NET Core Downloads](https://dotnet.microsoft.com/download) page.</span></span>

   <span data-ttu-id="626ab-775">Si l’application est un [déploiement autonome](/dotnet/core/deploying/#self-contained-deployments-scd), elle inclut le runtime dans son déploiement.</span><span class="sxs-lookup"><span data-stu-id="626ab-775">If the app is a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), the app includes the runtime in its deployment.</span></span> <span data-ttu-id="626ab-776">Aucune installation de framework n’est requise sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-776">No framework installation is required on the server.</span></span>

1. <span data-ttu-id="626ab-777">Configurez les ports et les URL de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-777">Configure URLs and ports in the app.</span></span>

   <span data-ttu-id="626ab-778">Par défaut, ASP.NET Core est lié à `http://localhost:5000`.</span><span class="sxs-lookup"><span data-stu-id="626ab-778">By default, ASP.NET Core binds to `http://localhost:5000`.</span></span> <span data-ttu-id="626ab-779">Pour configurer les ports et les préfixes d’URL, il existe plusieurs possibilités :</span><span class="sxs-lookup"><span data-stu-id="626ab-779">To configure URL prefixes and ports, options include:</span></span>

   * <xref:Microsoft.AspNetCore.Hosting.HostingAbstractionsWebHostBuilderExtensions.UseUrls*>
   * <span data-ttu-id="626ab-780">Arguments de ligne de commande `urls`</span><span class="sxs-lookup"><span data-stu-id="626ab-780">`urls` command-line argument</span></span>
   * <span data-ttu-id="626ab-781">`ASPNETCORE_URLS` variable d’environnement</span><span class="sxs-lookup"><span data-stu-id="626ab-781">`ASPNETCORE_URLS` environment variable</span></span>
   * <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes>

   <span data-ttu-id="626ab-782">L’exemple de code suivant montre comment utiliser <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> avec l’adresse IP locale du serveur `10.0.0.4` sur le port 443 :</span><span class="sxs-lookup"><span data-stu-id="626ab-782">The following code example shows how to use <xref:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.UrlPrefixes> with the server's local IP address `10.0.0.4` on port 443:</span></span>

   [!code-csharp[](httpsys/samples_snapshot/2.x/Program.cs?highlight=6)]

   <span data-ttu-id="626ab-783">`UrlPrefixes` présente l’avantage de générer immédiatement un message d’erreur en cas de préfixe mal formé.</span><span class="sxs-lookup"><span data-stu-id="626ab-783">An advantage of `UrlPrefixes` is that an error message is generated immediately for improperly formatted prefixes.</span></span>

   <span data-ttu-id="626ab-784">Les paramètres de `UrlPrefixes` remplacent les paramètres `UseUrls`/`urls`/`ASPNETCORE_URLS`.</span><span class="sxs-lookup"><span data-stu-id="626ab-784">The settings in `UrlPrefixes` override `UseUrls`/`urls`/`ASPNETCORE_URLS` settings.</span></span> <span data-ttu-id="626ab-785">Par conséquent, avec `UseUrls`, `urls` et la variable d’environnement `ASPNETCORE_URLS`, il est plus facile de basculer entre Kestrel et HTTP.sys.</span><span class="sxs-lookup"><span data-stu-id="626ab-785">Therefore, an advantage of `UseUrls`, `urls`, and the `ASPNETCORE_URLS` environment variable is that it's easier to switch between Kestrel and HTTP.sys.</span></span>

   <span data-ttu-id="626ab-786">HTTP.sys utilise les [formats de chaîne UrlPrefix de l’API de serveur HTTP](/windows/win32/http/urlprefix-strings).</span><span class="sxs-lookup"><span data-stu-id="626ab-786">HTTP.sys uses the [HTTP Server API UrlPrefix string formats](/windows/win32/http/urlprefix-strings).</span></span>

   > [!WARNING]
   > <span data-ttu-id="626ab-787">Les liaisons génériques de niveau supérieur (`http://*:80/` et `http://+:80`) ne doivent **pas** être utilisées.</span><span class="sxs-lookup"><span data-stu-id="626ab-787">Top-level wildcard bindings (`http://*:80/` and `http://+:80`) should **not** be used.</span></span> <span data-ttu-id="626ab-788">Les liaisons génériques de niveau supérieur créent des failles de sécurité dans l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-788">Top-level wildcard bindings create app security vulnerabilities.</span></span> <span data-ttu-id="626ab-789">Cela s’applique aux caractères génériques forts et faibles.</span><span class="sxs-lookup"><span data-stu-id="626ab-789">This applies to both strong and weak wildcards.</span></span> <span data-ttu-id="626ab-790">Utilisez des noms d’hôte ou des adresses IP explicites plutôt que des caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="626ab-790">Use explicit host names or IP addresses rather than wildcards.</span></span> <span data-ttu-id="626ab-791">Une liaison générique de sous-domaine (par exemple, `*.mysub.com`) ne constitue pas un risque de sécurité si vous contrôlez le domaine parent en entier (par opposition à `*.com`, qui est vulnérable).</span><span class="sxs-lookup"><span data-stu-id="626ab-791">Subdomain wildcard binding (for example, `*.mysub.com`) isn't a security risk if you control the entire parent domain (as opposed to `*.com`, which is vulnerable).</span></span> <span data-ttu-id="626ab-792">Pour plus d’informations, consultez [RFC 7230 : Section 5,4 : Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span><span class="sxs-lookup"><span data-stu-id="626ab-792">For more information, see [RFC 7230: Section 5.4: Host](https://tools.ietf.org/html/rfc7230#section-5.4).</span></span>

1. <span data-ttu-id="626ab-793">Préenregistrez les préfixes d’URL sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-793">Preregister URL prefixes on the server.</span></span>

   <span data-ttu-id="626ab-794">L’outil intégré pour configurer HTTP.sys est *netsh.exe*.</span><span class="sxs-lookup"><span data-stu-id="626ab-794">The built-in tool for configuring HTTP.sys is *netsh.exe*.</span></span> <span data-ttu-id="626ab-795">*netsh.exe* permet de réserver des préfixes d’URL et d’assigner des certificats X.509.</span><span class="sxs-lookup"><span data-stu-id="626ab-795">*netsh.exe* is used to reserve URL prefixes and assign X.509 certificates.</span></span> <span data-ttu-id="626ab-796">L’outil requiert des privilèges Administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-796">The tool requires administrator privileges.</span></span>

   <span data-ttu-id="626ab-797">Utilisez l’outil *netsh.exe* pour enregistrer les URL pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-797">Use the *netsh.exe* tool to register URLs for the app:</span></span>

   ```console
   netsh http add urlacl url=<URL> user=<USER>
   ```

   * <span data-ttu-id="626ab-798">`<URL>`: Le Uniform Resource Locator qualifié complet (URL).</span><span class="sxs-lookup"><span data-stu-id="626ab-798">`<URL>`: The fully qualified Uniform Resource Locator (URL).</span></span> <span data-ttu-id="626ab-799">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-799">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-800">Utilisez un nom d’hôte ou une adresse IP locale valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-800">Use a valid hostname or local IP address.</span></span> <span data-ttu-id="626ab-801">*L’URL doit inclure une barre oblique de fin.*</span><span class="sxs-lookup"><span data-stu-id="626ab-801">*The URL must include a trailing slash.*</span></span>
   * <span data-ttu-id="626ab-802">`<USER>`: Spécifie le nom d’utilisateur ou de groupe d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="626ab-802">`<USER>`: Specifies the user or user-group name.</span></span>

   <span data-ttu-id="626ab-803">Dans l’exemple suivant, l’adresse IP locale du serveur est `10.0.0.4` :</span><span class="sxs-lookup"><span data-stu-id="626ab-803">In the following example, the local IP address of the server is `10.0.0.4`:</span></span>

   ```console
   netsh http add urlacl url=https://10.0.0.4:443/ user=Users
   ```

   <span data-ttu-id="626ab-804">Lorsqu’une URL est inscrite, l’outil répond avec `URL reservation successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-804">When a URL is registered, the tool responds with `URL reservation successfully added`.</span></span>

   <span data-ttu-id="626ab-805">Pour supprimer une URL inscrite, utilisez la commande `delete urlacl` :</span><span class="sxs-lookup"><span data-stu-id="626ab-805">To delete a registered URL, use the `delete urlacl` command:</span></span>

   ```console
   netsh http delete urlacl url=<URL>
   ```

1. <span data-ttu-id="626ab-806">Inscrivez les certificats X.509 sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-806">Register X.509 certificates on the server.</span></span>

   <span data-ttu-id="626ab-807">Utilisez l’outil *netsh.exe* pour enregistrer les certificats pour l’application :</span><span class="sxs-lookup"><span data-stu-id="626ab-807">Use the *netsh.exe* tool to register certificates for the app:</span></span>

   ```console
   netsh http add sslcert ipport=<IP>:<PORT> certhash=<THUMBPRINT> appid="{<GUID>}"
   ```

   * <span data-ttu-id="626ab-808">`<IP>`: Spécifie l’adresse IP locale pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-808">`<IP>`: Specifies the local IP address for the binding.</span></span> <span data-ttu-id="626ab-809">N’utilisez pas une liaison de caractère générique.</span><span class="sxs-lookup"><span data-stu-id="626ab-809">Don't use a wildcard binding.</span></span> <span data-ttu-id="626ab-810">Utilisez une adresse IP valide.</span><span class="sxs-lookup"><span data-stu-id="626ab-810">Use a valid IP address.</span></span>
   * <span data-ttu-id="626ab-811">`<PORT>`: Spécifie le port pour la liaison.</span><span class="sxs-lookup"><span data-stu-id="626ab-811">`<PORT>`: Specifies the port for the binding.</span></span>
   * <span data-ttu-id="626ab-812">`<THUMBPRINT>`: Empreinte numérique du certificat X. 509.</span><span class="sxs-lookup"><span data-stu-id="626ab-812">`<THUMBPRINT>`: The X.509 certificate thumbprint.</span></span>
   * <span data-ttu-id="626ab-813">`<GUID>`: GUID généré par le développeur pour représenter l’application à des fins d’information.</span><span class="sxs-lookup"><span data-stu-id="626ab-813">`<GUID>`: A developer-generated GUID to represent the app for informational purposes.</span></span>

   <span data-ttu-id="626ab-814">À titre de référence, stockez le GUID dans l’application en tant que balise de package :</span><span class="sxs-lookup"><span data-stu-id="626ab-814">For reference purposes, store the GUID in the app as a package tag:</span></span>

   * <span data-ttu-id="626ab-815">Dans Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-815">In Visual Studio:</span></span>
     * <span data-ttu-id="626ab-816">Ouvrez les propriétés du projet de l’application en cliquant avec le bouton droit sur l’application dans **l’Explorateur de solutions** et en sélectionnant **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="626ab-816">Open the app's project properties by right-clicking on the app in **Solution Explorer** and selecting **Properties**.</span></span>
     * <span data-ttu-id="626ab-817">Sélectionnez l’onglet **Package**.</span><span class="sxs-lookup"><span data-stu-id="626ab-817">Select the **Package** tab.</span></span>
     * <span data-ttu-id="626ab-818">Entrez le GUID que vous avez créé dans le champ **Balises**.</span><span class="sxs-lookup"><span data-stu-id="626ab-818">Enter the GUID that you created in the **Tags** field.</span></span>
   * <span data-ttu-id="626ab-819">Si vous n’utilisez pas Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="626ab-819">When not using Visual Studio:</span></span>
     * <span data-ttu-id="626ab-820">Ouvrez le chemin d’accès vers le fichier de projet de l’application.</span><span class="sxs-lookup"><span data-stu-id="626ab-820">Open the app's project file.</span></span>
     * <span data-ttu-id="626ab-821">Ajoutez une propriété `<PackageTags>` à un `<PropertyGroup>` nouveau ou existant avec le GUID que vous avez créé :</span><span class="sxs-lookup"><span data-stu-id="626ab-821">Add a `<PackageTags>` property to a new or existing `<PropertyGroup>` with the GUID that you created:</span></span>

       ```xml
       <PropertyGroup>
         <PackageTags>9412ee86-c21b-4eb8-bd89-f650fbf44931</PackageTags>
       </PropertyGroup>
       ```

   <span data-ttu-id="626ab-822">Dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="626ab-822">In the following example:</span></span>

   * <span data-ttu-id="626ab-823">L’adresse IP locale du serveur est `10.0.0.4`.</span><span class="sxs-lookup"><span data-stu-id="626ab-823">The local IP address of the server is `10.0.0.4`.</span></span>
   * <span data-ttu-id="626ab-824">Un générateur de GUID aléatoire en ligne fournit la valeur `appid`.</span><span class="sxs-lookup"><span data-stu-id="626ab-824">An online random GUID generator provides the `appid` value.</span></span>

   ```console
   netsh http add sslcert 
       ipport=10.0.0.4:443 
       certhash=b66ee04419d4ee37464ab8785ff02449980eae10 
       appid="{9412ee86-c21b-4eb8-bd89-f650fbf44931}"
   ```

   <span data-ttu-id="626ab-825">Lorsqu’un certificat est inscrit, l’outil répond avec `SSL Certificate successfully added`.</span><span class="sxs-lookup"><span data-stu-id="626ab-825">When a certificate is registered, the tool responds with `SSL Certificate successfully added`.</span></span>

   <span data-ttu-id="626ab-826">Pour supprimer l’inscription d’un certificat, utilisez la commande `delete sslcert` :</span><span class="sxs-lookup"><span data-stu-id="626ab-826">To delete a certificate registration, use the `delete sslcert` command:</span></span>

   ```console
   netsh http delete sslcert ipport=<IP>:<PORT>
   ```

   <span data-ttu-id="626ab-827">Documentation de référence de *netsh.exe* :</span><span class="sxs-lookup"><span data-stu-id="626ab-827">Reference documentation for *netsh.exe*:</span></span>

   * <span data-ttu-id="626ab-828">[Commandes netsh pour le protocole HTTP (Hypertext Transfer Protocol)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="626ab-828">[Netsh Commands for Hypertext Transfer Protocol (HTTP)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc725882(v=ws.10))</span></span>
   * [<span data-ttu-id="626ab-829">Chaînes UrlPrefix</span><span class="sxs-lookup"><span data-stu-id="626ab-829">UrlPrefix Strings</span></span>](/windows/win32/http/urlprefix-strings)

1. <span data-ttu-id="626ab-830">Exécutez l'application.</span><span class="sxs-lookup"><span data-stu-id="626ab-830">Run the app.</span></span>

   <span data-ttu-id="626ab-831">Les privilèges administrateur ne sont pas requis pour exécuter l’application lors d’une liaison à localhost à l’aide de HTTP (pas HTTPS) avec un numéro de port supérieur à 1024.</span><span class="sxs-lookup"><span data-stu-id="626ab-831">Administrator privileges aren't required to run the app when binding to localhost using HTTP (not HTTPS) with a port number greater than 1024.</span></span> <span data-ttu-id="626ab-832">Pour les autres configurations (par exemple, l’utilisation d’une adresse IP locale ou la liaison au port 443), exécutez l’application avec des privilèges administrateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-832">For other configurations (for example, using a local IP address or binding to port 443), run the app with administrator privileges.</span></span>

   <span data-ttu-id="626ab-833">L’application répond à l’adresse IP publique du serveur.</span><span class="sxs-lookup"><span data-stu-id="626ab-833">The app responds at the server's public IP address.</span></span> <span data-ttu-id="626ab-834">Dans cet exemple, le serveur est contacté à partir d’Internet à son adresse IP publique `104.214.79.47`.</span><span class="sxs-lookup"><span data-stu-id="626ab-834">In this example, the server is reached from the Internet at its public IP address of `104.214.79.47`.</span></span>

   <span data-ttu-id="626ab-835">Un certificat de développement est utilisé dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="626ab-835">A development certificate is used in this example.</span></span> <span data-ttu-id="626ab-836">La page est chargée en toute sécurité après le contournement de l’avertissement de certificat non approuvé du navigateur.</span><span class="sxs-lookup"><span data-stu-id="626ab-836">The page loads securely after bypassing the browser's untrusted certificate warning.</span></span>

   ![Fenêtre de navigateur affichant la page Index de l’application chargée](httpsys/_static/browser.png)

## <a name="proxy-server-and-load-balancer-scenarios"></a><span data-ttu-id="626ab-838">Scénarios avec un serveur proxy et un équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="626ab-838">Proxy server and load balancer scenarios</span></span>

<span data-ttu-id="626ab-839">Pour les applications hébergées par HTTP.sys qui interagissent avec les demandes provenant d’Internet ou d’un réseau d’entreprise, une configuration supplémentaire peut être nécessaire en cas d’hébergement derrière des serveurs proxy et des équilibreurs de charge.</span><span class="sxs-lookup"><span data-stu-id="626ab-839">For apps hosted by HTTP.sys that interact with requests from the Internet or a corporate network, additional configuration might be required when hosting behind proxy servers and load balancers.</span></span> <span data-ttu-id="626ab-840">Pour plus d’informations, consultez l’article [Configurer ASP.NET Core pour l’utilisation de serveurs proxy et d’équilibreurs de charge](xref:host-and-deploy/proxy-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="626ab-840">For more information, see [Configure ASP.NET Core to work with proxy servers and load balancers](xref:host-and-deploy/proxy-load-balancer).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="626ab-841">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="626ab-841">Additional resources</span></span>

* [<span data-ttu-id="626ab-842">Activer l’authentification Windows avec HTTP.sys</span><span class="sxs-lookup"><span data-stu-id="626ab-842">Enable Windows Authentication with HTTP.sys</span></span>](xref:security/authentication/windowsauth#httpsys)
* [<span data-ttu-id="626ab-843">API de serveur HTTP</span><span class="sxs-lookup"><span data-stu-id="626ab-843">HTTP Server API</span></span>](/windows/win32/http/http-api-start-page)
* [<span data-ttu-id="626ab-844">Référentiel GitHub aspnet/HttpSysServer (code source)</span><span class="sxs-lookup"><span data-stu-id="626ab-844">aspnet/HttpSysServer GitHub repository (source code)</span></span>](https://github.com/aspnet/HttpSysServer/)
* [<span data-ttu-id="626ab-845">L’hôte</span><span class="sxs-lookup"><span data-stu-id="626ab-845">The host</span></span>](xref:fundamentals/index#host)
* <xref:test/troubleshoot>

::: moniker-end
